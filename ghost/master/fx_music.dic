//Written by Zichqec https://ukagaka.zichqec.com/
//Version 2.0.3

//Want to implement this music player in your own ghost? You can get the files here! https://github.com/Zichqec/music_player
//Also includes a file bundle you can use to automatically integrate the player into an unmodified copy of Simplicity Template, for if you're starting a new ghost

/*
IMPLEMENTING THE MUSIC PLAYER:

I have left markers in the file for what bits you actually need to mess with. You should have a look at the section markers I have added, and also run searches for the following terms:

//DIALOGUE:
//CUSTOMIZE:

DIALOGUE is anywhere that you may want to put custom dialogue.
CUSTOMIZE is anywhere you may want to make small changes to the code to better suit your ghost.

You will also definitely want to go over the functions in the FUNCTIONS THAT SHOULD BE CUSTOMIZED section. This has critical things such as which surfaces will be used while the ghost is singing.

A function you might find helpful is the MusicPlayer.Singing function. It returns a 1 if music is currently playing, and a 0 if not. You can use this to add checks to functions like OnSurfaceRestore, to make sure your ghost stays in the singing poses while playing music.

Another useful function is MusicPlayer.CurrentSongName, which outputs the name of the currently playing song.

To initialize all of the music player's variables, you should call the following function in OnFirstBoot:
MusicPlayer.SetDefaultSettings

Additionally, I would recommend calling OnMusicPlayer.NotifySongInfo in your OnFirstBoot, OnBoot, and any other events that cause your ghost to open/close. This will ensure that your ghost updates any open ghosts on the status of the music player when it opens or closes.

I will also recommend that you use developer_options.txt in order to prevent your playlists folder from ending up in your update files or nar files.

If you run into any trouble do let me know and I will try to help you. If you find any bugs in the music player itself, please let me know and I will try to get them fixed.

I may release new versions of this from time to time, but you will probably have to update this file piecemeal if you decide to update. Please check the GitHub repository for this file to see what changes have been made.
https://github.com/Zichqec/music_player

If you have an old version of this music player from before I updated the variable names, please run the function MusicPlayer.ConvertOldVariables before you open the music menu. This should convert all of the old variables over to the new ones.
If you had already released a ghost with the old music player code in it, you can use this function in OnUpdateComplete to ensure the user's variables get converted.
This conversion process may not be perfect, and some data may be lost. If there is an issue, please notify me and I will try to fix it. However, I cannot make any guarantees or take responsibility for lost data.
*/

/*
Section names, for easy searching with Ctrl F:

CORE FUNCTIONS
FUNCTIONS THAT SHOULD BE CUSTOMIZED
BUILT IN SHIORI EVENTS
TOOLS
DISCORD
*/

//—————————— CORE FUNCTIONS ——————————
//The bulk of the menus and functions used by the music player. Most of this you won't need to touch.

//Main music menu display; this displays the list of songs and the controls
OnMusicPlayer.Menu : all
{
	MusicPlayer.ResetDefaultSettings
	
	_g = "\f[color,disable]" //Gray
	_d = "\f[color,default]" //Default
	
	if _argv[0] != "manual" && MusicPlayer.BalloonIsOpen; "\C\![lock,balloonrepaint]\c"
	
	_starting_value = 0
	if MusicPlayer.Pagination == 1
	{
		_starting_value = MusicPlayer.PageIndex * MusicPlayer.SongsPerPage
	}
	
	"%(MusicPlayer.Scope)\c%(MusicPlayer.LargeBalloon)\![quicksection,1]\*\![set,autoscroll,disable]\![no-autopause]\f[anchorvisitedfontcolor,default.anchor]\![close,inputbox,OnSetName]"
	
	//TRANSLATORS: These are the buttons at the top of the music player menu. There are also some buttons at the bottom
	//TODO TRANSLATION: Translation update, the settings menu changed to just settings, and the move songs menu changed to help
	if language == "Placeholder"
	{
		
	}
	elseif language == "Español"
	{
		"\![*]\__q[OnSakuraMenu]Volver\__q  \![*]\__q[blank]Cerrar ventana\__q\n"
		"\![*]\__q[OnMusicPlayer.Settings,Basic]Ajustes\__q  \![*]\__q[OnMusicPlayer.Info]Ayuda\__q\n\n[half]"
	}
	elseif language == "Deutsch"
	{
		"\![*]\__q[OnMenuRun]Zurück\__q  \![*]\__q[OnBlank]Fenster schließen\__q\n"
		"\![*]\__q[OnMusicPlayer.Settings,Basic]Einstellungen und Info\__q  \![*]\__q[OnMusicPlayer.Info]Lieder bewegen\__q\n\n[half]"
	}
	elseif language == "Русский"
	{
		"\![*]\__q[OnMenuRun]Назад\__q  \![*]\__q[OnBlank]Закрыть\__q\n"
		"\![*]\__q[OnMusicPlayer.Settings,Basic]Настройки\__q  \![*]\__q[OnMusicPlayer.Info]Помочь\__q\n\n[half]"
	}
	elseif language == "Français"
	{
		"\![*]\__q[OnMenuRun]Retour\__q  \![*]\__q[OnBlank]Fermer la fenêtre\__q\n"
		"\![*]\__q[OnMusicPlayer.Settings,Basic]Paramètres et Infos\__q  \![*]\__q[OnMusicPlayer.Info]Déplacer des musiques\__q\n\n[half]"
	}
	elseif language == "Polski"
	{
		"\![*]\__q[OnMenuRun]Powrót\__q  \![*]\__q[OnBlank]Zamknij\__q\n"
		"\![*]\__q[OnMusicPlayer.Settings,Basic]Ustawienia i informacje\__q  \![*]\__q[OnMusicPlayer.Info]Przenieś utwory\__q\n\n[half]"
	}
	else //English
	{
		"\![*]\__q[OnSakuraMenu]Back\__q  \![*]\__q[blank]Close window\__q\n"
		"\![*]\__q[OnMusicPlayer.Settings,Basic]Settings\__q  \![*]\__q[OnMusicPlayer.Info]Help\__q\n\n[half]"
	}
	
	//TRANSLATORS: The play/pause buttons for the main music menu
	_playbtn = ""
	_pausebtn = ""
	_resumebtn = ""
	_stopbtn = ""
	if language == "Placeholder"
	{
		
	}
	elseif language == "Español"
	{
		_playbtn = "Reproducir"
		_pausebtn = "Pausar"
		_resumebtn = "Continuar"
		_stopbtn = "Detener"
	}
	elseif language == "Deutsch"
	{
		_playbtn = "Start"
		_pausebtn = "Pause"
		_resumebtn = "Fortsetzen"
		_stopbtn = "Stop"
	}
	elseif language == "Русский"
	{
		_playbtn = "Играть"
		_pausebtn = "Пауза"
		_resumebtn = "Возобновлять"
		_stopbtn = "Стоп"
	}
	elseif language == "Français"
	{
		_playbtn = "Lire"
		_pausebtn = "Pause"
		_resumebtn = "Reprendre"
		_stopbtn = "Stop"
	}
	elseif language == "Polski"
	{
		_playbtn = "Graj"
		_pausebtn = "Pauza"
		_resumebtn = "Wznów"
		_stopbtn = "Zatrzymaj"
	}
	else //English
	{
		_playbtn = "Play"
		_pausebtn = "Pause"
		_resumebtn = "Resume"
		_stopbtn = "Stop"
	}
	if MusicPlayer.PlayState == 0 //This is if no song is loaded in. The text will be grayed out until a song is chosen.
	{
		//The playbutton reference here is for if no song is loaded
		
		"%(_g)<<<   \![*]%(_pausebtn)%(_d)%(MusicPlayer.newline)\f[align,right]\![*]\__q[OnMusicPlayer.PlaySong,,OnMusicPlayer.Menu]%(_playbtn)\__q    %(_g)>>>%(_d)\n\n[half]\f[align,left]"
	}
	else //If a song is loaded. The pause button will change to say resume if a song is currently paused.
	{
		"\q[<<<,OnMusicPlayer.PrevSong]   "
		
		if MusicPlayer.PlayState == 2; "\![*]\__q[OnMusicPlayer.PauseSong,OnMusicPlayer.Menu,resume]%(_resumebtn)\__q"
		else; "\![*]\__q[OnMusicPlayer.PauseSong,OnMusicPlayer.Menu,pause]%(_pausebtn)\__q"
		
		"%(MusicPlayer.newline)\f[align,right]\![*]\__q[OnMusicPlayer.StopSong,OnMusicPlayer.Menu]%(_stopbtn)\__q    \q[>>>,OnMusicPlayer.NextSong]\n\n[half]\f[align,left]"
	}
	
	if language == "Placeholder" //TRANSLATORS: The currently playing song display
	{
		
	}
	elseif language == "Español"
	{
		"Reproduciendo ahora:"
	}
	elseif language == "Deutsch"
	{
		"Jetzt läuft:"
	}
	elseif language == "Русский"
	{
		"Сейчас играет:"
	}
	elseif language == "Français"
	{
		"Actuellement jouée :"
	}
	elseif language == "Polski"
	{
		"Teraz gra:"
	}
	else //English
	{
		"Now playing:"
	}
	" "
	
	if MusicPlayer.PlayState != 0
	{
		_removed = ""
		if language == "Placeholder" //TRANSLATORS: This label is for the now playing display, if the song the user is currently listening to has been removed from the playlist
		{
			_removed = ""
		}
		elseif language == "Español"
		{
			_removed = "(Eliminado de la lista de reproducción)"
		}
		elseif language == "Deutsch"
		{
			_removed = "(Aus Playliste entfernt)"
		}
		elseif language == "Русский"
		{
			_removed = "(Удалено из плейлиста)"
		}
		elseif language == "Français"
		{
			_removed = "(Supprimé de la playlist)"
		}
		elseif language == "Polski"
		{
			_removed = "(Usunięto z listy odtwarzania)"
		}
		else //English
		{
			_removed = "(Removed from playlist)"
		}
		
		if MusicPlayer.PlayingRemovedSong; "\_a[OnMusicPlayer.SongLocation,""%(MusicPlayer.LastRemovedSong)""]%(_removed)\_a"
		else; "\_a[OnMusicPlayer.SongLocation,""%(MusicPlayer.CurrentSongPath)""]%(MusicPlayer.CurrentSongName)\_a"
	}
	
	if MusicPlayer.Pagination == 1
	{
		//Font tags to ensure no tofus or other weirdness
		_up = "\f[name,calibri]▲\f[name,default]"
		_down = "\f[name,calibri]▼\f[name,default]"
		"\n\n[half]"
		"\f[align,left]    "
		switch MusicPlayer.PageIndex == 0
		{
			"\__q[OnMusicPlayer.PlaylistPage,previous]%(_up)%(_up)\__q"
			"\f[color,disable]%(_up)%(_up)\f[color,default]"
		}
		"\_l[]\f[align,right]"
		switch MusicPlayer.PageIndex == MusicPlayer.MaxPages
		{
			"\__q[OnMusicPlayer.PlaylistPage,next]%(_down)%(_down)\__q"
			"\f[color,disable]%(_down)%(_down)\f[color,default]"
		}
		"    "
		
		_currentpage = MusicPlayer.PageIndex + 1
		_maxpage = MusicPlayer.MaxPages + 1
		
		_pagedisplay = ""
		//TODO TRANSLATION this is new
		if language == "Placeholder" //TRANSLATORS: The page display on the main music menu, to show what page you're on and how many pages there are total
		{
			
		}
		elseif language == "Español"
		{
			_pagedisplay = "Página %(_currentpage)/%(_maxpage)"
		}
		elseif language == "Deutsch"
		{
			_pagedisplay = "Page %(_currentpage)/%(_maxpage)"
		}
		elseif language == "Русский"
		{
			_pagedisplay = "Страница %(_currentpage)/%(_maxpage)"
		}
		elseif language == "Français"
		{
			_pagedisplay = "Page %(_currentpage)/%(_maxpage)"
		}
		elseif language == "Polski"
		{
			_pagedisplay = "Page %(_currentpage)/%(_maxpage)"
		}
		else //English
		{
			_pagedisplay = "Page %(_currentpage)/%(_maxpage)"
		}
		
		"\n \n[-100]\f[align,center]\__q[OnMusicPlayer.JumpToPlaylistPage]%(_pagedisplay)\__q"
		"\_l[]\f[align,left]"
	}
	
	"\n\n[half]"
	
	_currentsong = IARRAY
	for _i = 0; _i < ARRAYSIZE(MusicPlayer.CurrentPlaylist); _i++
	{
		_song = MusicPlayer.CurrentPlaylist[_i]
		_song = SPLITPATH(_song)[2] //Picks out just the name of the file, no extension
		_path = MusicPlayer.CurrentPlaylist[_i]
		
		if _i == MusicPlayer.CurrentSongIndex && !MusicPlayer.PlayingRemovedSong //If this is the song that's playing right now
		{
			_currentsong[0] = _song //Song name
			_currentsong[1] = MusicPlayer.CurrentPlaylist[_i] //Song path
		}
		if MusicPlayer.Pagination == 1
		{
			if _i < _starting_value; continue
			if _i > _starting_value + (MusicPlayer.SongsPerPage - 1)
			{
				if _currentsong[0] == ""; continue
				else; break
			}
		}

		"\q[(x),OnMusicPlayer.RemoveSong,%(_i)] " //(x) button

		if _i == MusicPlayer.CurrentSongIndex && !MusicPlayer.PlayingRemovedSong //If this is the song that's playing right now
		{
			"\f[bold,1]\f[italic,1]"
		}
		"\_a[OnMusicPlayer.PlaySong,%(_i),OnMusicPlayer.Menu,frommenu]%(_song)\_a\n"
		if _i == MusicPlayer.CurrentSongIndex && !MusicPlayer.PlayingRemovedSong; "\f[italic,default]\f[bold,default]" //Reset the bold/italic if it was applied
	}
	
	"\n"
	
	if language == "Placeholder" //TRANSLATORS: These buttons are the same as at the top of the music menu, but it's just the first two.
	{
		
	}
	elseif language == "Español"
	{
		"\![*]\__q[OnMenuRun]Volver\__q  \![*]\__q[OnBlank]Cerrar ventana\__q"
	}
	elseif language == "Deutsch"
	{
		"\![*]\__q[OnSakuraMenu]Zurück\__q  \![*]\__q[OnBlank]Fenster schließen\__q"
	}
	elseif language == "Русский"
	{
		"\![*]\__q[OnSakuraMenu]Назад\__q  \![*]\__q[OnBlank]Закрыть Окно\__q"
	}
	elseif language == "Français"
	{
		"\![*]\__q[OnSakuraMenu]Retour\__q  \![*]\__q[OnBlank]Fermer la fenêtre\__q"
	}
	elseif language == "Polski"
	{
		"\![*]\__q[OnSakuraMenu]Powrót\__q  \![*]\__q[OnBlank]Zamknij\__q"
	}
	else //English
	{
		"\![*]\__q[OnSakuraMenu]Back\__q  \![*]\__q[blank]Close window\__q"
	}
	
	"\![unlock,balloonrepaint]\e __MUSIC_PLAYER_MAIN_MENU__" //Do not remove this, it's here so the menu can update dynamically
}

//Function that actually plays the songs
OnMusicPlayer.PlaySong : all
{
	//reference0 - Index number of the song to play
	//reference1 - What event to return to, if any (music menu, etc)
	//reference2 - Special flags "justadded" or "frommenu" (frommenu makes the playlist reshuffle if the user clicks a new song from the song list)
	
	MusicPlayer.ResetDefaultSettings
	
	//Don't reset in the case that we are replaying the last removed song...
	if reference2 != "replay removed song"; MusicPlayer.PlayingRemovedSong = 0
	
	if MusicPlayer.IsMinimized //If it's minimized, the info will be coming from arguments rather than references
	{
		reference0 = _argv[1]
	}
	if ARRAYSIZE(MusicPlayer.CurrentPlaylist) > 0 || MusicPlayer.PlayingRemovedSong //If there are more songs to play
	{
		_start_point = -1
		if reference2 == "justadded" //Played after dragging and dropping
		{
			_start_point = ARRAYSIZE(MusicPlayer.CurrentPlaylist) - 1
		}
		elseif reference2 == "frommenu" //Picked direct from the menu
		{
			_start_point = reference0
		}
		elseif MusicPlayer.CurrentSongIndex == -1 //No song playing
		{
			_start_point = 0
		}
		//Otherwise, just play the current index that we were stopped at
		
		if _start_point != -1
		{
			MusicPlayer.CurrentSongIndex = _start_point
			MusicPlayer.ShuffledPlaylist = MusicPlayer.ShufflePlaylist(MusicPlayer.CurrentSongIndex,MusicPlayer.CurrentPlaylist)
			MusicPlayer.ShuffledIndex = 0
		}
		
		if MusicPlayer.BalloonIsOpen && reference2 != "justadded"; "\C" //If the balloon is currently open other than when a song was just added, keep it open
		
		"%(MusicPlayer.Scope)%(MusicPlayer.SingingSurfaces)" //Start the singing animations if they weren't already started
		
		_send = ""
		_send += "\![sound,stop]\![no-autopause]"
		
		_window = "False"
		if MusicPlayer.SongBar == 1; _window = "True"
		
		MusicPlayer.SongStartTime = GETSECCOUNT
		MusicPlayer.PlayState = 1
		
		_send += "\![sound,play,""%(MusicPlayer.CurrentSongPath)"",--volume=%(MusicPlayer.Volume),--rate=%(MusicPlayer.Speed),--balance=%(MusicPlayer.Balance),--window=%(_window),--sound-only=true]"
		_send += "%(OnMusicPlayer.NotifySongInfo)"
		
		if MusicPlayer.IsMinimized
		{
			MusicPlayer.MakeValueNotify(_send)
		}
		else
		{
			_send
			
			if reference1 != ""; "\![raise,%(reference1)]" //If music menu is already open, reopen it so that it highlights the correct song properly
			elseif !MusicPlayer.MenuIsOpen
			{
				if MusicPlayer.SongAnnouncement == 2 || !SHIORI3FW.IsTalking && MusicPlayer.SongAnnouncement == 1
				{
					"%(MusicPlayer.Scope)%(MusicPlayer.SmallBalloon)\![quicksection,1]\![lock,balloonrepaint]\c\![dummy]"
					
					//DIALOGUE: Song announcement
					"[Now playing:]\n\_?%(MusicPlayer.CurrentSongName)\_?" //TODO translations here -- i have the text already, just need to move it
					"\![unlock,balloonrepaint]"
				}
			}
		}
	}
	else //If there are no songs available to play
	{
		_from = MusicPlayer.CheckWhichMenu
		
		"\![raise,OnMusicPlayer.StopSong,""%(_from)""]"
	}
}

//Stopping a song
OnMusicPlayer.StopSong : all
{
	//reference0 is which menu this is coming from
	
	MusicPlayer.PlayState = 0 //Clearing paused song
	MusicPlayer.StopAfterCurrent = "" //Reset the stop after current/playlist option
	MusicPlayer.PlayingRemovedSong = 0
	
	if MusicPlayer.IsMinimized
	{
		MusicPlayer.MakeValueNotify("%(OnMusicPlayer.NotifySongInfo)")
		return
	}
	
	if MusicPlayer.MenuIsOpen; "\C"
	"\![no-autopause]"
	
	"\![sound,stop]"
	
	"%(MusicPlayer.NonSingingSurfaces)%(OnMusicPlayer.NotifySongInfo)" //Stop the singing animations
	
	if reference0 != ""; "\![raise,%(reference0)]" //If music menu is already open, reopen it so that it highlights the correct song properly
}

//Pausing or unpausing a song
OnMusicPlayer.PauseSong : all
{
	//reference0 is which menu this is coming from
	//reference1 is if we're pausing or resuming
	_window = "False"
	if MusicPlayer.SongBar == 1; _window = "True"
	
	if MusicPlayer.MenuIsOpen; "\C" //If the balloon is open, keep it open
	"\![no-autopause]"
	"\![sound,option,""%(MusicPlayer.CurrentSongPath)"",--volume=%(MusicPlayer.Volume),--rate=%(MusicPlayer.Speed),--balance=%(MusicPlayer.Balance),--window=%(_window)]"
	
	if reference1 == "resume" //Unpausing
	{
		MusicPlayer.PlayState = 1
		"%(MusicPlayer.SingingSurfaces)\![sound,resume]"
	}
	else //Pausing
	{
		MusicPlayer.PlayState = 2
		"%(MusicPlayer.NonSingingSurfaces)\![sound,pause]"
	}
	
	"%(OnMusicPlayer.NotifySongInfo)"
	
	if reference0 != ""; "\![raise,%(reference0)]" //If music menu is already open, reopen it so that it highlights the correct song properly
}

//The user pressed a hotkey or menu option to go to the next song
OnMusicPlayer.NextSong : all
{
	//reference0 is which menu this is coming from

	MusicPlayer.PlayState = 1
	
	_from = reference0
	if _from == ""; _from = MusicPlayer.CheckWhichMenu //Sent to OnMusicPlayer.PlaySong
	_next = 0
	
	if MusicPlayer.MenuIsOpen; "\C"
	"\![no-autopause]"
	
	"\![sound,stop]"
	
	if ARRAYSIZE(MusicPlayer.CurrentPlaylist) > 0 //Songs available to play
	{
		if MusicPlayer.PlayMode == 4 //Random
		{
			_next = RAND(ARRAYSIZE(MusicPlayer.CurrentPlaylist))
		}
		elseif MusicPlayer.PlayMode == 1 //Shuffle and loop
		{
			if MusicPlayer.ShuffledIndex >= (ARRAYSIZE(MusicPlayer.CurrentPlaylist) - 1) //If this was the last song on the list
			{
				MusicPlayer.ShuffledIndex = 0
			}
			else //If there are more songs to go
			{
				MusicPlayer.ShuffledIndex++
			}
			_next = MusicPlayer.ShuffledPlaylist[MusicPlayer.ShuffledIndex]
		}
		else //Looping the list normally
		{
			if MusicPlayer.CurrentSongIndex >= (ARRAYSIZE(MusicPlayer.CurrentPlaylist) - 1) //If this was the last song on the list
			{
				_next = 0
			}
			else //If there are more songs to go
			{
				_next = MusicPlayer.CurrentSongIndex + 1
			}
		}
		
		MusicPlayer.CurrentSongIndex = _next //song position
		
		"\![raise,OnMusicPlayer.PlaySong,%(MusicPlayer.CurrentSongIndex),""%(_from)""]"
	}
	else //No more songs to play
	{
		"\![raise,OnMusicPlayer.StopSong,""%(_from)""]"
	}
}

//The user pressed a hotkey or menu option to go to the previous song
OnMusicPlayer.PrevSong : all
{
	//reference0 is which menu this is coming from

	MusicPlayer.PlayState = 1
	
	_from = reference0
	if _from == ""; _from = MusicPlayer.CheckWhichMenu //Sent to OnMusicPlayer.PlaySong
	
	_next = 0
	
	if MusicPlayer.MenuIsOpen; "\C"
	"\![no-autopause]"
	
	"\![sound,stop]"
	
	_diff = GETSECCOUNT - MusicPlayer.SongStartTime
	
	_restart_song = 0
	if MusicPlayer.PreviousButton == "Restarts song" && _diff > 3; _restart_song = 1
	
	if ARRAYSIZE(MusicPlayer.CurrentPlaylist) > 0 || _restart_song //Songs available to play
	{
		if _restart_song
		{
			if MusicPlayer.PlayingRemovedSong
			{
				"\![raise,OnMusicPlayer.PlaySong,%(MusicPlayer.CurrentSongIndex),""%(_from)"",replay removed song]"
				return
			}
			else; _next = MusicPlayer.CurrentSongIndex
		}
		else
		{
			if MusicPlayer.PlayMode == 4 //Random
			{
				_next = RAND(ARRAYSIZE(MusicPlayer.CurrentPlaylist))
			}
			elseif MusicPlayer.PlayMode == 1 //Shuffle and loop
			{
				if MusicPlayer.ShuffledIndex <= 0 //If this was the last song on the list
				{
					MusicPlayer.ShuffledIndex = ARRAYSIZE(MusicPlayer.CurrentPlaylist) - 1
				}
				else //If there are more songs to go
				{
					MusicPlayer.ShuffledIndex--
				}
				_next = MusicPlayer.ShuffledPlaylist[MusicPlayer.ShuffledIndex]
			}
			else //Looping the list normally
			{
				if MusicPlayer.CurrentSongIndex <= 0 //If this was the last song on the list
				{
					_next = ARRAYSIZE(MusicPlayer.CurrentPlaylist) - 1
				}
				elseif MusicPlayer.PlayingRemovedSong //For removed songs, we're already on the right index
				{
					_next = MusicPlayer.CurrentSongIndex
				}
				else //If there are more songs to go
				{
					_next = MusicPlayer.CurrentSongIndex - 1
				}
			}
		}
		
		MusicPlayer.CurrentSongIndex = _next //song position
		
		"\![raise,OnMusicPlayer.PlaySong,%(MusicPlayer.CurrentSongIndex),""%(_from)""]"
	}
	else //No songs available to play
	{
		"\![raise,OnMusicPlayer.StopSong,""%(_from)""]"
	}
}

//Removing a song from the current playlist
OnMusicPlayer.RemoveSong : all
{
	_origmax = MusicPlayer.MaxPages
	MusicPlayer.LastRemovedSong = MusicPlayer.CurrentSongPath
	
	if MusicPlayer.PlayState == 2 && reference0 == MusicPlayer.CurrentSongIndex; MusicPlayer.PlayState = 0 //If the song being removed was the paused song, clear it
	MusicPlayer.CurrentPlaylist[reference0] = IARRAY //Clear the song that we want to remove
	
	//Special handling for if the currently playing song was deleted, or if one earlier in the playlist was deleted and the numbers need to change
	if reference0 == MusicPlayer.CurrentSongIndex
	{
		//"Shuffle and loop" and "Loop playlist" need to carry on in the same order, "Play one song" and "Random" don't care, and "Loop one song" should stop
		if MusicPlayer.PlayMode == 0 || MusicPlayer.PlayMode == 1; MusicPlayer.CurrentSongIndex--
		else; MusicPlayer.CurrentSongIndex = -1
		
		MusicPlayer.PlayingRemovedSong = 1
	}
	elseif reference0 < MusicPlayer.CurrentSongIndex; MusicPlayer.CurrentSongIndex--
	
	if MusicPlayer.CurrentSongPath == MusicPlayer.CurrentPlaylist[reference0] //If the song being removed is being played, remove it from the shuffle list
	{
		MusicPlayer.ShuffledPlaylist = MusicPlayer.ShufflePlaylist('|removed|',MusicPlayer.CurrentPlaylist) //Send a placeholder for the song that was already removed, and shuffle the playlist
	}
	else //If another song is playing
	{
		MusicPlayer.ShuffledPlaylist = MusicPlayer.ShufflePlaylist(MusicPlayer.CurrentSongIndex,MusicPlayer.CurrentPlaylist) //Shuffle with the current song as 1
	}
	
	if _origmax > MusicPlayer.MaxPages && MusicPlayer.PageIndex == _origmax
	{
		if _origmax > 0; MusicPlayer.PageIndex--
	}
	
	"\C\![no-autopause]%(OnMusicPlayer.NotifySongInfo)\![raise,OnMusicPlayer.Menu]"
}

OnMusicPlayer.PlaylistPage
{
	if reference0 == "next"; MusicPlayer.PageIndex++
	else; MusicPlayer.PageIndex--
	
	if MusicPlayer.PageIndex > MusicPlayer.MaxPages; MusicPlayer.PageIndex = MusicPlayer.MaxPages
	if MusicPlayer.PageIndex < 0; MusicPlayer.PageIndex = 0
	
	OnMusicPlayer.Menu
}

OnMusicPlayer.JumpToPlaylistPage : all
{
	"\C\![lock,balloonrepaint]\c%(MusicPlayer.Scope)%(MusicPlayer.LargeBalloon)\![quicksection,1]\![set,autoscroll,disable]\![no-autopause]"
	"\![open,inputbox,OnMusicPlayer.JumpIndex,-1,__INPUT_BOX_COLOR__]"
	
	//DIALOGUE: Typing in a page number to jump to manually in the playlist
	"Write a page number to jump to, from 1 to %(MusicPlayer.MaxPages + 1)"
	"\n\n"
	"\![*]\__q[OnMusicPlayer.JumpToCurrent]Jump to location of current song\__q"
	"\n\n"
	"\![*]\__q[OnMusicPlayer.JumpBack]Back\__q"
	
	"\![unlock,balloonrepaint]"
}

OnMusicPlayer.JumpIndex : all
{
	_num = reference0 - 1
	if GETTYPE(reference0) == 1 && (_num >= 0 && _num <= MusicPlayer.MaxPages)
	{
		MusicPlayer.PageIndex = _num
		
		OnMusicPlayer.Menu
	}
	else
	{
		//DIALOGUE: Putting in an invalid number, or something that isn't a number
		"%(MusicPlayer.Scope)%(MusicPlayer.LargeBalloon)\![quicksection,1]\![set,autoscroll,disable]\![no-autopause]"
		"Invalid input.\x\![raise,OnMusicPlayer.JumpToPlaylistPage]"
	}
}

OnMusicPlayer.JumpToCurrent
{
	MusicPlayer.PageIndex = MusicPlayer.CurrentSongIndex / MusicPlayer.SongsPerPage
	
	"\C\![close,inputbox,OnMusicPlayer.JumpIndex]\![raise,OnMusicPlayer.Menu]"
}

OnMusicPlayer.JumpBack
{
	"\C\![close,inputbox,OnMusicPlayer.JumpIndex]\![raise,OnMusicPlayer.Menu]"
}

//Open the folder of the currently playing song
OnMusicPlayer.SongLocation
{
	_path = SPLITPATH(reference0)[0] + SPLITPATH(reference0)[1]
	_path = ERASE(_path,STRLEN(_path) - 1,1) //Erases the last backslash
	
	"\C\![open,explorer,""%(reference0)""]\![raise,OnMusicPlayer.Menu]"
}

//Settings menu
OnMusicPlayer.Settings : all
{
	MusicPlayer.ResetDefaultSettings
	if reference0 != ""; MusicPlayer.LastMenuTab = reference0
	else; reference0 = MusicPlayer.LastMenuTab
	_isbasic = 0
	if !(reference0 == "Advanced" || reference0 == "Playlists" || reference0 == "Hotkeys"); _isbasic = 1
	
	"\C%(MusicPlayer.Scope)\![lock,balloonrepaint]\c\![set,autoscroll,disable]\![no-autopause]\![quicksection,1]\*%(MusicPlayer.LargeBalloon)\f[anchorvisitedfontcolor,default.anchor]"
	
	_basic = ""
	_advanced = ""
	_playlists = ""
	_hotkeys = ""
	
	//TODO TRANSLATION this is new
	if language == "Placeholder" //TRANSLATORS: These are the tabs for the different pages of the settings menu!
	{
		
	}
	elseif language == "Español"
	{
		_basic = "Básico"
		_advanced = "Avanzado"
		_playlists = "Listas de Reproducción"
		_hotkeys = "Atajos de teclado"
	}
	elseif language == "Deutsch"
	{
		_basic = "Basic"
		_advanced = "Advanced"
		_playlists = "Playlists"
		_hotkeys = "Hotkeys"
	}
	elseif language == "Русский"
	{
		_basic = "Основные"
		_advanced = "Передовые"
		_playlists = "Плэйлисты"
		_hotkeys = "Горячие Клавиши"
	}
	elseif language == "Français"
	{
		_basic = "Basic"
		_advanced = "Advanced"
		_playlists = "Playlists"
		_hotkeys = "Hotkeys"
	}
	elseif language == "Polski"
	{
		_basic = "Basic"
		_advanced = "Advanced"
		_playlists = "Playlists"
		_hotkeys = "Hotkeys"
	}
	else //English
	{
		_basic = "Basic"
		_advanced = "Advanced"
		_playlists = "Playlists"
		_hotkeys = "Hotkeys"
	}
	
	
	_g = "\f[color,disable]"
	_d = "\f[color,default]"
	
	"\![*]"
	switch _isbasic
	{
		"%(_g)\__q[OnMusicPlayer.Settings,Basic]%(_basic)\__q%(_d)"
		"\__q[OnMusicPlayer.Settings,Basic]%(_basic)\__q"
	}
	"  \![*]"
	switch reference0 == "Advanced"
	{
		"%(_g)\__q[OnMusicPlayer.Settings,Advanced]%(_advanced)\__q%(_d)"
		"\__q[OnMusicPlayer.Settings,Advanced]%(_advanced)\__q"
	}
	"\n\![*]"
	switch reference0 == "Playlists"
	{
		"%(_g)\__q[OnMusicPlayer.Settings,Playlists]%(_playlists)\__q%(_d)"
		"\__q[OnMusicPlayer.Settings,Playlists]%(_playlists)\__q"
	}
	"  \![*]"
	switch reference0 == "Hotkeys"
	{
		"%(_g)\__q[OnMusicPlayer.Settings,Hotkeys]%(_hotkeys)\__q%(_d)"
		"\__q[OnMusicPlayer.Settings,Hotkeys]%(_hotkeys)\__q"
	}
	"\n\n"
	
	if reference0 == "Advanced"; MusicPlayer.Settings.Advanced
	elseif reference0 == "Playlists"; MusicPlayer.Settings.Playlists
	elseif reference0 == "Hotkeys"; MusicPlayer.Settings.Hotkeys
	else; MusicPlayer.Settings.Basic
	
	"\n\n"
	
	if language == "Placeholder" //TRANSLATORS: Back/close buttons for the settings menu
	{
		
	}
	elseif language == "Español"
	{
		"\![*]\__q[OnMusicPlayer.Menu]Volver a Controles de Música\__q  \![*]\__q[OnMusicPlayer.SettingsClose]Cerrar ventana\__q"
	}
	elseif language == "Deutsch"
	{
		"\![*]\__q[OnMusicPlayer.Menu]Zurück zum Musikmenü\__q  \![*]\__q[OnMusicPlayer.SettingsClose]Fenster schließen\__q"
	}
	elseif language == "Русский"
	{
		"\![*]\__q[OnMusicPlayer.Menu]Назад в меню музыкы\__q  \![*]\__q[OnMusicPlayer.SettingsClose]Закрыть Окно\__q"
	}
	elseif language == "Français"
	{
		"\![*]\__q[OnMusicPlayer.Menu]Retour au menu des musiques\__q  \![*]\__q[OnMusicPlayer.SettingsClose]Fermer la fenêtre\__q"
	}
	elseif language == "Polski"
	{
		"\![*]\__q[OnMusicPlayer.Menu]Powrót do menu muzycznego\__q  \![*]\__q[OnMusicPlayer.SettingsClose]Zamknij\__q"
	}
	else //English
	{
		"\![*]\__q[OnMusicPlayer.Menu]Back to music menu\__q  \![*]\__q[OnMusicPlayer.SettingsClose]Close window\__q"
	}
	
	
	"\![unlock,balloonrepaint]"
	if SHIORI3FW.BalloonName == "Notes" || SHIORI3FW.BalloonName == "Notes (Light)"
	{
		if _isbasic && MusicPlayer.Singing; "\![timerraise,1000,1,OnMusicPlayer.SettingsRecall]"
	}
	"\e __MUSIC_SETTINGS_MENU__,%(_isbasic)__"
}

OnMusicPlayer.SettingsRecall
{
	if "__MUSIC_SETTINGS_MENU__,1__" _in_ MusicPlayer.LastTalk
	{
		OnMusicPlayer.Settings
	}
}

OnMusicPlayer.SettingsClose
{
	"\b[-1]\![timerraise,0,1,OnMusicPlayer.SettingsRecall]"
}

MusicPlayer.Settings.Basic : all
{
	_h = "\f[color,default.anchor]"
	_g = "\f[color,disable]"
	_d = "\f[color,default]"
	
	_mode = MusicPlayer.PlayMode
	_vol = MusicPlayer.Volume
	_speed = MusicPlayer.Speed
	_bal = MusicPlayer.Balance
	
	//▲▼⯇⯈ - buttons for ease of copying
	//Setting fonts so we don't get tofus or anything else weird...
	_up = "\f[name,calibri]▲\f[name,default]"
	_down = "\f[name,calibri]▼\f[name,default]"
	_left = "\f[name,calibri]⯇\f[name,default]"
	_right = "\f[name,calibri]⯈\f[name,default]"
	
	//Doing this here so that the menu bit itself can be cleaner... This is just handling graying out the buttons if clicking them would do nothing.
	_vol_up_btn = "\__q[OnMusicPlayer.QuickVolume,Up]%(_up)\__q"
	if MusicPlayer.Volume >= 100; _vol_up_btn = "%(_g)%(_up)%(_d)"
	_vol_down_btn = "\__q[OnMusicPlayer.QuickVolume,Down]%(_down)\__q"
	if MusicPlayer.Volume <= 0; _vol_down_btn = "%(_g)%(_down)%(_d)"
	
	_speed_up_btn = "\__q[OnMusicPlayer.QuickSpeed,Up]%(_up)\__q"
	if MusicPlayer.Speed >= MusicPlayer.MaxRate; _speed_up_btn = "%(_g)%(_up)%(_d)"
	_speed_down_btn = "\__q[OnMusicPlayer.QuickSpeed,Down]%(_down)\__q"
	if MusicPlayer.Speed <= 0; _speed_down_btn = "%(_g)%(_down)%(_d)"
	
	_balance_left_btn = "\__q[OnMusicPlayer.QuickBalance,Left]%(_left)\__q"
	if MusicPlayer.Balance <= -100; _balance_left_btn = "%(_g)%(_left)%(_d)"
	_balance_right_btn = "\__q[OnMusicPlayer.QuickBalance,Right]%(_right)\__q"
	if MusicPlayer.Balance >= 100; _balance_right_btn = "%(_g)%(_right)%(_d)"
	
	if language == "Placeholder" //TRANSLATORS: The basic page of the settings menu
	{
		
	}
	elseif language == "Español"
	{
		if _mode == 1; _mode = "Aleatorio y Repetir"
		elseif _mode == 2; _mode = "Repetir pista"
		elseif _mode == 3; _mode = "Reproducir pista"
		elseif _mode == 4; _mode = "Aleatorio"
		else; _mode = "Repetir Lista de reproducción"
		
		"Tipo de reproducción: \![*]\_a[OnMusicPlayer.PlaybackType]%(_mode)\_a\n\n[half]"
		"Volumen: %(_vol_up_btn)%(_vol_down_btn) \_a[OnMusicPlayer.SetOption,Volume]%(_vol)\_a\n"
		"Velocidad: %(_speed_up_btn)%(_speed_down_btn) \_a[OnMusicPlayer.SetOption,Speed]%(_speed)\_a\n"
		"Balance izda./dcha.: %(_balance_left_btn)%(_balance_right_btn) \_a[OnMusicPlayer.SetOption,Balance]%(_bal)\_a\n\n"
		
		switch MusicPlayer.PlayMode != 3
		{
			"\f[color,disable]Detener después de pista actual\f[color,default]"
			"\__q[OnMusicPlayer.StopAfterPlayback,song]Detener después de pista actual\__q"
		}
		if MusicSettings[4] == "stop after playback"; " \![*]"
		"\n"
		switch MusicPlayer.PlayMode == 0 || MusicPlayer.PlayMode == 1 //TODO new translation
		{
			"\f[color,disable]Parar después de que acabe la lista de reproducción\f[color,default]"
			"\__q[OnMusicPlayer.StopAfterPlayback,playlist]Parar después de que acabe la lista de reproducción\__q"
		}
		if MusicPlayer.StopAfterCurrent == "stop after playlist"; " \![*]"
		
		"\n\n"
		"Tiempo total de reproducción:\n" //TODO new translation
		"%(MusicPlayer.DisplayPlaytime(MusicPlayer.Playtime))"
	}
	elseif language == "Deutsch"
	{
		if _mode == 1; _mode = "Playlist shuffeln und wiederholen"
		elseif _mode == 2; _mode = "Ein Lied auf Wiederholung spielen"
		elseif _mode == 3; _mode = "Ein einzelnes Lied spielen"
		elseif _mode == 4; _mode = "Random" //TODO new translation
		else; _mode = "Playlist wiederholen"
		
		//Only the labels on the left here need translated
		"Wiedergabemodus: \![*]\_a[OnMusicPlayer.PlaybackType]%(_mode)\_a\n\n[half]"
		"Lautstärke: %(_vol_up_btn)%(_vol_down_btn) \_a[OnMusicPlayer.SetOption,Volume]%(_vol)\_a\n"
		"Geschwindigkeit: %(_speed_up_btn)%(_speed_down_btn) \_a[OnMusicPlayer.SetOption,Speed]%(_speed)\_a\n"
		"Balance: %(_balance_left_btn)%(_balance_right_btn) \_a[OnMusicPlayer.SetOption,Balance]%(_bal)\_a\n\n" //TODO balance here should be left/right balance now
		
		switch MusicPlayer.PlayMode != 3
		{
			"\f[color,disable]Wiedergabe nach derzeitigem Lied anhalten\f[color,default]"
			"\__q[OnMusicPlayer.StopAfterPlayback,song]Wiedergabe nach derzeitigem Lied anhalten\__q"
		}
		if MusicPlayer.StopAfterCurrent == "stop after playback"; " \![*]"
		"\n"
		switch MusicPlayer.PlayMode == 0 || MusicPlayer.PlayMode == 1 //TODO new translation
		{
			"\f[color,disable]Stop after playlist ends\f[color,default]"
			"\__q[OnMusicPlayer.StopAfterPlayback,playlist]Stop after playlist ends\__q"
		}
		if MusicPlayer.StopAfterCurrent == "stop after playlist"; " \![*]"
		
		"\n\n"
		"Total playtime:\n" //TODO new translation
		"%(MusicPlayer.DisplayPlaytime(MusicPlayer.Playtime))"
	}
	elseif language == "Русский"
	{
		if _mode == 1; _mode = "Перетасуй и Играй по Кругу"
		elseif _mode == 2; _mode = "Играй Одна Песня по Кругу"
		elseif _mode == 3; _mode = "Играй Одна Песня"
		elseif _mode == 4; _mode = "Random" //TODO new translation
		else; _mode = "Играй Плейлист по Кругу"
		
		//Only the labels on the left here need translated
		"Режим: \![*]\_a[OnMusicPlayer.PlaybackType]%(_mode)\_a\n\n[half]"
		"Громкость: %(_vol_up_btn)%(_vol_down_btn) \_a[OnMusicPlayer.SetOption,Volume]%(_vol)\_a\n"
		"Скорость: %(_speed_up_btn)%(_speed_down_btn) \_a[OnMusicPlayer.SetOption,Speed]%(_speed)\_a\n"
		"Баланс левой/правой: %(_balance_left_btn)%(_balance_right_btn) \_a[OnMusicPlayer.SetOption,Balance]%(_bal)\_a\n\n"
		
		switch MusicPlayer.PlayMode != 3
		{
			"\f[color,disable]Стоп после эта песня\f[color,default]"
			"\__q[OnMusicPlayer.StopAfterPlayback,song]Стоп после эта песня\__q"
		}
		if MusicPlayer.StopAfterCurrent == "stop after playback"; " \![*]"
		"\n"
		switch MusicPlayer.PlayMode == 0 || MusicPlayer.PlayMode == 1 //TODO new translation
		{
			"\f[color,disable]Стоп после конец плэйлиста\f[color,default]"
			"\__q[OnMusicPlayer.StopAfterPlayback,playlist]Стоп после конец плэйлиста\__q"
		}
		if MusicPlayer.StopAfterCurrent == "stop after playlist"; " \![*]"
		
		"\n\n"
		"Итог час проигрование песни:\n" //TODO new translation
		"%(MusicPlayer.DisplayPlaytime(MusicPlayer.Playtime))"
	}
	elseif language == "Français"
	{
		if _mode == 1; _mode = "Mélangée et en Boucle"
		elseif _mode == 2; _mode = "Boucler sur une Musique"
		elseif _mode == 3; _mode = "Lire Une Musique"
		elseif _mode == 4; _mode = "Random" //TODO new translation
		else; _mode = "Playlist en Boucle"
		
		//Only the labels on the left here need translated
		"Mode de lecture : \![*]\_a[OnMusicPlayer.PlaybackType]%(_mode)\_a\n\n[half]"
		"Volume : %(_vol_up_btn)%(_vol_down_btn) \_a[OnMusicPlayer.SetOption,Volume]%(_vol)\_a\n"
		"Vitesse : %(_speed_up_btn)%(_speed_down_btn) \_a[OnMusicPlayer.SetOption,Speed]%(_speed)\_a\n"
		"Balance : %(_balance_left_btn)%(_balance_right_btn) \_a[OnMusicPlayer.SetOption,Balance]%(_bal)\_a\n\n" //TODO balance here should be left/right balance now
		
		switch MusicPlayer.PlayMode != 3
		{
			"\f[color,disable]Arrêter après la musique actuelle\f[color,default]"
			"\__q[OnMusicPlayer.StopAfterPlayback,song]Arrêter après la musique actuelle\__q"
		}
		if MusicPlayer.StopAfterCurrent == "stop after playback"; " \![*]"
		"\n"
		switch MusicPlayer.PlayMode == 0 || MusicPlayer.PlayMode == 1 //TODO new translation
		{
			"\f[color,disable]Stop after playlist ends\f[color,default]"
			"\__q[OnMusicPlayer.StopAfterPlayback,playlist]Stop after playlist ends\__q"
		}
		if MusicPlayer.StopAfterCurrent == "stop after playlist"; " \![*]"
		
		"\n\n"
		"Total playtime:\n" //TODO new translation
		"%(MusicPlayer.DisplayPlaytime(MusicPlayer.Playtime))"
	}
	elseif language == "Polski"
	{
		if _mode == 1; _mode = "Miksuj i Zapętl"
		elseif _mode == 2; _mode = "Zapętl Jedną Piosenkę"
		elseif _mode == 3; _mode = "Zagraj Jedną Piosenkę"
		elseif _mode == 4; _mode = "Random" //TODO new translation
		else; _mode = "Zapętlij Playlistę"
		
		//Only the labels on the left here need translated
		"Tryb odtwarzania: \![*]\_a[OnMusicPlayer.PlaybackType]%(_mode)\_a\n\n[half]"
		"Głośność: %(_vol_up_btn)%(_vol_down_btn) \_a[OnMusicPlayer.SetOption,Volume]%(_vol)\_a\n"
		"Prędkość: %(_speed_up_btn)%(_speed_down_btn) \_a[OnMusicPlayer.SetOption,Speed]%(_speed)\_a\n"
		"Balans: %(_balance_left_btn)%(_balance_right_btn) \_a[OnMusicPlayer.SetOption,Balance]%(_bal)\_a\n\n" //TODO balance here should be left/right balance now
		
		switch MusicPlayer.PlayMode != 3
		{
			"\f[color,disable]Zatrzymaj po bieżącym utworze\f[color,default]"
			"\__q[OnMusicPlayer.StopAfterPlayback,song]Zatrzymaj po bieżącym utworze\__q"
		}
		if MusicPlayer.StopAfterCurrent == "stop after playback"; " \![*]"
		"\n"
		switch MusicPlayer.PlayMode == 0 || MusicPlayer.PlayMode == 1 //TODO new translation
		{
			"\f[color,disable]Stop after playlist ends\f[color,default]"
			"\__q[OnMusicPlayer.StopAfterPlayback,playlist]Stop after playlist ends\__q"
		}
		if MusicPlayer.StopAfterCurrent == "stop after playlist"; " \![*]"
		
		"\n\n"
		"Total playtime:\n" //TODO new translation
		"%(MusicPlayer.DisplayPlaytime(MusicPlayer.Playtime))"
	}
	else //English
	{
		if _mode == 1; _mode = "Shuffle and Loop"
		elseif _mode == 2; _mode = "Loop One Song"
		elseif _mode == 3; _mode = "Play One Song"
		elseif _mode == 4; _mode = "Random"
		else; _mode = "Loop Playlist"
	
		//Only the labels on the left here need translated
		"Play mode: \![*]\_a[OnMusicPlayer.PlaybackType]%(_mode)\_a\n\n[half]"
		"Volume: %(_vol_up_btn)%(_vol_down_btn) \_a[OnMusicPlayer.SetOption,Volume]%(_vol)\_a\n"
		"Speed: %(_speed_up_btn)%(_speed_down_btn) \_a[OnMusicPlayer.SetOption,Speed]%(_speed)\_a\n"
		"Left/right balance: %(_balance_left_btn)%(_balance_right_btn) \_a[OnMusicPlayer.SetOption,Balance]%(_bal)\_a\n\n"
		
		switch MusicPlayer.PlayMode != 3
		{
			"\f[color,disable]Stop after current song\f[color,default]"
			"\__q[OnMusicPlayer.StopAfterPlayback,song]Stop after current song\__q"
		}
		if MusicPlayer.StopAfterCurrent == "stop after playback"; " \![*]"
		"\n"
		switch MusicPlayer.PlayMode == 0 || MusicPlayer.PlayMode == 1
		{
			"\f[color,disable]Stop after playlist ends\f[color,default]"
			"\__q[OnMusicPlayer.StopAfterPlayback,playlist]Stop after playlist ends\__q"
		}
		if MusicPlayer.StopAfterCurrent == "stop after playlist"; " \![*]"
		
		"\n\n"
		"Total playtime:\n"
		"%(MusicPlayer.DisplayPlaytime(MusicPlayer.Playtime))"
	}
}

MusicPlayer.Settings.Advanced : all
{
	//TODO TRANSLATION new translations needed for most of this menu
	if language == "Placeholder" //TRANSLATORS: The advanced page of the settings menu
	{
		
	}
	elseif language == "Español"
	{
		"Barra de reproducción \![*]\_a[OnMusicPlayer.ToggleSongBar]%(offon[MusicPlayer.SongBar])\_a\n"
		"Descripción sobre puntos de interés \![*]\_a[OnMusicPlayer.ToggleTooltips]%(offon[MusicPlayer.Tooltips])\_a\n"
		"\n"
		"Anunciamiento de las pistas \![*]\_a[OnMusicPlayer.ToggleSongAnnouncement]%(label.songannouncement)\_a\n"
		"Priorizar \![*]\_a[OnMusicPlayer.TogglePriority]%(label.prioritize)\_a\n"
		"\n"
		"Rueda de desplazamiento controla \![*]\_a[OnMusicPlayer.ToggleScrollWheel]%(label.scrollwheelcontrols)\_a\n"
		"Botón de retroceso \![*]\_a[OnMusicPlayer.TogglePreviousButton]%(label.previousbutton)\_a\n"
		"\n"
		"Vista de lista de reproducción \![*]\_a[OnMusicPlayer.TogglePagination]%(label.playlistview)\_a\n"
		"\n"
		"\![*]\__q[OnMusicPlayer.ScootSongMenuWarn]Mover pistas en lista de reproducción\__q"
		
		"\n\n"
		"¿Mostrar pista y shell actual en Discord? %(br)\_a[OnMusicPlayer.ToggleDiscordPlugin]%(offon[MusicPlayer.DiscordDisplay])\_a \__q[OnDiscordPluginInfo](Info.)\__q"
	}
	elseif language == "Deutsch"
	{
		"Song Bar \![*]\_a[OnMusicPlayer.ToggleSongBar]%(offon[MusicPlayer.SongBar])\_a\n"
		"Hotspot tooltips \![*]\_a[OnMusicPlayer.ToggleTooltips]%(offon[MusicPlayer.Tooltips])\_a\n"
		"\n"
		"Song announcements \![*]\_a[OnMusicPlayer.ToggleSongAnnouncement]%(label.songannouncement)\_a\n"
		"Prioritize \![*]\_a[OnMusicPlayer.TogglePriority]%(label.prioritize)\_a\n"
		"\n"
		"Scroll wheel controls \![*]\_a[OnMusicPlayer.ToggleScrollWheel]%(label.scrollwheelcontrols)\_a\n"
		"Previous button \![*]\_a[OnMusicPlayer.TogglePreviousButton]%(label.previousbutton)\_a\n"
		"\n"
		"Playlist view \![*]\_a[OnMusicPlayer.TogglePagination]%(label.playlistview)\_a\n"
		"\n"
		"\![*]\__q[OnMusicPlayer.ScootSongMenuWarn]Move songs in playlist\__q"
		
		"\n\n"
		"Derzeitiges Lied und derzeitige Shell auf Discord anzeigen? \_a[OnMusicPlayer.ToggleDiscordPlugin]%(offon[MusicPlayer.DiscordDisplay])\_a \__q[OnDiscordPluginInfo](Info)\__q"
	}
	elseif language == "Русский"
	{
		"Строка песни \![*]\_a[OnMusicPlayer.ToggleSongBar]%(offon[MusicPlayer.SongBar])\_a\n"
		"Тултипы горячие места \![*]\_a[OnMusicPlayer.ToggleTooltips]%(offon[MusicPlayer.Tooltips])\_a\n"
		"\n"
		"Объявления песни \![*]\_a[OnMusicPlayer.ToggleSongAnnouncement]%(label.songannouncement)\_a\n"
		"Дай приоритет \![*]\_a[OnMusicPlayer.TogglePriority]%(label.prioritize)\_a\n"
		"\n"
		"Контролы колесо покруткы \![*]\_a[OnMusicPlayer.ToggleScrollWheel]%(label.scrollwheelcontrols)\_a\n"
		"Кнопка назад \![*]\_a[OnMusicPlayer.TogglePreviousButton]%(label.previousbutton)\_a\n"
		"\n"
		"Вид плэйлист \![*]\_a[OnMusicPlayer.TogglePagination]%(label.playlistview)\_a\n"
		"\n"
		"\![*]\__q[OnMusicPlayer.ScootSongMenuWarn]Переместить песни в плэйлисте\__q"
		
		"\n\n"
		"Показать текушие песни и вид в Discord? \_a[OnMusicPlayer.ToggleDiscordPlugin]%(offon[MusicPlayer.DiscordDisplay])\_a%(br)\__q[OnDiscordPluginInfo](Инфо)\__q"
	}
	elseif language == "Français"
	{
		"Song Bar \![*]\_a[OnMusicPlayer.ToggleSongBar]%(offon[MusicPlayer.SongBar])\_a\n"
		"Hotspot tooltips \![*]\_a[OnMusicPlayer.ToggleTooltips]%(offon[MusicPlayer.Tooltips])\_a\n"
		"\n"
		"Song announcements \![*]\_a[OnMusicPlayer.ToggleSongAnnouncement]%(label.songannouncement)\_a\n"
		"Prioritize \![*]\_a[OnMusicPlayer.TogglePriority]%(label.prioritize)\_a\n"
		"\n"
		"Scroll wheel controls \![*]\_a[OnMusicPlayer.ToggleScrollWheel]%(label.scrollwheelcontrols)\_a\n"
		"Previous button \![*]\_a[OnMusicPlayer.TogglePreviousButton]%(label.previousbutton)\_a\n"
		"\n"
		"Playlist view \![*]\_a[OnMusicPlayer.TogglePagination]%(label.playlistview)\_a\n"
		"\n"
		"\![*]\__q[OnMusicPlayer.ScootSongMenuWarn]Move songs in playlist\__q"
		
		"\n\n"
		"Show current song and shell in Discord? \_a[OnMusicPlayer.ToggleDiscordPlugin]%(offon[MusicPlayer.DiscordDisplay])\_a \__q[OnDiscordPluginInfo](Info)\__q"
	}
	elseif language == "Polski"
	{
		"Song Bar \![*]\_a[OnMusicPlayer.ToggleSongBar]%(offon[MusicPlayer.SongBar])\_a\n"
		"Hotspot tooltips \![*]\_a[OnMusicPlayer.ToggleTooltips]%(offon[MusicPlayer.Tooltips])\_a\n"
		"\n"
		"Song announcements \![*]\_a[OnMusicPlayer.ToggleSongAnnouncement]%(label.songannouncement)\_a\n"
		"Prioritize \![*]\_a[OnMusicPlayer.TogglePriority]%(label.prioritize)\_a\n"
		"\n"
		"Scroll wheel controls \![*]\_a[OnMusicPlayer.ToggleScrollWheel]%(label.scrollwheelcontrols)\_a\n"
		"Previous button \![*]\_a[OnMusicPlayer.TogglePreviousButton]%(label.previousbutton)\_a\n"
		"\n"
		"Playlist view \![*]\_a[OnMusicPlayer.TogglePagination]%(label.playlistview)\_a\n"
		"\n"
		"\![*]\__q[OnMusicPlayer.ScootSongMenuWarn]Move songs in playlist\__q"
		
		"\n\n"
		"Wyświetlaj bieżący utwór i skorupę na Discordzie? \_a[OnMusicPlayer.ToggleDiscordPlugin]%(offon[MusicPlayer.DiscordDisplay])\_a \__q[OnDiscordPluginInfo](Info)\__q"
	}
	else //English
	{
		"Song Bar \![*]\_a[OnMusicPlayer.ToggleSongBar]%(offon[MusicPlayer.SongBar])\_a\n"
		"Hotspot tooltips \![*]\_a[OnMusicPlayer.ToggleTooltips]%(offon[MusicPlayer.Tooltips])\_a\n"
		"\n"
		"Song announcements \![*]\_a[OnMusicPlayer.ToggleSongAnnouncement]%(label.songannouncement)\_a\n"
		"Prioritize \![*]\_a[OnMusicPlayer.TogglePriority]%(label.prioritize)\_a\n"
		"\n"
		"Scroll wheel controls \![*]\_a[OnMusicPlayer.ToggleScrollWheel]%(label.scrollwheelcontrols)\_a\n"
		"Previous button \![*]\_a[OnMusicPlayer.TogglePreviousButton]%(label.previousbutton)\_a\n"
		"\n"
		"Playlist view \![*]\_a[OnMusicPlayer.TogglePagination]%(label.playlistview)\_a\n"
		"\n"
		"\![*]\__q[OnMusicPlayer.ScootSongMenuWarn]Move songs in playlist\__q"
		
		"\n\n"
		"Show current song and shell in Discord? \_a[OnMusicPlayer.ToggleDiscordPlugin]%(offon[MusicPlayer.DiscordDisplay])\_a \__q[OnDiscordPluginInfo](Info)\__q"
	}
}

label.songannouncement
{
	if MusicPlayer.SongAnnouncement == 0
	{
		onoff[1]
		return
	}
	
	if language == "Placeholder" //TRANSLATORS: This button is for the "Scroll wheel controls" option. In English it's written like "Scroll wheel controls [volume]", where [volume] is a clickable choice
	{
		
	}
	elseif language == "Español"
	{
		if MusicPlayer.SongAnnouncement == 1; "If not talking"
		elseif MusicPlayer.SongAnnouncement == 2; "If not in menu"
	}
	elseif language == "Deutsch"
	{
		if MusicPlayer.SongAnnouncement == 1; "If not talking"
		elseif MusicPlayer.SongAnnouncement == 2; "If not in menu"
	}
	elseif language == "Русский"
	{
		if MusicPlayer.SongAnnouncement == 1; "если не говорить"
		elseif MusicPlayer.SongAnnouncement == 2; "если не в меню"
	}
	elseif language == "Français"
	{
		if MusicPlayer.SongAnnouncement == 1; "If not talking"
		elseif MusicPlayer.SongAnnouncement == 2; "If not in menu"
	}
	elseif language == "Polski"
	{
		if MusicPlayer.SongAnnouncement == 1; "If not talking"
		elseif MusicPlayer.SongAnnouncement == 2; "If not in menu"
	}
	else //English
	{
		if MusicPlayer.SongAnnouncement == 1; "If not talking"
		elseif MusicPlayer.SongAnnouncement == 2; "If not in menu"
	}
}


label.prioritize
{
	if language == "Placeholder" //TRANSLATORS: This button is for the "prioritize" option. In English it's written like "Prioritize [dialogue]", where [dialogue] is a clickable choice
	{
		
	}
	elseif language == "Español"
	{
		if MusicPlayer.Priority == 1; "Música sin cortes"
		else; "Diálogo"
	}
	elseif language == "Deutsch"
	{
		if MusicPlayer.Priority == 1; "Seamless music"
		else; "Dialogue"
	}
	elseif language == "Русский"
	{
		if MusicPlayer.Priority == 1; "Непрерывная музыка"
		else; "Диалог"
	}
	elseif language == "Français"
	{
		if MusicPlayer.Priority == 1; "Seamless music"
		else; "Dialogue"
	}
	elseif language == "Polski"
	{
		if MusicPlayer.Priority == 1; "Seamless music"
		else; "Dialogue"
	}
	else //English
	{
		if MusicPlayer.Priority == 1; "Seamless music"
		else; "Dialogue"
	}
}

label.scrollwheelcontrols
{
	if MusicPlayer.Scroll == -1
	{
		onoff[1]
		return
	}
	
	if language == "Placeholder" //TRANSLATORS: This button is for the "Scroll wheel controls" option. In English it's written like "Scroll wheel controls [volume]", where [volume] is a clickable choice
	{
		
	}
	elseif language == "Español"
	{
		if MusicPlayer.Scroll == 0; "Volúmen"
		elseif MusicPlayer.Scroll == 1; "Velocidad"
		elseif MusicPlayer.Scroll == 2; "Balance"
	}
	elseif language == "Deutsch"
	{
		if MusicPlayer.Scroll == 0; "Volume"
		elseif MusicPlayer.Scroll == 1; "Speed"
		elseif MusicPlayer.Scroll == 2; "Balance"
	}
	elseif language == "Русский"
	{
		if MusicPlayer.Scroll == 0; "Громкость"
		elseif MusicPlayer.Scroll == 1; "Скорость"
		elseif MusicPlayer.Scroll == 2; "Баланс"
	}
	elseif language == "Français"
	{
		if MusicPlayer.Scroll == 0; "Volume"
		elseif MusicPlayer.Scroll == 1; "Speed"
		elseif MusicPlayer.Scroll == 2; "Balance"
	}
	elseif language == "Polski"
	{
		if MusicPlayer.Scroll == 0; "Volume"
		elseif MusicPlayer.Scroll == 1; "Speed"
		elseif MusicPlayer.Scroll == 2; "Balance"
	}
	else //English
	{
		if MusicPlayer.Scroll == 0; "Volume"
		elseif MusicPlayer.Scroll == 1; "Speed"
		elseif MusicPlayer.Scroll == 2; "Balance"
	}
}

label.previousbutton
{
	if language == "Placeholder" //TRANSLATORS: This button is for the "Previous button" option. In English it's written like "Previous button [restarts song]", where [restarts song] is a clickable choice
	{
		
	}
	elseif language == "Español"
	{
		if MusicPlayer.PreviousButton == 1; "Ir a pista anterior"
		else; "Reiniciar pista"
	}
	elseif language == "Deutsch"
	{
		if MusicPlayer.PreviousButton == 1; "Goes to previous song"
		else; "Restarts song"
	}
	elseif language == "Русский"
	{
		if MusicPlayer.PreviousButton == 1; "Идёт в последную песню"
		else; "Перезапуск песни"
	}
	elseif language == "Français"
	{
		if MusicPlayer.PreviousButton == 1; "Goes to previous song"
		else; "Restarts song"
	}
	elseif language == "Polski"
	{
		if MusicPlayer.PreviousButton == 1; "Goes to previous song"
		else; "Restarts song"
	}
	else //English
	{
		if MusicPlayer.PreviousButton == 1; "Goes to previous song"
		else; "Restarts song"
	}
}

label.playlistview
{
	if language == "Placeholder" //TRANSLATORS: This button is for the "playlist view" option. In English it's written like "Playlist view [Paginated]", where [Paginated] is a clickable choice. "Paginated" is kind of a weird word I think, you can also use something like "split into pages" if that works better
	{
		
	}
	elseif language == "Español"
	{
		if MusicPlayer.Pagination == 0; "Una sola lista (más lento)"
		else; "Por páginas"
	}
	elseif language == "Deutsch"
	{
		if MusicPlayer.Pagination == 0; "One long list (slower)"
		else; "Paginated"
	}
	elseif language == "Русский"
	{
		if MusicPlayer.Pagination == 0; "Один долгий список (медленее)"
		else; "Разбиты на страницы"
	}
	elseif language == "Français"
	{
		if MusicPlayer.Pagination == 0; "One long list (slower)"
		else; "Paginated"
	}
	elseif language == "Polski"
	{
		if MusicPlayer.Pagination == 0; "One long list (slower)"
		else; "Paginated"
	}
	else //English
	{
		if MusicPlayer.Pagination == 0; "One long list (slower)"
		else; "Paginated"
	}
}


MusicPlayer.Settings.Playlists : all
{
	if language == "Placeholder" //TRANSLATORS: The playlist page of the settings menu
	{
		
	}
	elseif language == "Español"
	{
		"\![*]\__q[OnMusicPlayer.SavePlaylist]Guardar Lista de reproducción actual\__q\n"
		"\![*]\__q[OnMusicPlayer.LoadPlaylist]Cargar Lista de reproducción\__q\n"
		"\![*]\__q[OnMusicPlayer.ClearPlaylist]Vaciar Lista de reproducción actual\__q\n"
		"\n"
		"Longitud de lista de reproducción actual:\n%(ARRAYSIZE(MusicPlayer.CurrentPlaylist)) pistas"
	}
	elseif language == "Deutsch"
	{
		"\![*]\__q[OnMusicPlayer.SavePlaylist]Aktuelle Playlist speichern\__q\n"
		"\![*]\__q[OnMusicPlayer.LoadPlaylist]Playlist laden\__q\n"
		"\![*]\__q[OnMusicPlayer.ClearPlaylist]Aktuelle Playlist leeren\__q\n"
		"\n"
		"Length of current playlist:\n%(ARRAYSIZE(MusicPlayer.CurrentPlaylist)) songs" //TODO new translation
	}
	elseif language == "Русский"
	{
		"\![*]\__q[OnMusicPlayer.SavePlaylist]Сохранить этот плейлист\__q\n"
		"\![*]\__q[OnMusicPlayer.LoadPlaylist]Загрузить плейлист\__q\n"
		"\![*]\__q[OnMusicPlayer.ClearPlaylist]Отчистить этот плейлист\__q\n"
		"\n"
		"Длинность текуший плэйлист:\n%(ARRAYSIZE(MusicPlayer.CurrentPlaylist)) песни"
	}
	elseif language == "Français"
	{
		"\![*]\__q[OnMusicPlayer.SavePlaylist]Sauvegarder la playlist actuelle\__q\n"
		"\![*]\__q[OnMusicPlayer.LoadPlaylist]Charger une playlist\__q\n"
		"\![*]\__q[OnMusicPlayer.ClearPlaylist]Vider la playlist actuelle\__q\n"
		"\n"
		"Length of current playlist:\n%(ARRAYSIZE(MusicPlayer.CurrentPlaylist)) songs" //TODO new translation
	}
	elseif language == "Polski"
	{
		"\![*]\__q[OnMusicPlayer.SavePlaylist]Zapisz bieżącą playlistę\__q\n"
		"\![*]\__q[OnMusicPlayer.LoadPlaylist]Wczytaj playlistę\__q\n"
		"\![*]\__q[OnMusicPlayer.ClearPlaylist]Wyczyść bieżącą listę odtwarzania\__q\n"
		"\n"
		"Length of current playlist:\n%(ARRAYSIZE(MusicPlayer.CurrentPlaylist)) songs" //TODO new translation
	}
	else //English
	{
		"\![*]\__q[OnMusicPlayer.SavePlaylist]Save current playlist\__q\n"
		"\![*]\__q[OnMusicPlayer.LoadPlaylist]Load playlist\__q\n"
		"\![*]\__q[OnMusicPlayer.ClearPlaylist]Clear current playlist\__q\n"
		"\n"
		"Length of current playlist:\n%(ARRAYSIZE(MusicPlayer.CurrentPlaylist)) songs"
	}
}

//I added this later so it's in kind of a weird place...
label.PlaylistFile
{
	if language == "Placeholder" //TRANSLATORS: A translation for the little tab that'll appear in the explorer window where you load playlists from
	{
		
	}
	elseif language == "Español"
	{
		"Archivo de lista de reproducción"
	}
	elseif language == "Deutsch"
	{
		"Playlist file"
	}
	elseif language == "Русский"
	{
		"Файл плэйлист"
	}
	elseif language == "Français"
	{
		"Playlist file"
	}
	elseif language == "Polski"
	{
		"Playlist file"
	}
	else //English
	{
		"Playlist file"
	}
}

MusicPlayer.Settings.Hotkeys : all
{	
	if MusicPlayer.Hotkeys[0] == ""; MusicPlayer.Hotkeys[0] = "Unbound" //Play/pause
	if MusicPlayer.Hotkeys[1] == ""; MusicPlayer.Hotkeys[1] = "Unbound" //Next
	if MusicPlayer.Hotkeys[2] == ""; MusicPlayer.Hotkeys[2] = "Unbound" //Previous
	if MusicPlayer.Hotkeys[3] == ""; MusicPlayer.Hotkeys[3] = "Unbound" //Stop
	if MusicPlayer.Hotkeys[4] == ""; MusicPlayer.Hotkeys[4] = "Unbound" //Menu
	if MusicPlayer.Hotkeys[5] == ""; MusicPlayer.Hotkeys[5] = "Unbound" //Volume Up
	if MusicPlayer.Hotkeys[6] == ""; MusicPlayer.Hotkeys[6] = "Unbound" //Volume Down
	if MusicPlayer.Hotkeys[7] == ""; MusicPlayer.Hotkeys[7] = "Unbound" //Speed Up
	if MusicPlayer.Hotkeys[8] == ""; MusicPlayer.Hotkeys[8] = "Unbound" //Speed Down
	if MusicPlayer.Hotkeys[9] == ""; MusicPlayer.Hotkeys[9] = "Unbound" //Balance Left
	if MusicPlayer.Hotkeys[10] == ""; MusicPlayer.Hotkeys[10] = "Unbound" //Balance Right
	if MusicPlayer.Hotkeys[11] == ""; MusicPlayer.Hotkeys[11] = "Unbound" //Song Bar
	
	_msg = ""
	if language == "Placeholder" //TRANSLATORS: This function is for setting hotkeys. Set _msg to the text that should display in the menu when a key is not bound to anything
	{
		
	}
	elseif language == "Español" //TODO new translation for all of these, it's "unbound" now
	{
		_msg = "Sin asignar"
	}
	elseif language == "Deutsch"
	{
		_msg = "Hier klicken"
	}
	elseif language == "Русский"
	{
		_msg = "Непривзянный"
	}
	elseif language == "Français"
	{
		_msg = "Clique pour ajouter une touche"
	}
	elseif language == "Polski"
	{
		_msg = "Kliknij, aby ustawić przycisk"
	}
	else //English
	{
		_msg = "Unbound"
	}
	
	_playpause = ""
	if MusicPlayer.Hotkeys[0] == "Unbound"; _playpause = _msg
	else; _playpause = MusicPlayer.Hotkeys[0]
	
	_next = ""
	if MusicPlayer.Hotkeys[1] == "Unbound"; _next = _msg
	else; _next = MusicPlayer.Hotkeys[1]
	
	_prev = ""
	if MusicPlayer.Hotkeys[2] == "Unbound"; _prev = _msg
	else; _prev = MusicPlayer.Hotkeys[2]
	
	_stop = ""
	if MusicPlayer.Hotkeys[3] == "Unbound"; _stop = _msg
	else; _stop = MusicPlayer.Hotkeys[3]
	
	_menu = ""
	if MusicPlayer.Hotkeys[4] == "Unbound"; _menu = _msg
	else; _menu = MusicPlayer.Hotkeys[4]
	
	_songbar = ""
	if MusicPlayer.Hotkeys[5] == "Unbound"; _songbar = _msg
	else; _songbar = MusicPlayer.Hotkeys[5]
	
	_volup = ""
	if MusicPlayer.Hotkeys[6] == "Unbound"; _volup = _msg
	else; _volup = MusicPlayer.Hotkeys[6]
	
	_voldown = ""
	if MusicPlayer.Hotkeys[7] == "Unbound"; _voldown = _msg
	else; _voldown = MusicPlayer.Hotkeys[7]
	
	_speedup = ""
	if MusicPlayer.Hotkeys[8] == "Unbound"; _speedup = _msg
	else; _speedup = MusicPlayer.Hotkeys[8]
	
	_speeddown = ""
	if MusicPlayer.Hotkeys[9] == "Unbound"; _speeddown = _msg
	else; _speeddown = MusicPlayer.Hotkeys[9]
	
	_balanceleft = ""
	if MusicPlayer.Hotkeys[10] == "Unbound"; _balanceleft = _msg
	else; _balanceleft = MusicPlayer.Hotkeys[10]
	
	_balanceright = ""
	if MusicPlayer.Hotkeys[11] == "Unbound"; _balanceright = _msg
	else; _balanceright = MusicPlayer.Hotkeys[11]

	_h = "\f[color,default.anchor]" //Highlight color
	_d = "\f[color,default]" //Default color
	
	if language == "Placeholder" //TRANSLATORS: This is the menu for picking which hotkey to set
	{
		
	}
	elseif language == "Español"
	{
		"\q[(x),OnMusicPlayer.UnsetHotkey,0] \__q[OnMusicPlayer.ChangeHotkey,0]Reproducir/Pausar: %(_h)%(_playpause)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,1] \__q[OnMusicPlayer.ChangeHotkey,1]Siguiente pista: %(_h)%(_next)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,2] \__q[OnMusicPlayer.ChangeHotkey,2]Pista anterior: %(_h)%(_prev)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,3] \__q[OnMusicPlayer.ChangeHotkey,3]Parar pista: %(_h)%(_stop)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,4] \__q[OnMusicPlayer.ChangeHotkey,4]Abrir Controles de Música: %(_h)%(_menu)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,5] \__q[OnMusicPlayer.ChangeHotkey,5]Activar/Desactivar Barra de Reproducción: %(_h)%(_songbar)%(_d)\__q\n\n"
		
		"\q[(x),OnMusicPlayer.UnsetHotkey,6] \__q[OnMusicPlayer.ChangeHotkey,6]Subir Volumen: %(_h)%(_volup)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,7] \__q[OnMusicPlayer.ChangeHotkey,7]Bajar Volumen: %(_h)%(_voldown)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,8] \__q[OnMusicPlayer.ChangeHotkey,8]Acelerar: %(_h)%(_speedup)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,9] \__q[OnMusicPlayer.ChangeHotkey,9]Ralentizar: %(_h)%(_speeddown)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,10] \__q[OnMusicPlayer.ChangeHotkey,10]Balance a la izda.: %(_h)%(_balanceleft)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,11] \__q[OnMusicPlayer.ChangeHotkey,11]Balance a la dcha.: %(_h)%(_balanceright)%(_d)\__q"
	}
	elseif language == "Deutsch"
	{
		"\q[(x),OnMusicPlayer.UnsetHotkey,0] \__q[OnMusicPlayer.ChangeHotkey,0]Start/Pause: %(_h)%(_playpause)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,1] \__q[OnMusicPlayer.ChangeHotkey,1]Nächstes Lied: %(_h)%(_next)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,2] \__q[OnMusicPlayer.ChangeHotkey,2]Vorheriges Lied: %(_h)%(_prev)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,3] \__q[OnMusicPlayer.ChangeHotkey,3]Lied anhalten: %(_h)%(_stop)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,4] \__q[OnMusicPlayer.ChangeHotkey,4]Menü öffnen: %(_h)%(_menu)%(_d)\__q\n" //TODO this may need to be "open music menu" instead of "open menu"
		"\q[(x),OnMusicPlayer.UnsetHotkey,5] \__q[OnMusicPlayer.ChangeHotkey,5]Toggle Song Bar: %(_h)%(_songbar)%(_d)\__q\n\n" //TODO new translation from here down
		
		"\q[(x),OnMusicPlayer.UnsetHotkey,6] \__q[OnMusicPlayer.ChangeHotkey,6]Volume Up: %(_h)%(_volup)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,7] \__q[OnMusicPlayer.ChangeHotkey,7]Volume Down: %(_h)%(_voldown)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,8] \__q[OnMusicPlayer.ChangeHotkey,8]Speed Up: %(_h)%(_speedup)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,9] \__q[OnMusicPlayer.ChangeHotkey,9]Speed Down: %(_h)%(_speeddown)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,10] \__q[OnMusicPlayer.ChangeHotkey,10]Balance Left: %(_h)%(_balanceleft)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,11] \__q[OnMusicPlayer.ChangeHotkey,11]Balance Right: %(_h)%(_balanceright)%(_d)\__q"
	}
	elseif language == "Русский"
	{
		"\q[(x),OnMusicPlayer.UnsetHotkey,0] \__q[OnMusicPlayer.ChangeHotkey,0]Играй/Пауза: %(_h)%(_playpause)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,1] \__q[OnMusicPlayer.ChangeHotkey,1]Следующая песня: %(_h)%(_next)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,2] \__q[OnMusicPlayer.ChangeHotkey,2]Последняя песня: %(_h)%(_prev)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,3] \__q[OnMusicPlayer.ChangeHotkey,3]Перестать песня: %(_h)%(_stop)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,4] \__q[OnMusicPlayer.ChangeHotkey,4]Открыть меню музыки: %(_h)%(_menu)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,5] \__q[OnMusicPlayer.ChangeHotkey,5]Переключить строка песни: %(_h)%(_songbar)%(_d)\__q\n\n"
		
		"\q[(x),OnMusicPlayer.UnsetHotkey,6] \__q[OnMusicPlayer.ChangeHotkey,6]Громкость верх: %(_h)%(_volup)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,7] \__q[OnMusicPlayer.ChangeHotkey,7]Громкость вниз: %(_h)%(_voldown)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,8] \__q[OnMusicPlayer.ChangeHotkey,8]Скорость верх: %(_h)%(_speedup)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,9] \__q[OnMusicPlayer.ChangeHotkey,9]Скорость вниз: %(_h)%(_speeddown)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,10] \__q[OnMusicPlayer.ChangeHotkey,10]Баланс слева: %(_h)%(_balanceleft)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,11] \__q[OnMusicPlayer.ChangeHotkey,11]Баланс вправо: %(_h)%(_balanceright)%(_d)\__q"
	}
	elseif language == "Français"
	{
		//TODO i don't have translations for these at all?
		"\q[(x),OnMusicPlayer.UnsetHotkey,0] \__q[OnMusicPlayer.ChangeHotkey,0]Play/Pause: %(_h)%(_playpause)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,1] \__q[OnMusicPlayer.ChangeHotkey,1]Next Song: %(_h)%(_next)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,2] \__q[OnMusicPlayer.ChangeHotkey,2]Previous Song: %(_h)%(_prev)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,3] \__q[OnMusicPlayer.ChangeHotkey,3]Stop Song: %(_h)%(_stop)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,4] \__q[OnMusicPlayer.ChangeHotkey,4]Open Music Menu: %(_h)%(_menu)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,5] \__q[OnMusicPlayer.ChangeHotkey,5]Toggle Song Bar: %(_h)%(_songbar)%(_d)\__q\n\n"
		
		"\q[(x),OnMusicPlayer.UnsetHotkey,6] \__q[OnMusicPlayer.ChangeHotkey,6]Volume Up: %(_h)%(_volup)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,7] \__q[OnMusicPlayer.ChangeHotkey,7]Volume Down: %(_h)%(_voldown)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,8] \__q[OnMusicPlayer.ChangeHotkey,8]Speed Up: %(_h)%(_speedup)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,9] \__q[OnMusicPlayer.ChangeHotkey,9]Speed Down: %(_h)%(_speeddown)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,10] \__q[OnMusicPlayer.ChangeHotkey,10]Balance Left: %(_h)%(_balanceleft)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,11] \__q[OnMusicPlayer.ChangeHotkey,11]Balance Right: %(_h)%(_balanceright)%(_d)\__q"
	}
	elseif language == "Polski"
	{
		"\q[(x),OnMusicPlayer.UnsetHotkey,0] \__q[OnMusicPlayer.ChangeHotkey,0]Odtwarzanie/Pauza: %(_h)%(_playpause)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,1] \__q[OnMusicPlayer.ChangeHotkey,1]Następny utwór: %(_h)%(_next)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,2] \__q[OnMusicPlayer.ChangeHotkey,2]Poprzedni utwór: %(_h)%(_prev)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,3] \__q[OnMusicPlayer.ChangeHotkey,3]Zatrzymaj utwór: %(_h)%(_stop)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,4] \__q[OnMusicPlayer.ChangeHotkey,4]Otwórz menu: %(_h)%(_menu)%(_d)\__q\n" //TODO this may need to be "open music menu" instead of "open menu"
		"\q[(x),OnMusicPlayer.UnsetHotkey,5] \__q[OnMusicPlayer.ChangeHotkey,5]Toggle Song Bar: %(_h)%(_songbar)%(_d)\__q\n\n" //TODO new translation from here down
		
		"\q[(x),OnMusicPlayer.UnsetHotkey,6] \__q[OnMusicPlayer.ChangeHotkey,6]Volume Up: %(_h)%(_volup)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,7] \__q[OnMusicPlayer.ChangeHotkey,7]Volume Down: %(_h)%(_voldown)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,8] \__q[OnMusicPlayer.ChangeHotkey,8]Speed Up: %(_h)%(_speedup)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,9] \__q[OnMusicPlayer.ChangeHotkey,9]Speed Down: %(_h)%(_speeddown)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,10] \__q[OnMusicPlayer.ChangeHotkey,10]Balance Left: %(_h)%(_balanceleft)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,11] \__q[OnMusicPlayer.ChangeHotkey,11]Balance Right: %(_h)%(_balanceright)%(_d)\__q"
	}
	else //English
	{
		"\q[(x),OnMusicPlayer.UnsetHotkey,0] \__q[OnMusicPlayer.ChangeHotkey,0]Play/Pause: %(_h)%(_playpause)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,1] \__q[OnMusicPlayer.ChangeHotkey,1]Next Song: %(_h)%(_next)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,2] \__q[OnMusicPlayer.ChangeHotkey,2]Previous Song: %(_h)%(_prev)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,3] \__q[OnMusicPlayer.ChangeHotkey,3]Stop Song: %(_h)%(_stop)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,4] \__q[OnMusicPlayer.ChangeHotkey,4]Open Music Menu: %(_h)%(_menu)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,5] \__q[OnMusicPlayer.ChangeHotkey,5]Toggle Song Bar: %(_h)%(_songbar)%(_d)\__q\n\n"
		
		"\q[(x),OnMusicPlayer.UnsetHotkey,6] \__q[OnMusicPlayer.ChangeHotkey,6]Volume Up: %(_h)%(_volup)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,7] \__q[OnMusicPlayer.ChangeHotkey,7]Volume Down: %(_h)%(_voldown)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,8] \__q[OnMusicPlayer.ChangeHotkey,8]Speed Up: %(_h)%(_speedup)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,9] \__q[OnMusicPlayer.ChangeHotkey,9]Speed Down: %(_h)%(_speeddown)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,10] \__q[OnMusicPlayer.ChangeHotkey,10]Balance Left: %(_h)%(_balanceleft)%(_d)\__q\n"
		"\q[(x),OnMusicPlayer.UnsetHotkey,11] \__q[OnMusicPlayer.ChangeHotkey,11]Balance Right: %(_h)%(_balanceright)%(_d)\__q"
	}
	
	"\![unlock,balloonrepaint]"
}

//Changing the playback type
OnMusicPlayer.PlaybackType : all
{
	"\C\![lock,balloonrepaint]\c"
	"%(MusicPlayer.Scope)%(MusicPlayer.LargeBalloon)\![quicksection,1]\![no-autopause]"
	
	if language == "Placeholder" //TRANSLATORS: These should match the _mode labels above
	{
		
	}
	elseif language == "Español"
	{
		
		"\![*]\__q[OnMusicPlayer.PlaybackTypeChange,0]Repetir Lista de reproducción\__q\n"
		"\![*]\__q[OnMusicPlayer.PlaybackTypeChange,1]Aleatorio y Repetir\__q\n"
		"\![*]\__q[OnMusicPlayer.PlaybackTypeChange,2]Repetir pista\__q\n"
		"\![*]\__q[OnMusicPlayer.PlaybackTypeChange,3]Reproducir pista\__q\n"
		"\![*]\__q[OnMusicPlayer.PlaybackTypeChange,4]Aleatorio\__q\n"
		
		"\n\n\![*]\__q[OnMusicPlayer.Settings]Volver a Controles de Música\__q"
	}
	elseif language == "Deutsch"
	{
		"\![*]\__q[OnMusicPlayer.PlaybackTypeChange,0]Playlist wiederholen\__q\n"
		"\![*]\__q[OnMusicPlayer.PlaybackTypeChange,1]Playlist shuffeln und wiederholen\__q\n"
		"\![*]\__q[OnMusicPlayer.PlaybackTypeChange,2]Ein Lied auf Wiederholung spielen\__q\n"
		"\![*]\__q[OnMusicPlayer.PlaybackTypeChange,3]Ein einzelnes Lied spielen\__q\n"
		"\![*]\__q[OnMusicPlayer.PlaybackTypeChange,4]Random\__q\n" //TODO new translation
		
		"\n\![*]\__q[OnMusicPlayer.Settings]Zurück zu Musik-Einstellungen\__q"
	}
	elseif language == "Русский"
	{
		"\![*]\__q[OnMusicPlayer.PlaybackTypeChange,0]Играй Плейлист по Кругу\__q\n"
		"\![*]\__q[OnMusicPlayer.PlaybackTypeChange,1]Перетасуй и Играй по Кругу\__q\n"
		"\![*]\__q[OnMusicPlayer.PlaybackTypeChange,2]Играй Одна Песня по Кругу\__q\n"
		"\![*]\__q[OnMusicPlayer.PlaybackTypeChange,3]Играй Одна Песня\__q\n"
		"\![*]\__q[OnMusicPlayer.PlaybackTypeChange,4]Случайный\__q\n"
		
		"\n\![*]\__q[OnMusicPlayer.Settings]Назад в Настроек Музыки\__q"
	}
	elseif language == "Français"
	{
		"\![*]\__q[OnMusicPlayer.PlaybackTypeChange,0]Playlist en Boucle\__q\n"
		"\![*]\__q[OnMusicPlayer.PlaybackTypeChange,1]Mélangée et en Boucle\__q\n"
		"\![*]\__q[OnMusicPlayer.PlaybackTypeChange,2]Boucler sur une Musique\__q\n"
		"\![*]\__q[OnMusicPlayer.PlaybackTypeChange,3]Lire Une Musique\__q\n"
		"\![*]\__q[OnMusicPlayer.PlaybackTypeChange,4]Random\__q\n" //TODO new translation
		
		"\n\![*]\__q[OnMusicPlayer.Settings]Retour aux paramètres des musiques\__q"
	}
	elseif language == "Polski"
	{
		"\![*]\__q[OnMusicPlayer.PlaybackTypeChange,0]Zapętl Playlistę\__q\n"
		"\![*]\__q[OnMusicPlayer.PlaybackTypeChange,1]Miksuj i Zapętl\__q\n"
		"\![*]\__q[OnMusicPlayer.PlaybackTypeChange,2]Zapętl Jedną Piosenkę\__q\n"
		"\![*]\__q[OnMusicPlayer.PlaybackTypeChange,3]Zagraj Jedną Piosenkę\__q\n"
		"\![*]\__q[OnMusicPlayer.PlaybackTypeChange,4]Random\__q\n" //TODO new translation
		
		"\n\![*]\__q[OnMusicPlayer.Settings]Powrót do ustawień muzycznych\__q"
	}
	else //English
	{
		"\![*]\__q[OnMusicPlayer.PlaybackTypeChange,0]Loop Playlist\__q\n"
		"\![*]\__q[OnMusicPlayer.PlaybackTypeChange,1]Shuffle and Loop\__q\n"
		"\![*]\__q[OnMusicPlayer.PlaybackTypeChange,2]Loop One Song\__q\n"
		"\![*]\__q[OnMusicPlayer.PlaybackTypeChange,3]Play One Song\__q\n"
		"\![*]\__q[OnMusicPlayer.PlaybackTypeChange,4]Random\__q\n"
		
		"\n\![*]\__q[OnMusicPlayer.Settings]Back to music settings\__q"
	}
	"\![unlock,balloonrepaint]"
}

//Actually making the change
OnMusicPlayer.PlaybackTypeChange
{
	reference0 = TOINT(reference0)
	MusicPlayer.PlayMode = reference0
	if reference0 == 1 //If the user set it to shuffle, shuffle the playlist
	{
		MusicPlayer.ShuffledPlaylist = MusicPlayer.ShufflePlaylist(MusicPlayer.CurrentSongIndex,MusicPlayer.CurrentPlaylist)
		MusicPlayer.ShuffledIndex = 0
	}
	OnMusicPlayer.Settings
}

//Bringing up input boxes
OnMusicPlayer.SetOption : all
{
	"%(MusicPlayer.Scope)%(MusicPlayer.LargeBalloon)\![quicksection,1]\*\![no-autopause]"
	
	if reference0 == "Balance"; "\![open,inputbox,OnMusicPlayer.Balance,-1,__INPUT_BOX_COLOR__]"
	elseif reference0 == "Speed"; "\![open,sliderinput,OnMusicPlayer.Speed,-1,100,1,%(MusicPlayer.MaxRate)]"
	else; "\![open,sliderinput,OnMusicPlayer.Volume,-1,100,1,100]"
	
	if language == "Placeholder" //TRANSLATORS: Leave the reference0 parts alone, just translate the dialogues. These are for changing the options like volume, balance, and speed
	{
		
	}
	elseif language == "Español"
	{
		if reference0 == "Balance"
		{
			"[Escribe un valor para el balance. 0 es al medio, -100 es todo a la izquierda, 100 es todo a la derecha.]"
		}
		elseif reference0 == "Velocidad"
		{
			"[Elige una velocidad entre 0 a %(MusicPlayer.MaxRate). 100 is el predeterminado.]"
		}
		else //volume
		{
			"[Elige un volumen entre 0 a 100. 100 is el predeterminado.]"
		}
		--
		"\n\n\![*]\q[Cancelar,OnCloseMusicSet,%(reference0)]\e"
	}
	elseif language == "Deutsch"
	{
		if reference0 == "Balance"
		{
			"[Gib einen Balance-Wert ein. 0 ist mittig, -100 ist ganz auf der linken Seite, 100 ist ganz auf der rechten Seite der Lautsprecher.]"
		}
		elseif reference0 == "Speed"
		{
			"[Wähle eine Geschwindigkeit. 100 ist normal.]" //TODO updated translation
		}
		else //volume
		{
			"[Wähle eine Lautstärke. 100 ist der Standardwert.]" //TODO updated translation
		}
		
		"\n\n\![*]\__q[OnMusicPlayer.SetOptionClose,%(reference0)]Abbrechen\__q\e"
	}
	elseif language == "Русский"
	{
		if reference0 == "Balance"
		{
			"[Напиши номер равновесие. 0 - в центре, -100 - в самой левой стороне, 100 в самой справой стороне.]"
		}
		elseif reference0 == "Speed"
		{
			"[Выбирай скорость от 0 до %(MusicPlayer.MaxRate). 100 - номер по умолчанию.]"
		}
		else //volume
		{
			"[Выбирай громкость от 0 до 100. 100 - номер по умолчанию.]"
		}
		
		"\n\n\![*]\__q[OnMusicPlayer.SetOptionClose,%(reference0)]Отменить\__q\e"
	}
	elseif language == "Français" //TODO FRENCH I adjusted this and I hope it's correct lol
	{
		if reference0 == "Balance"
		{
			"[Entre une valeur de balance. 0 est le centre, -100 est tout à gauche, 100 est tout à droite.]"
		}
		elseif reference0 == "Speed"
		{
			//TODO updated translation
			"[Choisis une vitesse. 100 est normale.]"
		}
		else //volume
		{
			//TODO FRENCH is this correct? Doesn't match the above...
			//TODO updated translation
			"[Choisis un volume. 100 is the default.]"
		}
		
		"\n\n\![*]\__q[OnMusicPlayer.SetOptionClose,%(reference0)]Annuler\__q\e"
	}
	elseif language == "Polski"
	{
		if reference0 == "Balance"
		{
			"[Wprowadzić wartość balansu. 0 oznacza środek, -100 oznacza skrajnie w lewo, 100 oznacza skrajnie w prawo.]"
		}
		elseif reference0 == "Speed"
		{
			"[Wybierz prędkość. 100 to prędkość normalna.]" //TODO updated translation
		}
		else //volume
		{
			"[Wybierz głośność. 100 jest wartością domyślną.]" //TODO updated translation
		}
		
		"\n\n\![*]\__q[OnMusicPlayer.SetOptionClose,%(reference0)]Anuluj\__q\e"
	}
	else //English
	{
		if reference0 == "Balance"
		{
			"[Type a balance value. 0 is center, -100 is all the way to the left, 100 is all the way to the right.]"
		}
		elseif reference0 == "Speed"
		{
			"[Pick a speed from 0 to %(MusicPlayer.MaxRate). 100 is the default.]"
		}
		else //volume
		{
			"[Pick a volume from 0 to 100. 100 is the default.]"
		}
		
		"\n\n\![*]\__q[OnMusicPlayer.SetOptionClose,%(reference0)]Cancel\__q\e"
	}
}

//Setting the balance
OnMusicPlayer.Balance : all
{
	MusicPlayer.Balance = TOINT(reference0)
	if MusicPlayer.Balance > 100; MusicPlayer.Balance = 100
	if MusicPlayer.Balance < -100; MusicPlayer.Balance = -100
	
	if MusicPlayer.Singing; "\![sound,option,""%(MusicPlayer.CurrentSongPath)"",--balance=%(MusicPlayer.Balance)]"
	
	OnMusicPlayer.Settings
}

//Setting the speed
OnMusicPlayer.Speed : all
{
	MusicPlayer.Speed = reference0
	
	if MusicPlayer.Singing; "\![sound,option,""%(MusicPlayer.CurrentSongPath)"",--rate=%(MusicPlayer.Speed)]"
	
	OnMusicPlayer.Settings
}

//Setting the volume
OnMusicPlayer.Volume : all
{
	MusicPlayer.Volume = reference0
	
	if MusicPlayer.Singing; "\![sound,option,""%(MusicPlayer.CurrentSongPath)"",--volume=%(MusicPlayer.Volume)]"
	
	OnMusicPlayer.Settings
}

//If the user cancels the changes, this'll close the input boxes
OnMusicPlayer.SetOptionClose : all
{
	"\C\![close,inputbox,OnMusicPlayer.%(reference0)]"
	
	OnMusicPlayer.Settings
}

//Up/Down volume buttons
OnMusicPlayer.QuickVolume : all
{
	_amt = 5
	if _argv[1] != ""; _amt = _argv[1]
	
	if reference0 == "Up" || _argv[0] == "Up"
	{
		MusicPlayer.Volume += _amt
		if MusicPlayer.Volume > 100; MusicPlayer.Volume = 100
	}
	else //Down
	{
		MusicPlayer.Volume -= _amt
		if MusicPlayer.Volume < 0; MusicPlayer.Volume = 0
	}
	if MusicPlayer.Singing
	{
		if MusicPlayer.MenuIsOpen; "\C"
		
		"\![sound,option,""%(MusicPlayer.CurrentSongPath)"",--volume=%(MusicPlayer.Volume)]"
	}
	
	
	if "__MUSIC_SETTINGS_MENU__,1__" _in_ MusicPlayer.LastTalk; OnMusicPlayer.Settings //Only refresh in the music settings menu
	elseif "changing hotkey: " _in_ MusicPlayer.LastTalk; "\e: changing hotkey: %(MusicPlayer.CheckWhichMenu[1])" //Or if setting hotkeys...
	elseif MusicPlayer.CheckWhichMenu == "OnMusicPlayer.Menu"; "\e __MUSIC_PLAYER_MAIN_MENU__" //Or if we're on the main menu and don't want to interrupt that display...
}

//Up/Down speed buttons
OnMusicPlayer.QuickSpeed : all
{
	_amt = 5
	if _argv[1] != ""; _amt = _argv[1]
	
	if reference0 == "Up" || _argv[0] == "Up"
	{
		MusicPlayer.Speed += _amt
		if MusicPlayer.Speed > MusicPlayer.MaxRate; MusicPlayer.Speed = MusicPlayer.MaxRate
	}
	else //Down
	{
		MusicPlayer.Speed -= _amt
		if MusicPlayer.Speed < 0; MusicPlayer.Speed = 0
	}
	if MusicPlayer.Singing
	{
		if MusicPlayer.MenuIsOpen; "\C"
		
		"\![sound,option,""%(MusicPlayer.CurrentSongPath)"",--rate=%(MusicPlayer.Speed)]"
	}
	
	if "__MUSIC_SETTINGS_MENU__,1__" _in_ MusicPlayer.LastTalk; OnMusicPlayer.Settings //Only refresh in the music settings menu
	elseif "changing hotkey: " _in_ MusicPlayer.LastTalk; "\e: changing hotkey: %(MusicPlayer.CheckWhichMenu[1])" //Or if setting hotkeys...
	elseif MusicPlayer.CheckWhichMenu == "OnMusicPlayer.Menu"; "\e __MUSIC_PLAYER_MAIN_MENU__" //Or if we're on the main menu and don't want to interrupt that display...
}

//Left/Right balance buttons
OnMusicPlayer.QuickBalance : all
{
	_amt = 5
	if _argv[1] != ""; _amt = _argv[1]
	
	if reference0 == "Right" || _argv[0] == "Right"
	{
		MusicPlayer.Balance += _amt
		if MusicPlayer.Balance > 100; MusicPlayer.Balance = 100
	}
	else //Left
	{
		MusicPlayer.Balance -= _amt
		if MusicPlayer.Balance < -100; MusicPlayer.Balance = -100
	}
	if MusicPlayer.Singing
	{
		if MusicPlayer.MenuIsOpen; "\C"
		
		"\![sound,option,""%(MusicPlayer.CurrentSongPath)"",--balance=%(MusicPlayer.Balance)]"
	}
	
	if "__MUSIC_SETTINGS_MENU__,1__" _in_ MusicPlayer.LastTalk; OnMusicPlayer.Settings //Only refresh in the music settings menu
	elseif "changing hotkey: " _in_ MusicPlayer.LastTalk; "\e: changing hotkey: %(MusicPlayer.CheckWhichMenu[1])" //Or if setting hotkeys...
	elseif MusicPlayer.CheckWhichMenu == "OnMusicPlayer.Menu"; "\e __MUSIC_PLAYER_MAIN_MENU__" //Or if we're on the main menu and don't want to interrupt that display...
}

//Toggles the stop after playback function
OnMusicPlayer.StopAfterPlayback 
{
	if reference0 == "playlist" && MusicPlayer.StopAfterCurrent != "stop after playlist"; MusicPlayer.StopAfterCurrent = "stop after playlist"
	elseif reference0 == "song" && MusicPlayer.StopAfterCurrent != "stop after playback"; MusicPlayer.StopAfterCurrent = "stop after playback"
	else; MusicPlayer.StopAfterCurrent = ""
	

	OnMusicPlayer.Settings
}

OnMusicPlayer.ToggleSongBar : all
{
	if MusicPlayer.SongBar != 0; MusicPlayer.SongBar = 0
	else; MusicPlayer.SongBar = 1
	
	_onoff = "False"
	if MusicPlayer.SongBar == 1; _onoff = "True"
	
	if MusicPlayer.MenuIsOpen; "\C"
	
	if MusicPlayer.PlayState > 0; "\![sound,option,""%(MusicPlayer.CurrentSongPath)"",--window=%(_onoff)]"
	
	if _argc == 0; OnMusicPlayer.Settings //If this was done with the buttons - there will be no args in that case
	elseif _argv[1] != "" //If a menu is listed to refresh
	{
		"\C\![raise,%(_argv[1])]"
	}
}

OnMusicPlayer.ToggleTooltips : all
{
	if MusicPlayer.Tooltips != 0; MusicPlayer.Tooltips = 0
	else; MusicPlayer.Tooltips = 1
	
	OnMusicPlayer.Settings
}

OnMusicPlayer.ToggleSongAnnouncement : all
{
	if MusicPlayer.SongAnnouncement == 0; MusicPlayer.SongAnnouncement = 1
	elseif MusicPlayer.SongAnnouncement == 1; MusicPlayer.SongAnnouncement = 2
	else; MusicPlayer.SongAnnouncement = 0
	
	OnMusicPlayer.Settings
}

OnMusicPlayer.TogglePriority : all
{
	if MusicPlayer.Priority != 1; MusicPlayer.Priority = 1
	else; MusicPlayer.Priority = 0
	
	OnMusicPlayer.Settings
}

OnMusicPlayer.ToggleScrollWheel : all
{
	if MusicPlayer.Scroll == 0; MusicPlayer.Scroll = 1
	elseif MusicPlayer.Scroll == 1; MusicPlayer.Scroll = 2
	elseif MusicPlayer.Scroll == 2; MusicPlayer.Scroll = -1
	else; MusicPlayer.Scroll = 0
	
	OnMusicPlayer.Settings
}

OnMusicPlayer.TogglePreviousButton : all
{
	if MusicPlayer.PreviousButton != 1; MusicPlayer.PreviousButton = 1
	else; MusicPlayer.PreviousButton = 0
	
	OnMusicPlayer.Settings
}

OnMusicPlayer.TogglePagination : all
{
	if MusicPlayer.Pagination != 0; MusicPlayer.Pagination = 0
	else; MusicPlayer.Pagination = 1
	
	OnMusicPlayer.Settings
}

//Menu for moving songs around in the playlist. I'd like to make this better, but alas...
OnMusicPlayer.ScootSongMenuWarn : all
{
	if ARRAYSIZE(MusicPlayer.CurrentPlaylist) > 100
	{
		"%(MusicPlayer.Scope)%(MusicPlayer.LargeBalloon)\![quicksection,1]\*\![set,autoscroll,disable]\![no-autopause]"
		
		//TODO TRANSLATION new translations needed here
		if language == "Placeholder" //TRANSLATORS: A warning if the user tries to open the song moving menu with a lot of songs loaded in
		{
			
		}
		elseif language == "Español"
		{
			"Aviso: Hay actualmente %(ARRAYSIZE(MusicPlayer.CurrentPlaylist)) pistas en la lista de reproducción.\n"
			"Este menú no está por páginas y se ejecutará lentamente. ¿Abrir de todos modos?"
			"\n\n"
			"(Nota: Las listas de reproducción son guardadas como archivos .m3u y pueden ser editados en un editor de texto como Notepad++ si deseas hacer ediciones en masa o editar una lista de reproducción larga.)"
			
			"\n\n"
			"\![*]\__q[OnMusicPlayer.ScootSongMenu]Sí, abrir el menú\__q"
			"\n\n"
			"\![*]\__q[OnMusicPlayer.Settings]No, volver a ajustes\__q"
		}
		elseif language == "Deutsch"
		{
			"Warning: there are currently %(ARRAYSIZE(MusicPlayer.CurrentPlaylist)) songs in the playlist.\n"
			"This menu is not paginated and will run slowly. Open it anyways?"
			"\n\n"
			"(Note: Playlists are saved as .m3u files and can be edited in a text editor such as Notepad++ if you wish to do mass editing or edit a long playlist.)"
			
			"\n\n"
			"\![*]\__q[OnMusicPlayer.ScootSongMenu]Yes, open the menu\__q"
			"\n\n"
			"\![*]\__q[OnMusicPlayer.Settings]No, go back to settings\__q"
		}
		elseif language == "Русский"
		{
			"Увага: сейчас у плэйлист %(ARRAYSIZE(MusicPlayer.CurrentPlaylist)) песни.\n"
			"Этот меню не разбиты на страницы а будеть медленно играть. Всё ещё его открой?"
			"\n\n"
			"(Заметка: Плэйлисты будут сохранены как файли .m3u, а могут быть изменены в редактор текста, например Notepad++, если хочешь групповой обработывать, или изменить долгий плэйлисть.)"

			"\n\n"
			"\![*]\__q[OnMusicPlayer.ScootSongMenu]Да, открой меню\__q"
			"\n\n"
			"\![*]\__q[OnMusicPlayer.Settings]Нет, верни до настройки\__q"
		}
		elseif language == "Français"
		{
			"Warning: there are currently %(ARRAYSIZE(MusicPlayer.CurrentPlaylist)) songs in the playlist.\n"
			"This menu is not paginated and will run slowly. Open it anyways?"
			"\n\n"
			"(Note: Playlists are saved as .m3u files and can be edited in a text editor such as Notepad++ if you wish to do mass editing or edit a long playlist.)"
			
			"\n\n"
			"\![*]\__q[OnMusicPlayer.ScootSongMenu]Yes, open the menu\__q"
			"\n\n"
			"\![*]\__q[OnMusicPlayer.Settings]No, go back to settings\__q"
		}
		elseif language == "Polski"
		{
			"Warning: there are currently %(ARRAYSIZE(MusicPlayer.CurrentPlaylist)) songs in the playlist.\n"
			"This menu is not paginated and will run slowly. Open it anyways?"
			"\n\n"
			"(Note: Playlists are saved as .m3u files and can be edited in a text editor such as Notepad++ if you wish to do mass editing or edit a long playlist.)"
			
			"\n\n"
			"\![*]\__q[OnMusicPlayer.ScootSongMenu]Yes, open the menu\__q"
			"\n\n"
			"\![*]\__q[OnMusicPlayer.Settings]No, go back to settings\__q"
		}
		else //English
		{
			"Warning: there are currently %(ARRAYSIZE(MusicPlayer.CurrentPlaylist)) songs in the playlist.\n"
			"This menu is not paginated and will run slowly. Open it anyways?"
			"\n\n"
			"(Note: Playlists are saved as .m3u files and can be edited in a text editor such as Notepad++ if you wish to do mass editing or edit a long playlist.)"
			
			"\n\n"
			"\![*]\__q[OnMusicPlayer.ScootSongMenu]Yes, open the menu\__q"
			"\n\n"
			"\![*]\__q[OnMusicPlayer.Settings]No, go back to settings\__q"
		}
	}
	else
	{
		"\C\![raise,OnMusicPlayer.ScootSongMenu]"
	}
}

OnMusicPlayer.ScootSongMenu : all
{
	//CUSTOMIZE: This is the menu for moving songs in the playlist. The value below determines how much of the file name should be displayed before it shows an ellipsis. Adjust as needed to fit your balloon.
	_max_name_length = 23 //Max length of names in this menu. After this number of characters it will write an ellipsis
	
	_h = "\f[color,default.anchor]"
	_g = "\f[color,disable]"
	_d = "\f[color,default]"
	
	_button = ""
	if language == "Placeholder"; _button = "" //TRANSLATORS: Back button for the menu where you can move songs in the playlist. This will be used both above and below the list
	elseif language == "Español"; _button = "Volver"
	elseif language == "Deutsch"; _button = "Zurück"
	elseif language == "Русский"; _button = "Назад"
	elseif language == "Français"; _button = "Retour"
	elseif language == "Polski"; _button = "Powrót"
	else; _button = "Back" //English
	
	if reference1 != ""; "\C%(MusicPlayer.Scope)\![lock,balloonrepaint]\c"
	
	"%(MusicPlayer.Scope)%(MusicPlayer.LargeBalloon)\![quicksection,1]\*\![no-autopause]"
	
	"\![*]\__q[OnMusicPlayer.Settings]%(_button)\__q\n\n"
	
	if reference1 == "top"; "\![set,autoscroll,disable]"
	
	_currentsong = IARRAY
	for _i = 0; _i < ARRAYSIZE(MusicPlayer.CurrentPlaylist); _i++
	{
		_song = MusicPlayer.CurrentPlaylist[_i]
		_song = SPLITPATH(_song)[2] //Picks out just the name of the file, no extension

		if _i != 0
		{
			"\q[▲▲,OnMusicPlayer.MoveSong,%(_i),top]  "
			"\f[bold,1]\q[△,OnMusicPlayer.ScootSong,%(_i),-]\f[bold,default] "
		}
		else
		{
			"%(_g)"
			"▲▲  "
			"\f[bold,1]△\f[bold,default] "
			"%(_d)"
		}
		
		if _i == MusicPlayer.CurrentSongIndex //If this is the song that's playing right now
		{
			"\f[bold,1]" //Make it bold
			_currentsong[0] = _song //Saves the song name into _currentsong[0]
			_currentsong[1] = MusicPlayer.CurrentPlaylist[_i] //Saves the song path into _currentsong[1]
		}
		
		//Attempt to position the menu such that it's not jumping around *too* badly... as long as you don't click too fast.
		_lines = MusicPlayer.BalloonLines / 2 - 1
		if reference1 == "+"; _lines += 1
		elseif reference1 == "-"; _lines -= 1
		if (_i - _lines) == reference0 && reference1 != "end"; "\![set,autoscroll,disable]"
		
		//Handle which song name to highlight (by unhighlighting)
		_justmoved = reference0
		if reference1 == "end"; _justmoved = ARRAYSIZE(MusicPlayer.CurrentPlaylist) - 1
		elseif reference1 == "top"; _justmoved = 0
		elseif reference1 == "+"; _justmoved++
		else; _justmoved--
		
		if _i != _justmoved; "%(_h)" //Highlight song if it's not the one that was just moved
		//NOTE: If you're getting an error about the line below, you probably don't have yaya_optional.txt! You can pick that up here: https://github.com/YAYA-shiori/yaya-dic
		"\_n%(SHIORI3FW.MakeShortText(_song,_max_name_length)) \_n" //Add song to list
		if _i != _justmoved; "%(_d)"
		if _i == MusicPlayer.CurrentSongIndex; "\f[italic,default]\f[bold,default]" //Reset the bold if it was applied
		
		"%(MusicPlayer.newline)\f[align,right]\f[bold,1]"
		if _i != (ARRAYSIZE(MusicPlayer.CurrentPlaylist) - 1)
		{
			"\q[▽,OnMusicPlayer.ScootSong,%(_i),+]\f[bold,default]  "
			"\q[▼▼,OnMusicPlayer.MoveSong,%(_i),end]"
		}
		else
		{
			"%(_g)"
			"▽\f[bold,default]  "
			"▼▼"
		}
		"\n\f[align,left]%(MusicPlayer.newline)%(_d)" //Align commands... so useful but so tricky. Idk why this works but it does. It was putting extra spaces before which are really obvious on some balloons with fonts that have wide spaces
	}
	
	"%(_display)\n\n"
	
	"\![*]\__q[OnMusicPlayer.Settings]%(_button)\__q"
	"\![unlock,balloonrepaint]"
}

//Move song to top or bottom of playlist
OnMusicPlayer.MoveSong : all
{
	_temp = MusicPlayer.CurrentPlaylist[reference0]
	if reference1 == "top"
	{
		_temparray = MusicPlayer.CurrentPlaylist
		_temparray[reference0] = IARRAY
		MusicPlayer.CurrentPlaylist = IARRAY
		MusicPlayer.CurrentPlaylist ,= _temp
		foreach _temparray; _song
		{
			MusicPlayer.CurrentPlaylist ,= _song
		}
		if reference0 == MusicPlayer.CurrentSongIndex //If it's the current song, the index will now be 0
		{
			MusicPlayer.CurrentSongIndex = 0
		}
		elseif reference0 > MusicPlayer.CurrentSongIndex //If not, and the song _used_ to be below this one on the list, increase the index number since now the current song is lower in the list
		{
			MusicPlayer.CurrentSongIndex = MusicPlayer.CurrentSongIndex + 1
		}
	}
	else //End
	{
		MusicPlayer.CurrentPlaylist[reference0] = IARRAY
		MusicPlayer.CurrentPlaylist ,= _temp
		if reference0 == MusicPlayer.CurrentSongIndex //If it's the current song, the index will now be the last in the array
		{
			MusicPlayer.CurrentSongIndex = ARRAYSIZE(MusicPlayer.CurrentPlaylist) - 1
		}
		elseif reference0 < MusicPlayer.CurrentSongIndex //If not, and the song _used_ to be above this one in the list, decrease the index number since now the current song is higher in the list 
		{
			MusicPlayer.CurrentSongIndex = MusicPlayer.CurrentSongIndex - 1
		}
	}
	MusicPlayer.ShuffledPlaylist = MusicPlayer.ShufflePlaylist(MusicPlayer.CurrentSongIndex,MusicPlayer.CurrentPlaylist)
	MusicPlayer.ShuffledIndex = 0
	
	"\C\![raise,OnMusicPlayer.ScootSongMenu,%(reference0),%(reference1)]"
}

//Moving a song in the playlist by one space
OnMusicPlayer.ScootSong : all
{
	MusicPlayer.CurrentPlaylist = MusicPlayer.ArrayScootEx(TOINT(reference0),reference1,MusicPlayer.CurrentPlaylist)
	if reference0 == MusicPlayer.CurrentSongIndex
	{
		if reference1 == "+"
		{
			MusicPlayer.CurrentSongIndex = MusicPlayer.CurrentSongIndex + 1
		}
		else //-
		{
			MusicPlayer.CurrentSongIndex = MusicPlayer.CurrentSongIndex - 1
		}
	}
	elseif (reference0 + 1) == MusicPlayer.CurrentSongIndex && reference1 == "+"
	{
		MusicPlayer.CurrentSongIndex = MusicPlayer.CurrentSongIndex - 1
	}
	elseif (reference0 - 1) == MusicPlayer.CurrentSongIndex && reference1 == "-"
	{
		MusicPlayer.CurrentSongIndex = MusicPlayer.CurrentSongIndex + 1
	}
	
	MusicPlayer.ShuffledPlaylist = MusicPlayer.ShufflePlaylist(MusicPlayer.CurrentSongIndex,MusicPlayer.CurrentPlaylist)
	MusicPlayer.ShuffledIndex = 0
	
	"\C\![raise,OnMusicPlayer.ScootSongMenu,%(reference0),%(reference1)]"
}

//Waiting for user input to change the hotkey
OnMusicPlayer.ChangeHotkey : all
{
	reference0 = TOINT(reference0)
	_temp = MusicPlayer.Hotkeys[reference0]
	
	
	"\C%(MusicPlayer.Scope)\![lock,balloonrepaint]\c%(MusicPlayer.LargeBalloon)\*\![quicksection,1]\![no-autopause]"
	
	_option = ""
	
	if language == "Placeholder" //TRANSLATORS: Menu for actually changing a hotkey. Make sure to copy the block of reference0 checks and translate the text in them, and then you can use _option in dialogue for which key is being changed
	{
		
	}
	elseif language == "Español"
	{
		if reference0 == 1; _option = "siguiente pista"
		elseif reference0 == 2; _option = "pista anterior"
		elseif reference0 == 3; _option = "parar pista"
		elseif reference0 == 4; _option = "abrir menú"
		elseif reference0 == 5; _option = "activar/desactivar barra de reproducción"
		elseif reference0 == 6; _option = "subir volumen"
		elseif reference0 == 7; _option = "bajar volumen"
		elseif reference0 == 8; _option = "acelerar"
		elseif reference0 == 9; _option = "ralentizar"
		elseif reference0 == 10; _option = "balance a la izda."
		elseif reference0 == 11; _option = "balance a la dcha."
		else; _option =  "Reproducir/Pausar"
		
		"[Pulse una tecla para %(_option).]"
		
		"\n\n\![*]\__q[OnMusicPlayer.Settings,Hotkeys,%(reference0),%(_temp)]Cancelar\__q"
	}
	elseif language == "Deutsch"
	{
		if reference0 == 1; _option = "-Nächstes Lied-"
		elseif reference0 == 2; _option = "-Vorheriges Lied-"
		elseif reference0 == 3; _option = "-Lied anhalten-"
		elseif reference0 == 4; _option = "-Menü öffnen-"
		elseif reference0 == 5; _option = "toggle song bar" //TODO new translation need from here down to the end
		elseif reference0 == 6; _option = "volume up"
		elseif reference0 == 7; _option = "volume down"
		elseif reference0 == 8; _option = "speed up"
		elseif reference0 == 9; _option = "speed down"
		elseif reference0 == 10; _option = "balance left"
		elseif reference0 == 11; _option = "balance right"
		else; _option =  "-Start/Pause-"
		
		"[Drücke eine Taste für %(_option).]"
		
		"\n\n\![*]\__q[OnMusicPlayer.Settings,Hotkeys,%(reference0),%(_temp)]Abbrechen\__q"
	}
	elseif language == "Русский"
	{
		if reference0 == 1; _option = "следующая песня"
		elseif reference0 == 2; _option = "последняя песня"
		elseif reference0 == 3; _option = "перестать песня"
		elseif reference0 == 4; _option = "открыть меню"
		elseif reference0 == 5; _option = "переключение строка песни"
		elseif reference0 == 6; _option = "больше громкость"
		elseif reference0 == 7; _option = "меньше громкость"
		elseif reference0 == 8; _option = "больше скорость"
		elseif reference0 == 9; _option = "меньше скорость"
		elseif reference0 == 10; _option = "левой баланс"
		elseif reference0 == 11; _option = "правой баланс"
		else; _option =  "Играй/Пауза"
		
		"[Нажмите кнопку для %(_option).]"
		
		"\n\n\![*]\__q[OnMusicPlayer.Settings,Hotkeys,%(reference0),%(_temp)]Отменить\__q"
	}
	elseif language == "Français"
	{
		if reference0 == 1; _option = "musique suivante"
		elseif reference0 == 2; _option = "musique précédente"
		elseif reference0 == 3; _option = "stopper la musique"
		elseif reference0 == 4; _option = "ouvrir le menu"
		elseif reference0 == 5; _option = "toggle song bar" //TODO new translation need from here down to the end
		elseif reference0 == 6; _option = "volume up"
		elseif reference0 == 7; _option = "volume down"
		elseif reference0 == 8; _option = "speed up"
		elseif reference0 == 9; _option = "speed down"
		elseif reference0 == 10; _option = "balance left"
		elseif reference0 == 11; _option = "balance right"
		else; _option =  "Play/Pause"
		
		"[Presse une touche pour %(_option).]"
		
		"\n\n\![*]\__q[OnMusicPlayer.Settings,Hotkeys,%(reference0),%(_temp)]Annuler\__q"
	}
	elseif language == "Polski"
	{
		if reference0 == 1; _option = "następny utwór"
		elseif reference0 == 2; _option = "poprzedni utwór"
		elseif reference0 == 3; _option = "zatrzymaj utwór"
		elseif reference0 == 4; _option = "open menu"
		elseif reference0 == 5; _option = "toggle song bar" //TODO new translation need from here down to the end
		elseif reference0 == 6; _option = "volume up"
		elseif reference0 == 7; _option = "volume down"
		elseif reference0 == 8; _option = "speed up"
		elseif reference0 == 9; _option = "speed down"
		elseif reference0 == 10; _option = "balance left"
		elseif reference0 == 11; _option = "balance right"
		else; _option =  "Odtwarzanie/Pauza"
		
		"[Naciśnij przycisk, dla opcji '%(_option)'.]"
		
		"\n\n\![*]\__q[OnMusicPlayer.Settings,Hotkeys,%(reference0),%(_temp)]Anuluj\__q"
	}
	else //English
	{
		
		if reference0 == 1; _option = "next song"
		elseif reference0 == 2; _option = "previous song"
		elseif reference0 == 3; _option = "stop song"
		elseif reference0 == 4; _option = "open menu"
		elseif reference0 == 5; _option = "toggle song bar"
		elseif reference0 == 6; _option = "volume up"
		elseif reference0 == 7; _option = "volume down"
		elseif reference0 == 8; _option = "speed up"
		elseif reference0 == 9; _option = "speed down"
		elseif reference0 == 10; _option = "balance left"
		elseif reference0 == 11; _option = "balance right"
		else; _option =  "play/pause"
		
		"[Press a key for %(_option).]"
		
		"\n\n\![*]\__q[OnMusicPlayer.Settings,Hotkeys,%(reference0),%(_temp)]Cancel\__q"
	}
	
	"\![unlock,balloonrepaint]\e changing hotkey: %(reference0)" //DO NOT TOUCH THIS. It will not work if you erase or change this.
}

//Unbinding the hotkey
OnMusicPlayer.UnsetHotkey
{
	reference0 = TOINT(reference0)
	MusicPlayer.Hotkeys[reference0] = "Unbound"
	reference0 = "Hotkeys" //Setting this so that it goes back to the right menu tab after
	
	OnMusicPlayer.Settings
}


OnMusicPlayer.Info : all
{
	"\C%(MusicPlayer.Scope)\![lock,balloonrepaint]\c%(MusicPlayer.LargeBalloon)\![quicksection,1]\![no-autopause]"
	
	//TODO TRANSLATION the one about file types needs translated
	if language == "Placeholder" //TRANSLATORS: The various things users can ask about in the info menu
	{
		
	}
	elseif language == "Español"
	{
		"\![*]\__q[OnMusicPlayer.MusicInfo,addsong]¿Cómo añadir una pista?\__q\n"
		"\![*]\__q[OnMusicPlayer.MusicInfo,compatiblefiles]¿Qué tipo de archivos son compatibles?\__q\n"
		"\![*]\__q[OnMusicPlayer.MusicInfo,error]¿Por qué algunas pistas dan error\__q\n"
		"\n"
		"\![*]\__q[OnMusicPlayer.Menu]Volver a Controles de Música\__q  \![*]\__q[OnBlank]Cerrar ventana\__q"
	}
	elseif language == "Deutsch"
	{
		"\![*]\__q[OnMusicPlayer.MusicInfo,addsong]Wie füge ich ein Lied hinzu?\__q\n"
		"\![*]\__q[OnMusicPlayer.MusicInfo,compatiblefiles]What file types are compatible?\__q\n"
		"\![*]\__q[OnMusicPlayer.MusicInfo,error]Warum erzeugen manche Lieder einen Fehler?\__q\n"
		"\n"
		"\![*]\__q[OnMusicPlayer.Menu]Zurück zum Musikmenü\__q  \![*]\__q[OnBlank]Fenster schließen\__q"
	}
	elseif language == "Русский"
	{
		"\![*]\__q[OnMusicPlayer.MusicInfo,addsong]Как добавить песня?\__q\n"
		"\![*]\__q[OnMusicPlayer.MusicInfo,compatiblefiles]У какие типы файли есть совместимость?\__q\n"
		"\![*]\__q[OnMusicPlayer.MusicInfo,error]Почему какие-то песни отдают мне ошибка?\__q\n"
		"\n"
		"\![*]\__q[OnMusicPlayer.Menu]Назад в меню музыкы\__q  \![*]\__q[OnBlank]Закрыть\__q"
	}
	elseif language == "Français"
	{
		"\![*]\__q[OnMusicPlayer.MusicInfo,addsong]Comment ajouter une musique ?\__q\n"
		"\![*]\__q[OnMusicPlayer.MusicInfo,compatiblefiles]What file types are compatible?\__q\n"
		"\![*]\__q[OnMusicPlayer.MusicInfo,error]Pourquoi certaines musiques donnent une erreur ?\__q\n"
		"\n"
		"\![*]\__q[OnMusicPlayer.Menu]Retour au menu des musiques\__q  \![*]\__q[OnBlank]Fermer la fenêtre\__q"
	}
	elseif language == "Polski"
	{
		"\![*]\__q[OnMusicPlayer.MusicInfo,addsong]Jak dodać piosenkę?\__q\n"
		"\![*]\__q[OnMusicPlayer.MusicInfo,compatiblefiles]What file types are compatible?\__q\n"
		"\![*]\__q[OnMusicPlayer.MusicInfo,error]Dlaczego w niektórych utworach pojawia się error?\__q\n"
		"\n"
		"\![*]\__q[OnMusicPlayer.Menu]Powrót do menu muzycznego\__q  \![*]\__q[OnBlank]Zamknij\__q"
	}
	else //English
	{
		"\![*]\__q[OnMusicPlayer.MusicInfo,addsong]How do I add a song?\__q\n"
		"\![*]\__q[OnMusicPlayer.MusicInfo,compatiblefiles]What file types are compatible?\__q\n"
		"\![*]\__q[OnMusicPlayer.MusicInfo,error]Why do some songs give an error?\__q\n"
		"\n"
		"\![*]\__q[OnMusicPlayer.Menu]Back to music menu\__q  \![*]\__q[OnBlank]Close window\__q"
	}
}

//Information that the user can ask about
OnMusicPlayer.MusicInfo : all
{
	_h = "\f[color,default.anchor]" //highlight
	_d = "\f[color,default]" //default
	
	"\C%(MusicPlayer.Scope)\![lock,balloonrepaint]\c%(MusicPlayer.LargeBalloon)\![quicksection,1]\![no-autopause]\![set,autoscroll,disable]"
	
	//TODO TRANSLATION I revamped these dialogues, they need translated again...
	if language == "Placeholder" //TRANSLATORS: These are the questions the user can ask about how FLUX works. Only translate the dialogues, not the reference0 checks
	{
		
	}
	elseif language == "Español"
	{
		if reference0 == "addsong" //Asking how to add songs
		{
			"[Para añadir pistas arrastra y suéltalas sobre el reproductor FLUX. Las carpetas también pueden ser arrastradas y soltadas, y varios archivos pueden ser soltados a la vez.]\n\n\![]"
			"[También puedes usar la opción ""Abrir archivo"" de SSP para seleccionar un archivo a través del Explorador de archivos. Esto se puede hacer usando el atajo de teclado Ctrl + O , o haciendo click derecho sobre el ghost, yendo a la pestaña Utilities y pulsando ""Open File (I)"".]\n\n\![]"
			"[Las listas de reproducción .m3u pueden ser cargadas a través del menú de ajustes o usando los mismos métodos descritos previamente para las pistas.]"
		}
		elseif reference0 == "compatiblefiles" //What file types are compatible
		{
			"[Por predeterminado, los siguientes archivos son compatibles con este reproductor de música:]\n"
			"%(_h).mp3  .wav  .wma  .mid%(_d).\n\n\![]"
			"[Con \_a[https://github.com/Nevcairiel/LAVFilters/releases]LAV Filters\_a instalado, los siguientes archivos son compatibles con este reproductor de música:]"
			"\n"
			
			_i = 0
			foreach MusicPlayer.CompatibleMusicFileTypes; _type
			{
				if _i >= 3; _i = 0
				
				if _i == 1; "\_l[0]\_l[4em]"
				elseif _i == 2; "\_l[0]\_l[8em]"
				else; "\n"
				
				_i++
				"%(_h)%(_type)%(_d)"
			}
		}
		elseif reference0 == "error" //Asking why some songs give errors
		{
			"[Algunas pistas no se reproducirán a pesar de ser del formato correcto. Esto es una limitación por parte de SSP. Puedes instalar \_a[https://github.com/Nevcairiel/LAVFilters/releases]LAV Filters\_a, un programa de código abierto para arreglar la mayoría de estos errores.]\n\n\![]"
			"[Si no quieres hacerlo, puedes importar una pista en un programa de edición de audio como \_a[https://www.audacityteam.org/]Audacity\_a y exportarla de nuevo, o convirtiéndola en otro formato compatible con algo como \_a[https://www.onlineconverter.com/]Online Converter\_a.]"
		}
	}
	elseif language == "Deutsch" //TODO new translation all of these probably need updated, sorry...
	{
		if reference0 == "addsong" //Asking how to add songs
		{
			"[To add songs, drag and drop them onto FLUX player. Folders can also be dragged and dropped, and multiple files may be dropped at a time.]\n\n\![]"
			"[You can also use the ""Open File"" option built into SSP to select a file through File Explorer. This can be done using the Ctrl + O shortcut, or by right clicking the ghost, going to the Utilities tab, and clicking ""Open File (I)"".]\n\n\![]"
			"[.m3u and .m3u8 playlists can be loaded through the settings menu, or by using the same methods described above for songs.]"
		}
		elseif reference0 == "compatiblefiles" //What file types are compatible
		{
			"[By default, the following file types are compatible with this music player:]\n"
			"%(_h).mp3  .wav  .wma  .mid%(_d).\n\n\![]"
			"[With \_a[https://github.com/Nevcairiel/LAVFilters/releases]LAV Filters\_a installed, the following file types are compatible with this music player:]"
			"\n"
			
			_i = 0
			foreach MusicPlayer.CompatibleMusicFileTypes; _type
			{
				if _i >= 3; _i = 0
				
				//CUSTOMIZE: If you're using a particularly small balloon and the file types are not displaying properly, you may want to use this commented version instead of the code below it
				/*
				if _i != 0; "    "
				else; "\n"
				*/
				
				if _i == 1; "\_l[0]\_l[4em]"
				elseif _i == 2; "\_l[0]\_l[8em]"
				else; "\n"
				
				_i++
				"%(_h)%(_type)%(_d)"
			}
		}
		elseif reference0 == "error" //Asking why some songs give errors
		{
			"[Some songs will not play despite being the correct type. This is an SSP limitation. You can install \_a[https://github.com/Nevcairiel/LAVFilters/releases]LAV Filters\_a, an open source program, to fix most of these errors.]\n\n\![]"
			"[If you don't want to do that, you can import a song into an audio editing program like \_a[https://www.audacityteam.org/]Audacity\_a and export it again, or convert it to another compatible type with something like \_a[https://www.onlineconverter.com/]Online Converter\_a.]"
		}
	}
	elseif language == "Русский"
	{
		if reference0 == "addsong" //Asking how to add songs
		{
			"[Чтобы добавить песни, перетаскивай их на плеер FLUX. Тоже можешь перетаскивать папки, и больше чем один файл в раз.]\n\n\![]"
			"[Можешь и использовать настроек ""Открыть файл"" в SSP чтобы выбирать файл через Проводник. Можно быть сделано с использование ярлык Ctrl + O, или нажмение правой кнопкай мыши на укагаку, ход во вкладки Утилиты, а потом нажми ""Открыть файл (I)"".]\n\n\![]"
			"[Плэйлисты .m3u и .m3u8 могуть быть загружены через меню настройки, или тот же самый метод, как и песни.]"
		}
		elseif reference0 == "compatiblefiles" //What file types are compatible
		{
			"[По умолчанию, у эти типы файли есть совместимость с этот плеер:]\n"
			"%(_h).mp3  .wav  .wma  .mid%(_d).\n\n\![]"
			"[Если установлен \_a[https://github.com/Nevcairiel/LAVFilters/releases]LAV Filters\_a, у эти типы тоже есть совместимость:]"
			"\n"
			
			_i = 0
			foreach MusicPlayer.CompatibleMusicFileTypes; _type
			{
				if _i >= 3; _i = 0
				
				if _i == 1; "\_l[0]\_l[4em]"
				elseif _i == 2; "\_l[0]\_l[8em]"
				else; "\n"
				
				_i++
				"%(_h)%(_type)%(_d)"
			}
		}
		elseif reference0 == "error" //Asking why some songs give errors
		{
			"[Некоторые песни не будеть играть, хотя и правильный тип. Это - лимитация SSP. Можешь установить \_a[https://github.com/Nevcairiel/LAVFilters/releases]LAV Filters\_a, программа с открытым кодом, чтобы управлять большинство эти ошибки.]\n\n\![]"
			"[Если то не хочешь сделать, можешь импортировать песню в редактор музыки, например \_a[https://www.audacityteam.org/]Audacity\_a, а экспортировать её вновь, или конвертировать её в другой тип с помощью что-то как \_a[https://www.onlineconverter.com/]Online Converter\_a.]"
		}
	}
	elseif language == "Français"
	{
		if reference0 == "addsong" //Asking how to add songs
		{
			"[To add songs, drag and drop them onto FLUX player. Folders can also be dragged and dropped, and multiple files may be dropped at a time.]\n\n\![]"
			"[You can also use the ""Open File"" option built into SSP to select a file through File Explorer. This can be done using the Ctrl + O shortcut, or by right clicking the ghost, going to the Utilities tab, and clicking ""Open File (I)"".]\n\n\![]"
			"[.m3u playlists can be loaded through the settings menu, or by using the same methods described above for songs.]"
		}
		elseif reference0 == "compatiblefiles" //What file types are compatible
		{
			"[By default, the following file types are compatible with this music player:]\n"
			"%(_h).mp3  .wav  .wma  .mid%(_d).\n\n\![]"
			"[With \_a[https://github.com/Nevcairiel/LAVFilters/releases]LAV Filters\_a installed, the following file types are compatible with this music player:]"
			"\n"
			
			_i = 0
			foreach MusicPlayer.CompatibleMusicFileTypes; _type
			{
				if _i >= 3; _i = 0
				
				//CUSTOMIZE: If you're using a particularly small balloon and the file types are not displaying properly, you may want to use this commented version instead of the code below it
				/*
				if _i != 0; "    "
				else; "\n"
				*/
				
				if _i == 1; "\_l[0]\_l[4em]"
				elseif _i == 2; "\_l[0]\_l[8em]"
				else; "\n"
				
				_i++
				"%(_h)%(_type)%(_d)"
			}
		}
		elseif reference0 == "error" //Asking why some songs give errors
		{
			"[Some songs will not play despite being the correct type. This is an SSP limitation. You can install \_a[https://github.com/Nevcairiel/LAVFilters/releases]LAV Filters\_a, an open source program, to fix most of these errors.]\n\n\![]"
			"[If you don't want to do that, you can import a song into an audio editing program like \_a[https://www.audacityteam.org/]Audacity\_a and export it again, or convert it to another compatible type with something like \_a[https://www.onlineconverter.com/]Online Converter\_a.]"
		}
	}
	elseif language == "Polski"
	{
		if reference0 == "addsong" //Asking how to add songs
		{
			"[To add songs, drag and drop them onto FLUX player. Folders can also be dragged and dropped, and multiple files may be dropped at a time.]\n\n\![]"
			"[You can also use the ""Open File"" option built into SSP to select a file through File Explorer. This can be done using the Ctrl + O shortcut, or by right clicking the ghost, going to the Utilities tab, and clicking ""Open File (I)"".]\n\n\![]"
			"[.m3u playlists can be loaded through the settings menu, or by using the same methods described above for songs.]"
		}
		elseif reference0 == "compatiblefiles" //What file types are compatible
		{
			"[By default, the following file types are compatible with this music player:]\n"
			"%(_h).mp3  .wav  .wma  .mid%(_d).\n\n\![]"
			"[With \_a[https://github.com/Nevcairiel/LAVFilters/releases]LAV Filters\_a installed, the following file types are compatible with this music player:]"
			"\n"
			
			_i = 0
			foreach MusicPlayer.CompatibleMusicFileTypes; _type
			{
				if _i >= 3; _i = 0
				
				//CUSTOMIZE: If you're using a particularly small balloon and the file types are not displaying properly, you may want to use this commented version instead of the code below it
				/*
				if _i != 0; "    "
				else; "\n"
				*/
				
				if _i == 1; "\_l[0]\_l[4em]"
				elseif _i == 2; "\_l[0]\_l[8em]"
				else; "\n"
				
				_i++
				"%(_h)%(_type)%(_d)"
			}
		}
		elseif reference0 == "error" //Asking why some songs give errors
		{
			"[Some songs will not play despite being the correct type. This is an SSP limitation. You can install \_a[https://github.com/Nevcairiel/LAVFilters/releases]LAV Filters\_a, an open source program, to fix most of these errors.]\n\n\![]"
			"[If you don't want to do that, you can import a song into an audio editing program like \_a[https://www.audacityteam.org/]Audacity\_a and export it again, or convert it to another compatible type with something like \_a[https://www.onlineconverter.com/]Online Converter\_a.]"
		}
	}
	else //English
	{
		if reference0 == "addsong" //Asking how to add songs
		{
			"[To add songs, drag and drop them onto FLUX player. Folders can also be dragged and dropped, and multiple files may be dropped at a time.]\n\n\![]"
			"[You can also use the ""Open File"" option built into SSP to select a file through File Explorer. This can be done using the Ctrl + O shortcut, or by right clicking the ghost, going to the Utilities tab, and clicking ""Open File (I)"".]\n\n\![]"
			"[.m3u and .m3u8 playlists can be loaded through the settings menu, or by using the same methods described above for songs.]"
		}
		elseif reference0 == "compatiblefiles" //What file types are compatible
		{
			"[By default, the following file types are compatible with this music player:]\n"
			"%(_h).mp3  .wav  .wma  .mid%(_d).\n\n\![]"
			"[With \_a[https://github.com/Nevcairiel/LAVFilters/releases]LAV Filters\_a installed, the following file types are compatible with this music player:]"
			"\n"
			
			_i = 0
			foreach MusicPlayer.CompatibleMusicFileTypes; _type
			{
				if _i >= 3; _i = 0
				
				if _i == 1; "\_l[0]\_l[4em]"
				elseif _i == 2; "\_l[0]\_l[8em]"
				else; "\n"
				
				_i++
				"%(_h)%(_type)%(_d)"
			}
		}
		elseif reference0 == "error" //Asking why some songs give errors
		{
			"[Some songs will not play despite being the correct type. This is an SSP limitation. You can install \_a[https://github.com/Nevcairiel/LAVFilters/releases]LAV Filters\_a, an open source program, to fix most of these errors.]\n\n\![]"
			"[If you don't want to do that, you can import a song into an audio editing program like \_a[https://www.audacityteam.org/]Audacity\_a and export it again, or convert it to another compatible type with something like \_a[https://www.onlineconverter.com/]Online Converter\_a.]"
		}
	}
	
	
	
	"\n\n\![*]\__q[OnMusicPlayer.Info]Back\__q  \![*]\__q[OnBlank]Close window\__q"
	"\![unlock,balloonrepaint]"
}

OnMusicPlayer.SavePlaylist : all
{
	"\C\![lock,balloonrepaint]\c%(MusicPlayer.Scope)%(MusicPlayer.LargeBalloon)\![quicksection,1]\![set,autoscroll,disable]\![no-autopause]"
	"\![open,dialog,save,--id=OnMusicPlayer.PlaylistSaved,--ext=m3u,--filter=%(label.PlaylistFile)|*.m3u,--dir=""%(MusicPlayer.PlaylistPath)""]"
	
	if language == "Placeholder" //TRANSLATORS: When the user is saving a playlist //TODO new translation
	{
		
	}
	elseif language == "Español"
	{
		"[Elige un nombre y ubicación para la lista de reproducción.]\![*]"
		"\n\n"
		"\![*]\__q[OnPlaylist.Back,Saved]Volver\__q"
	}
	elseif language == "Deutsch"
	{
		"[Choose a file name and location for the playlist.]"
		"\n\n"
		"\![*]\__q[OnPlaylist.Back,Saved]Back\__q"
	}
	elseif language == "Русский"
	{
		"[Выбирай имя файл а место для плэйлист.]\![*]"
		"\n\n"
		"\![*]\__q[OnPlaylist.Back,Saved]Назад\__q"
	}
	elseif language == "Français"
	{
		"[Choose a file name and location for the playlist.]"
		"\n\n"
		"\![*]\__q[OnPlaylist.Back,Saved]Back\__q"
	}
	elseif language == "Polski"
	{
		"[Choose a file name and location for the playlist.]"
		"\n\n"
		"\![*]\__q[OnPlaylist.Back,Saved]Back\__q"
	}
	else //English
	{
		"[Choose a file name and location for the playlist.]"
		"\n\n"
		"\![*]\__q[OnPlaylist.Back,Saved]Back\__q"
	}
	
	"\![unlock,balloonrepaint]"
}

OnMusicPlayer.PlaylistSaved : all
{
	_path = reference2
	_o = FOPEN(_path,"w") //Create a new file
	
	for _i = 0; _i < ARRAYSIZE(MusicPlayer.CurrentPlaylist); _i++
	{
		void FWRITE(_path,"%(MusicPlayer.CurrentPlaylist[_i])")
	}
	
	void FCLOSE(_path)
	
	_split = SPLITPATH(reference2)
	_name = _split[2]
	MusicPlayer.PlaylistPath = _split[0] + _split[1]
	
	
	"\C%(MusicPlayer.Scope)\![lock,balloonrepaint]\c%(MusicPlayer.LargeBalloon)\![quicksection,1]\![no-autopause]"
	
	if language == "Placeholder" //TRANSLATORS: Once the playlist has been saved, or saving has failed. Use _name as the playlist name
	{
		
	}
	elseif language == "Español"
	{
		if _o == 1 //If it saves successfully
		{
			"[La lista de reproducción '%(_name)' ha sido guardada con éxito.]"
		}
		else //If saving fails
		{
			if ISFUNC("OnCustom_ActionSurfaces") && CustomFuncs[0] == 1; "\![embed,OnCustom_ActionSurfaces,Error]"
			else; "\s[6]"
			
			"[Error al guardar lista de reproducción.]"
		}
	}
	elseif language == "Deutsch"
	{
		if _o == 1 //If it saves successfully
		{
			"[Playlist wurde erfolgreich als ""\_?%(_name).m3u\_?"" gespeichert.]"
		}
		else //If saving fails
		{
			if ISFUNC("OnCustom_ActionSurfaces") && CustomFuncs[0] == 1; "\![embed,OnCustom_ActionSurfaces,Error]"
			else; "\s[6]"
			
			"[Speichervorgang fehlgeschlagen.]"
		}
	}
	elseif language == "Русский"
	{
		
		if _o == 1 //If it saves successfully
		{
			"[Плейлист сохранен как ""\_?%(_name).m3u\_?"".]"
		}
		else //If saving fails
		{
			if ISFUNC("OnCustom_ActionSurfaces") && CustomFuncs[0] == 1; "\![embed,OnCustom_ActionSurfaces,Error]"
			else; "\s[6]"
			
			"[Не удалось сохранить.]"
		}
	}
	elseif language == "Français"
	{
		if _o == 1 //If it saves successfully
		{
			"[Playlist sauvegardée avec succès en tant que ""\_?%(_name).m3u\_?"".]"
		}
		else //If saving fails
		{
			if ISFUNC("OnCustom_ActionSurfaces") && CustomFuncs[0] == 1; "\![embed,OnCustom_ActionSurfaces,Error]"
			else; "\s[6]"
			
			"[Echec de la sauvegarde de la playlist.]"
		}
	}
	elseif language == "Polski"
	{
		
		if _o == 1 //If it saves successfully
		{
			"[Lista odtwarzania zapisana pomyślnie jako ""\_?%(_name).m3u\_?"".]"
		}
		else //If saving fails
		{
			if ISFUNC("OnCustom_ActionSurfaces") && CustomFuncs[0] == 1; "\![embed,OnCustom_ActionSurfaces,Error]"
			else; "\s[6]"
			
			"[Nie udało się zapisać listy odtwarzania.]"
		}
	}
	else //English
	{
		if _o == 1 //If it saves successfully
		{
			"[Playlist saved successfully as ""\_?%(_name).m3u\_?"".]"
		}
		else //If saving fails
		{
			if ISFUNC("OnCustom_ActionSurfaces") && CustomFuncs[0] == 1; "\![embed,OnCustom_ActionSurfaces,Error]"
			else; "\s[6]"
			
			"[Failed to save playlist.]"
		}
	}
	
	"\![unlock,balloonrepaint]\x[noclear]\![raise,OnMusicPlayer.Settings]"
}

OnPlaylist.Back
{
	"\C\![close,dialog,OnMusicPlayer.Playlist%(reference0)]\![raise,OnMusicPlayer.Settings]"
}

OnMusicPlayer.LoadPlaylist : all
{
	"\C\![lock,balloonrepaint]\c%(MusicPlayer.Scope)%(MusicPlayer.LargeBalloon)\![quicksection,1]\![set,autoscroll,disable]\![no-autopause]"
	"\![open,dialog,open,--id=OnMusicPlayer.PlaylistLoaded,--filter=%(label.PlaylistFile)|*.m3u|%(label.PlaylistFile) (UTF-8)|*.m3u8,--dir=""%(MusicPlayer.PlaylistPath)""]"
	
	if language == "Placeholder" //TRANSLATORS: This is for the dialogue that appears while loading a playlist //TODO new translation
	{
		
	}
	elseif language == "Español"
	{
		"[Escoge una lista de reproducción para cargar.]\n\n\![]"
		"[La lista de reproducción actual se perderá al menos que ya haya sido guardada previamente.]"
		"\n\n"
		"\![*]\__q[OnPlaylist.Back,Loaded]Volver\__q"
	}
	elseif language == "Deutsch"
	{
		"[Select a playlist to load.]\n\n\![]"
		"[The current playlist will be lost unless it is already saved.]"
		"\n\n"
		"\![*]\__q[OnPlaylist.Back,Loaded]Back\__q"
	}
	elseif language == "Русский"
	{
		"[Выбирай плэйлист, чтобы играть.]\n\n\![]"
		"[Текущий плэйлист, если не сохранен, будет потерянный.]"
		"\n\n"
		"\![*]\__q[OnPlaylist.Back,Loaded]Назад\__q"
	}
	elseif language == "Français"
	{
		"[Select a playlist to load.]\n\n\![]"
		"[The current playlist will be lost unless it is already saved.]"
		"\n\n"
		"\![*]\__q[OnPlaylist.Back,Loaded]Back\__q"
	}
	elseif language == "Polski"
	{
		"[Select a playlist to load.]\n\n\![]"
		"[The current playlist will be lost unless it is already saved.]"
		"\n\n"
		"\![*]\__q[OnPlaylist.Back,Loaded]Back\__q"
	}
	else //English
	{
		"[Select a playlist to load.]\n\n\![]"
		"[The current playlist will be lost unless it is already saved.]"
		"\n\n"
		"\![*]\__q[OnPlaylist.Back,Loaded]Back\__q"
	}
	
	"\![unlock,balloonrepaint]"
}

//Loading the playlist
OnMusicPlayer.PlaylistLoaded : all
{
	_new_playlist = IARRAY
	_new_playlist_path = ""
	
	_path = reference2
	_split = SPLITPATH(reference2)
	_new_playlist_path = _split[0] + _split[1]
	_new_playlist_path = REPLACE(_new_playlist_path,"\","/")
	
	_original_charset = GETSETTING("charset.file")
	if TOLOWER(_split[3]) == ".m3u8"; FCHARSET("UTF-8")
	
	_skipped = 0
	void FOPEN(_path,"r")
	for _buff = FREAD(_path); _buff != -1; _buff = FREAD(_path)
	{
		if _buff == ""; continue
		_buff = REPLACE(_buff,"\","/")
		
		//Skip directives. Yes, songs with relative filepaths that start with # will be ignored. Making M3U directives start with a character that is valid in file names was a poor design choice. Foobar2000 does the same thing!
		if SUBSTR(_buff,0,1) == "#"; continue //Not counting directives because most of the time they aren't songs
		
		//Skip all urls, the music player can't handle them
		if SUBSTR(_buff,0,5) == "http:" || SUBSTR(_buff,0,6) == "https:"; {_skipped++; continue}
		
		//Skip anything with an incompatible extension
		_extension = TOLOWER(SPLITPATH(_buff)[3])
		if ASEARCH(_extension,MusicPlayer.CompatibleMusicFileTypes) == -1; {_skipped++; continue}
		
		
		_to_add = ""
		//Check for relative file paths. If there's no : it must be starting from the root. This must be done for each one because they can be mixed.
		if ":" !_in_ _buff; _to_add += _new_playlist_path
		_to_add += _buff
		
		_new_playlist ,= _to_add
	}
	void FCLOSE(_path)
	
	FCHARSET(_original_charset)
	
	if ARRAYSIZE(_new_playlist) == 0
	{
		"\![quicksection,1]"
		//TODO new translation
		if language == "Placeholder" //TRANSLATORS: The playlist could not be loaded due to no compatible files being found inside
		{
			
		}
		elseif language == "Español"
		{
			
		}
		elseif language == "Deutsch"
		{
			
		}
		elseif language == "Русский"
		{
			"[Совместимые песни в этом плейлисти не найдено. Загружение отменил.]"
		}
		elseif language == "Français"
		{
			
		}
		elseif language == "Polski"
		{
			
		}
		else //English
		{
			"[No compatible songs were found in this playlist. Loading canceled.]"
		}
		"\x"
	}
	else
	{
		MusicPlayer.CurrentSongIndex = -1
		MusicPlayer.PlayState = 0
		MusicPlayer.PageIndex = 0
		MusicPlayer.CurrentPlaylist = _new_playlist
		MusicPlayer.PlaylistPath = _new_playlist_path
		
		MusicPlayer.ShuffledPlaylist = MusicPlayer.ShufflePlaylist(MusicPlayer.CurrentSongIndex,MusicPlayer.CurrentPlaylist)
		MusicPlayer.ShuffledIndex = 0
		
		"%(MusicPlayer.Scope)%(MusicPlayer.NonSingingSurfaces)\![no-autopause]"
	
		"\![sound,stop]\![no-autopause]%(OnMusicPlayer.NotifySongInfo)"
	
		if _skipped > 0
		{
			"\![quicksection,1]"
			//TODO new translation
			if language == "Placeholder" //TRANSLATORS: The playlist was loaded but some songs were skipped due to incompatibility (urls, file types it can't handle, etc.). _skipped has the number of songs that could not be loaded.
			{
				
			}
			elseif language == "Español"
			{
				
			}
			elseif language == "Deutsch"
			{
				
			}
			elseif language == "Русский"
			{
				_и = "и"; if _skipped == 1; _и = "я"
				_ые = "ие"; if _skipped == 1; _ые = "ая"
				"[Плэйлист загружен, но %(_skipped) несовместим%(_ые) песн%(_и) пропустил.]"
			}
			elseif language == "Français"
			{
				
			}
			elseif language == "Polski"
			{
				
			}
			else //English
			{
				_s = "s"; if _skipped == 1; _s = ""
				"[Playlist loaded, however, %(_skipped) incompatible song%(_s) were skipped.]"
			}
			"\x"
		}
	}
	
	OnMusicPlayer.Menu
}

//Confirmation before clearing the current playlist
OnMusicPlayer.ClearPlaylist : all
{
	_num = ARRAYSIZE(MusicPlayer.CurrentPlaylist)
	
	"\C\![lock,balloonrepaint]\c"
	"%(MusicPlayer.Scope)%(MusicPlayer.LargeBalloon)\![quicksection,1]\![no-autopause]"
	
	//DIALOGUE: Asking for confirmation before clearing the current playlist. %(_are) and %(_s) can be used for plurals.
	
	
	if language == "Placeholder" //TRANSLATORS: Confirmation dialogue for clearing the current playlist. _num is the number of songs in the playlist
	{
		
	}
	elseif language == "Español"
	{
		"[Hay %(_num) pistas en la lista de reproducción actual. ¿Seguro qué quieres vaciarla? No podrá ser recuperada al menos que la hayas guardado.]"
		
		"\n\n"
		"\![*]\__q[OnPlaylistCleared]Vaciar\__q  \![*]\__q[OnMusicPlayer.Settings]No\__q"
	}
	elseif language == "Deutsch" //TODO new translation I added plural checks to these... otherwise it is the same
	{
		"[Es sind %(_num) Lieder in der aktuellen Playlist. Bist du sicher, dass du sie leeren möchtest? Sie kann nicht wiederhergestellt werden wenn sie nicht gespeichert wurde.]"
		
		"\n\n"
		"\![*]\__q[OnMusicPlayer.PlaylistCleared]Leeren\__q  \![*]\__q[OnMusicPlayer.Settings]Abbrechen\__q"
	}
	elseif language == "Русский"
	{
		"[В этом плейлисте %(_num) песни. Ты уверен, что хочешь отчистить? Если не был сохраненно, ты не можешь его вернуть.]"
		
		"\n\n"
		"\![*]\__q[OnMusicPlayer.PlaylistCleared]Отчистить\__q  \![*]\__q[OnMusicPlayer.Settings]Не отчистить\__q"
	}
	elseif language == "Français"
	{
		"[Il y a %(_num) musiques dans la playlist actuelle. Es-tu sûr de vouloir la vider ? Tu ne pourras pas la récuperer à moins que tu ne l'ais sauvegardée.]"
		
		"\n\n"
		"\![*]\__q[OnMusicPlayer.PlaylistCleared]La vider\__q  \![*]\__q[OnMusicPlayer.Settings]Ne pas le faire\__q"
	}
	elseif language == "Polski"
	{
		"[W tej playliście jest %(_num) utworów. Czy na pewno chcesz ją wyczyścić? Nie można jej przywrócić, jeśli nie została zapisana..]"
		
		"\n\n"
		"\![*]\__q[OnMusicPlayer.PlaylistCleared]Wyczyść\__q  \![*]\__q[OnMusicPlayer.Settings]Nie czyść\__q"
	}
	else //English
	{
		_are = "are"; _s = "s"
		if _num == 1; {_are = "is"; _s = ""}
	
		"[There %(_are) %(_num) song%(_s) in the current playlist. Are you sure you want to clear it? It cannot be brought back unless you have saved it.]"
		
		"\n\n"
		"\![*]\__q[OnMusicPlayer.PlaylistCleared]Clear it\__q  \![*]\__q[OnMusicPlayer.Settings]Don't\__q"
	}
	"\![unlock,balloonrepaint]"
}

//Actually clearing the current playlist
OnMusicPlayer.PlaylistCleared : all
{
	MusicPlayer.CurrentPlaylist = IARRAY
	MusicPlayer.CurrentSongIndex = -1 //song position
	MusicPlayer.PlayState = 0 //Paused song
	MusicPlayer.PageIndex = 0
	
	"\C\![lock,balloonrepaint]\c"
	"\![sound,stop]\![no-autopause]%(OnMusicPlayer.NotifySongInfo)"
	
	"%(MusicPlayer.NonSingingSurfaces)%(MusicPlayer.LargeBalloon)\![quicksection,1]\![no-autopause]"
	
	if language == "Placeholder" //TRANSLATORS: This is if the user clears the playlist
	{
		
	}
	elseif language == "Español"
	{
		"[La lista de reproducción ha sido vaciada.]"
	}
	elseif language == "Deutsch"
	{
		"[Die Playlist wurde geleert.]"
	}
	elseif language == "Русский"
	{
		"[Плейлист отчистил.]"
	}
	elseif language == "Français"
	{
		"[La playlist a été vidée.]"
	}
	elseif language == "Polski"
	{
		"[Playlista została wyczyszczona..]"
	}
	else
	{
		"[The playlist has been cleared.]"
	}
	
	"\![unlock,balloonrepaint]"
	"\x\![raise,OnMusicPlayer.Menu]"
}

//Sending information about the current song to other open ghosts. Also sends information to Discord, if you set that up.
OnMusicPlayer.NotifySongInfo : all
{
	if MusicPlayer.DiscordDisplayFlag == 1
	{
		_song = " "
		if MusicPlayer.Singing
		{
			_song = "♫ %(MusicPlayer.CurrentSongName) ♫"
		}
		
		if MusicPlayer.DiscordDisplay == 1; "\![raiseplugin,Discord Rich Presence,OnDiscordPluginCustomState,""%(_song)""]"
		else; "\![raiseplugin,Discord Rich Presence,OnDiscordPluginCustomState, ]"
	}
	
	"\![notifyother,__SYSTEM_ALL_GHOST__,OnMusicPlayer.SongInfo,""%(selfname)"",""%(MusicPlayer.CurrentSongPath)"",%(MusicPlayer.CurrentSongIndex),%(MusicPlayer.PlayState),%(MusicPlayer.Volume),%(MusicPlayer.Speed),%(MusicPlayer.Balance),%(MusicPlayer.PlayMode),%(MusicPlayer.StopAfterCurrent),%(ARRAYSIZE(MusicPlayer.CurrentPlaylist))]"
	
	//References:
	//0 - The sakura name of this ghost, since this event may come from multiple ghosts
	//1 - The file path of the currently playing song. If empty, no song is loaded. THIS IS NOT ESCAPED.
	//2 - The index number of the currently playing song. If the song is paused, the index number is still tracked. This probably isn't that useful but I feel like I'll regret it later if I don't add it.
	//3 - 0 if stopped, 1 if playing music, 2 if paused
	//4 - Current volume from 0 - 100
	//5 - Current speed, from 0 - 400 (see MusicPlayer.MaxRate function for more info). 100 is normal speed
	//6 - Current balance. 0 is normal, -100 is all the way left, 100 is all the way right
	//7 - The play mode. 0 for loop playlist, 1 for shuffle playlist, 2 for loop song, 3 for play one song, 4 for random
	//8 - "stop after playback" means it will stop after the current song, "stop after playlist" means it will stop when the playlist completes
	//9 - Number of songs in the current playlist
}






//—————————— FUNCTIONS THAT SHOULD BE CUSTOMIZED ——————————
//CUSTOMIZE: Functions that either must be customized, such as which surfaces are used for singing, as well as a few optional things you may want to tweak

//Surfaces used for singing animation
MusicPlayer.SingingSurfaces
{
	"\s[25]"
}

//Surfaces to go to when music stops
MusicPlayer.NonSingingSurfaces
{
	"\s[0]"
}

//Which scope will be used as the music player. \0 for the sakura, \1 for the kero, \p[*] for additional characters, replacing the * with the number of the character you want
MusicPlayer.Scope
{
	"\0"
}

//Which balloons will be used for the menus in the music player.
MusicPlayer.SmallBalloon
{
	"\b[0]"
}

MusicPlayer.LargeBalloon
{
	"\b[2]"
}

//The default path to save playlists to. You should probably leave this alone, but you can change it if you like. Just make sure it is a relative path within the ghost's folder; the ghost will try to create this folder if it does not exist.
MusicPlayer.DefaultPlaylistPath
{
	"../../playlists/"
}

//Maximum speed for the music player. Because of an SSP bug, this is capped at 435 at the time of writing. According to Ukadoc it should be able to go up to 10000. To avoid bugs I'm going to cap this at 400, but if the bug is fixed in the future you can change the rate to whatever cap you want here.
MusicPlayer.MaxRate
{
	400
}

//Replace this number with the number of lines in the balloon that you'll be using for the music menu.
//This is mostly used for the menu where you can change the order of songs in the playlist. This will be automatically set any time the user changes balloons, but it's good to make sure the initial value is correct. If you change balloons and then change back to your default, you can check %(MusicPlayer.BalloonLines) in script input to see what the default here should be.
MusicPlayer.DefaultBalloonLines
{
	20
}

//Used for the pagination option. If more/fewer songs would suit your balloon better, you can adjust how many songs are displayed per page here.
MusicPlayer.SongsPerPage
{
	10
}

/*
If you want to have a display on your main menu for the currently playing song, you need to add this after your \e in the menu:
__GHOST_MAIN_MENU__

This will let it know to run OnSakuraMenu again if the current song changes/stops/etc. If your menu is in a function other than OnSakuraMenu, you'll need to change it in a few places in this file. Ctrl F is your friend here.
I don't recommend using this if you have menu greetings, or if your menu otherwise does not open instantly.
*/







//—————————— BUILT IN SHIORI EVENTS ——————————
//These may or may not already exist in your ghost. You may need to make alterations to the code if you already have custom behavior for these functions. This is probably the hardest part of this music player to implement.

//When the user manually closes the balloon when it's still typing out dialogue.
OnBalloonBreak
{
	//Should make it so that if the user closes the balloon while the song is waiting to repeat, it repeats properly
	if "\![raise,OnSoundStop]" _in_ MusicPlayer.LastTalk; "\![raise,OnSoundStop]"
}

//Hotkeys. reference0 is the name of the key as displayed on the keycap. reference4, for SSP only, will have things like ctrl and alt, separated by commas.
//CUSTOMIZE: If you have OnKeyPress in your ghost already, you need to make it call this function if the hotkey changing menu is up, or if no other recognized hotkey is pressed. If you do not have OnKeyPress, then rename this to OnKeyPress
MusicPlayer.OnKeyPress : all
{
	reference0 = TOSTR(reference0)
	_key = TOUPPER(reference0)
	if MusicPlayer.ChangingHotkeys; MusicPlayer.HotkeyChange //If the hotkey input is open
	else //Actually using a hotkey
	{
		_inmenu = MusicPlayer.CheckWhichMenu
		
		if _key == MusicPlayer.Hotkeys[0] //Play/Pause
		{
			if MusicPlayer.MenuIsOpen; "\C"
			
			if MusicPlayer.PlayState == 0; "\![raise,OnMusicPlayer.PlaySong,,""%(_inmenu)""]"
			elseif MusicPlayer.PlayState == 2; "\![raise,OnMusicPlayer.PauseSong,""%(_inmenu)"",resume]"
			else; "\![raise,OnMusicPlayer.PauseSong,""%(_inmenu)"",pause]"
		}
		elseif _key == MusicPlayer.Hotkeys[1] //Next song
		{
			if MusicPlayer.PlayState != 0
			{
				if MusicPlayer.MenuIsOpen; "\C"
				
				"\![raise,OnMusicPlayer.NextSong,""%(_inmenu)""]"
			}
		}
		elseif _key == MusicPlayer.Hotkeys[2] //Previous song
		{
			if MusicPlayer.PlayState != 0
			{
				if MusicPlayer.MenuIsOpen; "\C"
				
				"\![raise,OnMusicPlayer.PrevSong,""%(_inmenu)""]"
			}
		}
		elseif _key == MusicPlayer.Hotkeys[3] //Stop song
		{
			if MusicPlayer.MenuIsOpen; "\C"
			
			"\![raise,OnMusicPlayer.StopSong,""%(_inmenu)""]"
		}
		elseif _key == MusicPlayer.Hotkeys[4] //Music menu
		{
			OnMusicPlayer.Menu("manual")
		}
		elseif _key == MusicPlayer.Hotkeys[5] //Song Bar
		{
			OnMusicPlayer.ToggleSongBar("Hotkey",_inmenu)
		}
		elseif _key == MusicPlayer.Hotkeys[6] //Volume up
		{
			OnMusicPlayer.QuickVolume("Up")
		}
		elseif _key == MusicPlayer.Hotkeys[7] //Volume down
		{
			OnMusicPlayer.QuickVolume("Down")
		}
		elseif _key == MusicPlayer.Hotkeys[8] //Speed up
		{
			OnMusicPlayer.QuickSpeed("Up")
		}
		elseif _key == MusicPlayer.Hotkeys[9] //Speed down
		{
			OnMusicPlayer.QuickSpeed("Down")
		}
		elseif _key == MusicPlayer.Hotkeys[10] //Balance left
		{
			OnMusicPlayer.QuickBalance("Left")
		}
		elseif _key == MusicPlayer.Hotkeys[11] //Balance right
		{
			OnMusicPlayer.QuickBalance("Right")
		}
	}
}

MusicPlayer.HotkeyChange : all
{
	_key = TOUPPER(reference0)
	"\C\![lock,balloonrepaint]\c\![no-autopause]%(MusicPlayer.Scope)%(MusicPlayer.LargeBalloon)\![quicksection,1]"
	_changing = TOINT(SPLIT(MusicPlayer.LastTalk,"changing hotkey: ")[1])
	
	//CUSTOMIZE: Customizable list of reserved hotkeys. Add in any hotkeys you've already used in your ghost to this array.
	_reserved_keys = ("T","R","F1")
	
	if ASEARCH(_key,_reserved_keys) != -1 //If it's reserved
	{
		"\0\b[0]"
		if ISFUNC("OnCustom_ActionSurfaces") && CustomFuncs[0] == 1; "\![embed,OnCustom_ActionSurfaces,Error]"
		else; "\s[6]"
		
		if language == "Placeholder" //TRANSLATORS: If the user tries to put in a hotkey that is reserved
		{
			
		}
		elseif language == "Español"
		{
			"[Ese atajo de teclado está en reserva. Por favor elija otro.]"
		}
		elseif language == "Deutsch"
		{
			"[Dieser Hotkey ist reserviert, bitte wähle einen anderen.]"
		}
		elseif language == "Русский"
		{
			"[Та клавища уже использовает. Пожалуйста, выбирать другую.]"
		}
		elseif language == "Français"
		{
			"[Cette touche est reservée, stp choisis-en une autre.]"
		}
		elseif language == "Polski"
		{
			"[Ten skrót jest zarezerwowany, proszę wybierz inny.]"
		}
		else //English
		{
			"[That hotkey is reserved, please choose another.]"
		}
		"\![unlock,balloonrepaint]\x"
	}
	elseif _key == MusicPlayer.Hotkeys[_changing] //Same option as was already entered
	{
		"\C\![raise,OnMusicPlayer.Settings,Hotkeys]"
		return
	}
	elseif ASEARCH(_key,MusicPlayer.Hotkeys) != -1 //If this hotkey is already selected for something else
	{
		"\0\b[0]"
		if ISFUNC("OnCustom_ActionSurfaces") && CustomFuncs[0] == 1; "\![embed,OnCustom_ActionSurfaces,Error]"
		else; "\s[6]"
		
		if language == "Placeholder" //TRANSLATORS: If the user tries to enter a hotkey that is already being used
		{
			
		}
		elseif language == "Español"
		{
			"[Ese atajo de teclado ya está en uso. Por favor quítelo antes de asignar otra opción.]"
		}
		elseif language == "Deutsch"
		{
			"[Dieser Hotkey ist bereits in Verwendung, bitte lösche ihn bevor du ihm eine andere Option zuordnest.]"
		}
		elseif language == "Русский"
		{
			"[Та клавища уже использовает. Пожалуйста, отчистить ее, чтобы изменить.]"
		}
		elseif language == "Français"
		{
			"[Cette touche est déjà utilisée, stp enlève-là avant de l'assigner à une autre option.]"
		}
		elseif language == "Polski"
		{
			"[Ten skrót jest już używany, wyczyść go, zanim przypiszesz go do innej opcji.]"
		}
		else //English
		{
			"[That hotkey is already in use, please clear it before assigning it to another option.]"
		}
		"\![unlock,balloonrepaint]\x"
	}
	else //If it's a valid key
	{
		MusicPlayer.Hotkeys[_changing] = _key
		"\C\![raise,OnMusicPlayer.Settings,Hotkeys]"
		return
	}
	
	"\![raise,OnMusicPlayer.ChangeHotkey,%(_changing)]"
}

//CUSTOMIZE: If you don't have OnMouseWheel in your ghost, you can rename this to just OnMouseWheel. Otherwise, you'll need to make your existing OnMouseWheel call this one.
OnMouseWheel
{
	_character = REPLACE(MusicPlayer.Scope,"\","")
	_character = REPLACE(_character,"p[","")
	_character = REPLACE(_character,"]","")
	
	if TOSTR(reference3) == _character
	{
		_amt = TOSTR(reference2)
		_direction = "Up"
		if SUBSTR(_amt,0,1) == "-"; _direction = "Down"
		
		if MusicPlayer.Scroll == 0
		{
			OnMusicPlayer.QuickVolume(_direction,1)
		}
		elseif MusicPlayer.Scroll == 1
		{
			OnMusicPlayer.QuickSpeed(_direction,1)
		}
		elseif MusicPlayer.Scroll == 2
		{
			if _direction == "Up"; _direction = "Right"
			else; _direction = "Left"
			
			OnMusicPlayer.QuickBalance(_direction,1)
		}
	}
}

//When you drop a file on the ghost that isn't something it can install
//reference0 is the file path, which is split up amongst the local variables below
OnFileDrop2 : all
{
	_filearray = SPLIT(reference.raw[0],C_BYTE1)
	
	if ARRAYSIZE(_filearray) == 1 //If it's a single file
	{
		_filepath = SPLITPATH(_filearray)
		_filename = _filepath[2]
		_fileext = TOLOWER(_filepath[3])
		
		//Incompatible audio types: cdda, cvs, cvsd, cvu, dvms, fssd, grst, htk, ima, prc, smp, sndr, sndt, sou, txw, vms, vox
		if ASEARCH(_fileext,MusicPlayer.CompatibleMusicFileTypes) != -1 //If it's a compatible music file
		{
			MusicPlayer.CurrentPlaylist ,= _filearray
			
			MusicPlayer.ShuffledPlaylist = MusicPlayer.ShufflePlaylist(MusicPlayer.CurrentPlaylist[MusicPlayer.CurrentIndex],MusicPlayer.CurrentPlaylist)
			MusicPlayer.ShuffledIndex = 0
			_from = MusicPlayer.CheckWhichMenu
			
			"%(MusicPlayer.Scope)%(MusicPlayer.SmallBalloon)\![quicksection,1]\![no-autopause]\![set,autoscroll,disable]"
			
			if language == "Placeholder" //TRANSLATORS: When the user drags a single compatible music file onto FLUX
			{
				
			}
			elseif language == "Español"
			{
				"[""\_?%(_filename)\_?"" añadida a lista de reproducción.]"
				
				"\n\n"
				"\![*]\__q[OnMusicPlayer.PlaySong,,""%(_from)"",justadded]Reproducir\__q\n"
				"\![*]\__q[OnMusicPlayer.Menu]Abrir Reproductor de Música\__q"
				"\n\n"
				"\![*]\__q[OnBlank]Cerrar\__q"
			}
			elseif language == "Deutsch"
			{
				"[""\_?%(Capitalize(_filename))\_?"" wurde zur Playlist hinzugefügt.]"
				
				"\n\n"
				"\![*]\__q[OnMusicPlayer.PlaySong,,""%(_from)"",justadded]Jetzt abspielen\__q\n"
				"\![*]\__q[OnMusicPlayer.Menu]Musik-Player öffnen\__q"
				"\n\n"
				"\![*]\__q[OnBlank]Schließen\__q"
			}
			elseif language == "Русский"
			{
				"[Добавил ""\_?%(_filename)\_?"" в плейлисте.]"
				
				"\n\n"
				"\![*]\__q[OnMusicPlayer.PlaySong,,""%(_from)"",justadded]Играй сейчас\__q\n"
				"\![*]\__q[OnMusicPlayer.Menu]Открыть плеер\__q"
				"\n\n"
				"\![*]\__q[OnBlank]Закрыть\__q"
			}
			elseif language == "Français"
			{
				"[""\_?%(_filename)\_?"" ajouté à la playlist.]"
				
				"\n\n"
				"\![*]\__q[OnMusicPlayer.PlaySong,,""%(_from)"",justadded]La lire maintenant\__q\n"
				"\![*]\__q[OnMusicPlayer.Menu]Ouvrir le lecteur de musique\__q"
				"\n\n"
				"\![*]\__q[OnBlank]Fermer\__q"
			}
			elseif language == "Polski"
			{
				
				"[Dodano ""\_?%(_filename)\_?"" do playlisty.]"
				
				"\n\n"
				"\![*]\__q[OnMusicPlayer.PlaySong,,""%(_from)"",justadded]Zagraj teraz\__q\n"
				"\![*]\__q[OnMusicPlayer.Menu]Otwórz player\__q"
				"\n\n"
				"\![*]\__q[OnBlank]Zamknij\__q"

			}
			else //English
			{
				"[Added ""\_?%(_filename)\_?"" to the playlist.]"
				
				"\n\n"
				"\![*]\__q[OnMusicPlayer.PlaySong,,""%(_from)"",justadded]Play it now\__q\n"
				"\![*]\__q[OnMusicPlayer.Menu]Open music player\__q"
				"\n\n"
				"\![*]\__q[OnBlank]Close\__q"
			}
		}
		elseif _fileext == ".m3u" || _fileext == ".m3u8" //If it's a playlist
		{
			"%(MusicPlayer.Scope)%(MusicPlayer.SmallBalloon)\![no-autopause]\![set,autoscroll,disable]\![quicksection,1]"
			
			//DIALOGUE: Confirming loading a playlist after drag and drop
			//TODO TRANSLATION need a new translation here
			if language == "Placeholder" //TRANSLATORS: If the user drags and drops a .m3u playlist onto FLUX, it will ask if they want to load it, overwriting their current playlist
			{
				
			}
			elseif language == "Español"
			{
				"[¿Cargar la lista de reproducción ""\_?%(_filename)\_?""?\n\nLa lista de reproducción actual se perderá al menos que ya haya sido guardada.]"
			
				"\n\n"
				"\![*]\__q[OnMusicPlayer.PlaylistLoaded,,,""%(reference.raw[0])""]Sí, cargar lista de reproducción\__q  \![*]\__q[OnBlank]No, no cargar lista de reproducción\__q"
			}
			elseif language == "Deutsch"
			{
				"[Load the playlist ""\_?%(_filename)\_?""?\n\nThe current playlist will be lost unless it is already saved.]"
			
				"\n\n"
				"\![*]\__q[OnMusicPlayer.PlaylistLoaded,,,""%(reference.raw[0])""]Yes, load the playlist\__q  \![*]\__q[OnBlank]No, do not load the playlist\__q"
			}
			elseif language == "Русский"
			{
				"[Загрузить ""\_?%(_filename)\_?""?\n\nТекущий плэйлист, если не сохранен, будет потерянный.]"
			
				"\n\n"
				"\![*]\__q[OnMusicPlayer.PlaylistLoaded,,,""%(reference.raw[0])""]Да, загрузай плэйлист\__q  \![*]\__q[OnBlank]Не, не загрузай плэйлист\__q"
			}
			elseif language == "Français" 
			{
				"[Load the playlist ""\_?%(_filename)\_?""?\n\nThe current playlist will be lost unless it is already saved.]"
			
				"\n\n"
				"\![*]\__q[OnMusicPlayer.PlaylistLoaded,,,""%(reference.raw[0])""]Yes, load the playlist\__q  \![*]\__q[OnBlank]No, do not load the playlist\__q"
			}
			elseif language == "Polski"
			{
				"[Load the playlist ""\_?%(_filename)\_?""?\n\nThe current playlist will be lost unless it is already saved.]"
			
				"\n\n"
				"\![*]\__q[OnMusicPlayer.PlaylistLoaded,,,""%(reference.raw[0])""]Yes, load the playlist\__q  \![*]\__q[OnBlank]No, do not load the playlist\__q"
			}
			else //English
			{
				"[Load the playlist ""\_?%(_filename)\_?""?\n\nThe current playlist will be lost unless it is already saved.]"
			
				"\n\n"
				"\![*]\__q[OnMusicPlayer.PlaylistLoaded,,,""%(reference.raw[0])""]Yes, load the playlist\__q  \![*]\__q[OnBlank]No, do not load the playlist\__q"
			}
		}
		elseif _fileext == "" //If it's a single folder
		{
			_files = FENUM(reference0,C_BYTE1) //Gets all the files in the folder
			_orig = _files

			_musicfiles = MusicPlayer.FindSongs(reference0,_files)
			
			_path = SPLITPATH(reference0)[1]
			SETDELIM(_path,"\")
			_len = ARRAYSIZE(_path) - 2
			_folder = _path[_len] //This stuff gets the folder name
			
			if ARRAYSIZE(_musicfiles) == 0 //If there were no compatible songs inside
			{
				"%(MusicPlayer.Scope)%(MusicPlayer.SmallBalloon)\![no-autopause]\![set,autoscroll,disable]\![quicksection,1]"
				
				if language == "Placeholder" //TRANSLATORS: If the user drags a folder on FLUX, and none of the files inside are compatible music files. Use _folder for the folder name
				{
					
				}
				elseif language == "Español"
				{
					"[Ninguno de los archivos en ""\_?%(_folder)\_?"" son compatibles.]\e"
				}
				elseif language == "Deutsch"
				{
					"[Keine der Dateien in ""\_?%(_folder)\_?"" sind kompatible Musikdateien.]\e"
				}
				elseif language == "Русский"
				{
					"[Ни одна из всех файлов в папке ""\_?%(_folder)\_?"" compatible файлов музыки.]\e"
				}
				elseif language == "Français"
				{
					"[Aucun fichier dans ""\_?%(_folder)\_?"" n'est un fichier de musique compatible.]\e"
				}
				elseif language == "Polski"
				{
					"[Żaden z plików w ""\_?%(_folder)\_?"" jest kompatybilnym plikiem muzycznym.]\e"
				}
				else //English
				{
					"[None of the files in ""\_?%(_folder)\_?"" are compatible music files.]\e"
				}
			}
			else //If there are compatible songs
			{
				_num = ARRAYSIZE(_musicfiles)
				
				"%(MusicPlayer.Scope)%(MusicPlayer.SmallBalloon)\![no-autopause]\![set,autoscroll,disable]\![quicksection,1]"
				
				"\0\b[0]"
				if ISFUNC("OnCustom_ActionSurfaces") && CustomFuncs[0] == 1; "\![embed,OnCustom_ActionSurfaces,Action]"
				else; "\s[6]"
				
				if language == "Placeholder" //TRANSLATORS: If the user drags a folder on FLUX, and at least some of the files inside are compatible music files. Use _num for the number of songs that were added, and _folder for the folder name
				{
					
				}
				elseif language == "Español"
				{
					_n = ""; if _num != 1; _n = "n"
					
					"[Se ha%(_n) añadido %(_num) pista%(_s) desde ""\_?%(_folder)\_?"".]"
					
					"\n\n\![*]\__q[OnMusicPlayer.Menu]Abrir Reproductor de Música\__q\n\![*]\__q[blank]Cerrar\__q\e"
				}
				elseif language == "Deutsch"
				{
					_er = ""; if _num != 1; _er = "er"
					_n = ""; if _num != 1; _n = "n"
					
					"[Es wurde%(_n) %(_num) Lied%(_er) aus ""\_?%(_folder)\_?"" hinzugefügt.]"
					
					"\n\n\![*]\__q[OnMusicPlayer.Menu]Musik-Player öffnen\__q\n\![*]\__q[blank]Schließen\__q"
				}
				elseif language == "Русский"
				{
					_песня = "песня"; if _num != 1; _песня = "песен"
					
					"[Добавил %(_num) %(_песня) из ""\_?%(_folder)\_?"".]"
					
					"\n\n\![*]\__q[OnMusicPlayer.Menu]Открыть плеер\__q\n\![*]\__q[blank]Закрыть\__q"
				}
				elseif language == "Français"
				{
					"[%(_num) musiques ajoutées de ""\_?%(_folder)\_?"".]"
					
					"\n\n\![*]\__q[OnMusicPlayer.Menu]Ouvrir le lecteur de musique\__q\n\![*]\__q[blank]Fermer\__q"
				}
				elseif language == "Polski"
				{
					"[Dodano %(_num) piosenek z ""\_?%(_folder)\_?"".]"
					
					"\n\n\![*]\__q[OnMusicPlayer.Menu]Otwórz player\__q\n\![*]\__q[blank]Zamknij\__q"
				}
				else //English
				{
					_s = ""; if _num != 1; _s = "s"
					
					"[Added %(_num) song%(_s) from ""\_?%(_folder)\_?"".]"
					
					"\n\n\![*]\__q[OnMusicPlayer.Menu]Open music player\__q\n\![*]\__q[blank]Close\__q"
				}
			}
		}
		else //Incompatible
		{
			"%(MusicPlayer.Scope)%(MusicPlayer.SmallBalloon)\![no-autopause]\![set,autoscroll,disable]\![quicksection,1]"
			
			//DIALOGUE: Any file that is not music or a playlist
			"\0\b[0]"
			if ISFUNC("OnCustom_ActionSurfaces") && CustomFuncs[0] == 1; "\![embed,OnCustom_ActionSurfaces,Refuse]"
			else; "\s[6]"
			
			if language == "Placeholder" //TRANSLATORS: If the user drags a file with no known extension onto FLUX
			{
				
			}
			elseif language == "Español"
			{
				"[Este archivo no es compatible con el reproductor FLUX.]\e"
			}
			elseif language == "Deutsch"
			{
				"[Diese Datei ist nicht mit FLUX-Player kompatibel.]\e"
			}
			elseif language == "Русский"
			{
				"[Этот файл не compatible с плеер FLUX.]\e"
			}
			elseif language == "Français"
			{
				"[Ce fichier n'est pas compatible avec le lecteur FLUX.]\e"
			}
			elseif language == "Polski"
			{
				"[Ten plik jest nie kompatybilny z FLUX player.]\e"
			}
			else //English
			{
				"[This file is not compatible with FLUX player.]\e"
			}
		}
	}
	else //More than 1 file
	{
		_musicfiles = MusicPlayer.FindSongs(,_filearray)

		if ARRAYSIZE(_musicfiles) == 0 //If there are no music files
		{
			"%(MusicPlayer.Scope)%(MusicPlayer.SmallBalloon)\![no-autopause]\![set,autoscroll,disable]\![quicksection,1]"
			
			if language == "Placeholder" //TRANSLATORS: If the user dragged and dropped multiple files on FLUX, but none of them were compatible music files
			{
				
			}
			elseif language == "Español"
			{
				"[Ninguno de estos archivos son compatibles con el reproducto FLUX.]\e"
			}
			elseif language == "Deutsch"
			{
				"[Keine dieser Dateien ist mit FLUX-Player kompatibel.]\e"
			}
			elseif language == "Русский"
			{
				"[Ни одна их этих файлов не совместимый с плеер FLUX.]\e"
			}
			elseif language == "Français"
			{
				"[Aucun de ces fichiers n'est compatible avec le lecteur FLUX.]\e"
			}
			elseif language == "Polski"
			{
				"[Żaden z tych plików jest kompatybilny z FLUX player.]\e"
			}
			else //English
			{
				"[None of these files are compatible with FLUX player.]\e"
			}
		}
		else //If there are music files
		{
			_num = ARRAYSIZE(_musicfiles)
			
			"%(MusicPlayer.Scope)%(MusicPlayer.SmallBalloon)\![no-autopause]\![set,autoscroll,disable]\![quicksection,1]"
			
			"\0\b[0]"
			
			if ISFUNC("OnCustom_ActionSurfaces") && CustomFuncs[0] == 1; "\![embed,OnCustom_ActionSurfaces,Action]"
			else; "\s[6]"
			
			if language == "Placeholder" //TRANSLATORS: If the user dragged and dropped multiple files on FLUX, and at least some of them are compatible. Use _num as the count of songs that were added
			{
				
			}
			elseif language == "Español"
			{
				_s = ""; if _num != 1; _s = "s"
				_n = ""; if _num != 1; _n = "n"
				
				"[Se ha%(_n) añadido %(_num) pista%(_s) compatibles a la lista de reproducción.]"
				
				"\n\n\![*]\__q[OnMusicPlayer.Menu]Abrir Reproductor de Música\__q\n\![*]\__q[blank]Cerrar\__q"
			}
			elseif language == "Deutsch"
			{
				_er = ""; if _num != 1; _er = "er"
				_n = ""; if _num != 1; _n = "n"
				_s = ""; if _num == 1; _s = "s"
				
				"[Es wurde%(_n) %(_num) kompatible%(_s) Lied%(_er) zur Playlist hinzugefügt.]"
				
				"\n\n\![*]\__q[OnMusicPlayer.Menu]Musik-Player öffnen\__q\n\![*]\__q[blank]Schließen\__q"
			}
			elseif language == "Русский"
			{
				"[%(_num) песен добавлен в плейлисте.]"
				
				"\n\n\![*]\__q[OnMusicPlayer.Menu]Открыть плеер\__q\n\![*]\__q[blank]Закрыть\__q"
			}
			elseif language == "Français"
			{
				"[%(_num) musiques compatibles ajoutées à la playlist.]"
				
				"\n\n\![*]\__q[OnMusicPlayer.Menu]Ouvrir le lecteur de musique\__q\n\![*]\__q[blank]Fermer\__q"
			}
			elseif language == "Polski"
			{
				"[%(_num) piosenek dodane do playlisty.]"
				
				"\n\n\![*]\__q[OnMusicPlayer.Menu]Otwórz player\__q\n\![*]\__q[blank]Zamknij\__q"
			}
			else //English
			{
				_s = ""; if _num != 1; _s = "s"
				
				"[%(_num) compatible song%(_s) added to the playlist.]"
				
				"\n\n\![*]\__q[OnMusicPlayer.Menu]Open music player\__q\n\![*]\__q[blank]Close\__q"
			}
		}
	}
}

//CUSTOMIZE: Hotspots. If you already have OnMouseDoubleClick in your ghost, you'll need to make it direct here if an unknown hotspot is clicked. If you do not have OnMouseDoubleClick, just rename this one to OnMouseDoubleClick. If you rename this one, you may want to put in a check to open your main menu if the mouse is not over a hotspot.
MusicPlayer.OnMouseDoubleClick : all
{
	_inmenu = MusicPlayer.CheckWhichMenu
	
	if reference4 == "stop_button" //Stopping the music
	{
		if MusicPlayer.MenuIsOpen; "\C"
		
		"\![raise,OnMusicPlayer.StopSong,""%(_inmenu)""]"
	}
	elseif reference4 == "play_button" //Playing a song. This should always start the next one, probably? If none is playing, it should either start at 0 or a random position... If something is playing, it should skip to the next, I think.
	{
		if MusicPlayer.MenuIsOpen; "\C"
		
		if MusicPlayer.PlayState == 0 //If no song is playing
		{
			"\![raise,OnMusicPlayer.PlaySong,,""%(_inmenu)""]"
		}
		elseif MusicPlayer.PlayState == 2
		{
			"\![raise,OnMusicPlayer.PauseSong,""%(_inmenu)"",resume]"
		}
		else //If a song is already playing, go to the next one
		{
			"\![raise,OnMusicPlayer.NextSong,""%(_inmenu)""]"
		}
	}
	elseif reference4 == "pause_resume_button"
	{
		if MusicPlayer.MenuIsOpen; "\C"
		
		if MusicPlayer.PlayState == 2; "\![raise,OnMusicPlayer.PauseSong,%(_inmenu),resume]"
		else; "\![raise,OnMusicPlayer.PauseSong,%(_inmenu),pause]"
	}
	elseif reference4 == "next_button"
	{
		if MusicPlayer.PlayState != 0
		{
			if MusicPlayer.MenuIsOpen; "\C\![raise,OnMusicPlayer.NextSong,%(_inmenu)]"
			else; "\![raise,OnMusicPlayer.NextSong,%(_inmenu)]"
		}
	}
	elseif reference4 == "previous_button"
	{
		if MusicPlayer.PlayState != 0
		{
			if MusicPlayer.MenuIsOpen; "\C\![raise,OnMusicPlayer.PrevSong,%(_inmenu)]"
			else; "\![raise,OnMusicPlayer.PrevSong,%(_inmenu)]"
		}
	}
	elseif reference4 == "stop_after_current_button"
	{
		if MusicPlayer.StopAfterCurrent != "stop after playback"
		{
			MusicPlayer.StopAfterCurrent = "stop after playback"
		}
		else
		{
			MusicPlayer.StopAfterCurrent = ""
		}
		if _inmenu == "OnMusicPlayer.Settings"; "\C\![raise,OnMusicPlayer.Settings]"
	}
	elseif reference4 == "stop_after_playlist_button"
	{
		if MusicPlayer.StopAfterCurrent != "stop after playlist"
		{
			MusicPlayer.StopAfterCurrent = "stop after playlist"
		}
		else
		{
			MusicPlayer.StopAfterCurrent = ""
		}
		if _inmenu == "OnMusicPlayer.Settings"; "\C\![raise,OnMusicPlayer.Settings]"
	}
	elseif reference4 == "k_window"
	{
		OnMusicPlayer.Menu("manual")
	}
	elseif reference4 == "clear_button" //Clearing the current playlist
	{
		OnMusicPlayer.ClearPlaylist
	}
	elseif reference4 == "song_bar_button" //Song Bar
	{
		OnMusicPlayer.ToggleSongBar("Hotspot",_inmenu)
	}
	elseif reference4 == "volume_up_button" //Volume up
	{
		OnMusicPlayer.QuickVolume("Up")
	}
	elseif reference4 == "volume_down_button" //Volume down
	{
		OnMusicPlayer.QuickVolume("Down")
	}
	elseif reference4 == "speed_up_button" //Speed up
	{
		OnMusicPlayer.QuickSpeed("Up")
	}
	elseif reference4 == "speed_down_button" //Speed down
	{
		OnMusicPlayer.QuickSpeed("Down")
	}
	elseif reference4 == "balance_left_button" //Balance left
	{
		OnMusicPlayer.QuickBalance("Left")
	}
	elseif reference4 == "balance_right_button" //Balance right
	{
		OnMusicPlayer.QuickBalance("Right")
	}
	elseif reference4 == "minimize"
	{
		"\![set,windowstate,minimize]"
	}
	elseif reference4 == "end_sect"
	{
		"\![raise,OnClose]"
	}
	elseif ISFUNC("OnCustom_MouseDoubleClickSakura") && CustomFuncs[0] == 1; OnCustom_MouseDoubleClickSakura
}

//When a song ends on its own
OnSoundStop : all
{
	MusicPlayer.PlayingRemovedSong = 0
	
	//Currently changing shells
	if CurrentlyChangingShells == 1
	{
		CurrentlyChangingShells = 2
		return
	}
	
	_inmenu = MusicPlayer.CheckWhichMenu
	MusicPlayer.PlayState = 0 //Clear paused song if there somehow was one
	if MusicPlayer.BalloonIsOpen && MusicPlayer.Priority != 1 || _inmenu != ""; "\C\_l[0,0]"
	
	if MusicPlayer.PlayMode == 3 || reference1 == "close" || (MusicPlayer.PlayMode == 2 && MusicPlayer.CurrentSongIndex == -1) //If it's set to play one song and then stop, or the user clicked the X on the playback window, or the user removed the playing song from the playlist and it's set to just loop one song
	{
		"\![raise,OnMusicPlayer.StopSong,""%(_inmenu)""]"
	}
	else //If another song needs to play
	{
		_next = 0
		_lastsong = 0
		
		if MusicPlayer.PlayMode == 2 //Loop one song
		{
			_next = MusicPlayer.CurrentSongIndex
		}
		elseif MusicPlayer.PlayMode == 4 //Random
		{
			_next = RAND(ARRAYSIZE(MusicPlayer.CurrentPlaylist))
		}
		elseif MusicPlayer.PlayMode == 1 //Shuffle and loop
		{
			if MusicPlayer.ShuffledIndex >= (ARRAYSIZE(MusicPlayer.CurrentPlaylist) - 1) //If this was the last song on the list
			{
				MusicPlayer.ShuffledIndex = 0
				_lastsong = 1
			}
			else //If there are more songs to go
			{
				MusicPlayer.ShuffledIndex++
			}
			_next = MusicPlayer.ShuffledPlaylist[MusicPlayer.ShuffledIndex]
		}
		else //Loop playlist or shuffle
		{
			if MusicPlayer.CurrentSongIndex >= (ARRAYSIZE(MusicPlayer.CurrentPlaylist) - 1) //If it was the last song on the list
			{
				_next = 0
				_lastsong = 1
			}
			else
			{
				_next = MusicPlayer.CurrentSongIndex + 1
			}
		}
		
		MusicPlayer.CurrentSongIndex = _next //Song index
		
		//If it's set to stop after the current song, make sure it stops. Down here so the index number still advances if you're not set to loop a single song
		if MusicPlayer.StopAfterCurrent == "stop after playback" || (MusicPlayer.StopAfterCurrent == "stop after playlist" && _lastsong)
		{
			if MusicPlayer.IsMinimized
			{
				OnMusicPlayer.StopSong
			}
			else
			{
				"\![raise,OnMusicPlayer.StopSong,""%(_inmenu)""]"
			}
		}
		else
		{
			if MusicPlayer.IsMinimized
			{
				OnMusicPlayer.PlaySong(_next)
			}
			else
			{
				"%(MusicPlayer.SingingSurfaces)\![raise,OnMusicPlayer.PlaySong,%(MusicPlayer.CurrentSongIndex),""%(_inmenu)""]"
			}
		}
	}
}

//If a song fails to play for some reason
OnSoundError : all
{
	MusicPlayer.PlayingRemovedSong = 0
	
	_playnext = 0
	if !(MusicPlayer.PlayMode == 2 || MusicPlayer.PlayMode == 3 || MusicPlayer.StopAfterCurrent == "stop after playback" || (MusicPlayer.StopAfterCurrent == "stop after playlist" && MusicPlayer.CurrentSongIndex >= (ARRAYSIZE(MusicPlayer.CurrentPlaylist) - 1)) || ARRAYSIZE(MusicPlayer.CurrentPlaylist) <= 1); _playnext = 1 //If it IS able to play another song
	
	if _playnext == 0
	{
		MusicPlayer.PlayState = 0 //Clearing paused song
	}
	if MusicPlayer.IsMinimized && !_playnext; MusicPlayer.MakeValueNotify("%(OnMusicPlayer.NotifySongInfo)")
	else; "%(OnMusicPlayer.NotifySongInfo)"
	
	"%(MusicPlayer.Scope)\![unlock,balloonrepaint]\c%(MusicPlayer.SmallBalloon)\![no-autopause]\![quicksection,1]"
	
	if language == "Placeholder" //TRANSLATORS: If a song gives an error, this is the message that will display. I don't know what all the possible error messages can be, and it says it's determined by the sound playback engine, so I'm not going to ask for those to be translated. reference2 here is the file that gave the error, and reference3 is the error message
	{
		
	}
	elseif language == "Español"
	{
		"[No se puede reproducir el archivo ""\f[color,default.anchor]\_?%(reference2)\_?\f[color,default]""]"
		"\n\n"
		"""%(reference3)"""
		
		//If it's able to play another song
		if _playnext; "\n\n\![][Comenzando siguiente pista...]"
	}
	elseif language == "Deutsch"
	{
		"[Die Datei ""\f[color,default.anchor]\_?%(reference2)\_?\f[color,default]"" konnte nicht abgespielt werden.]"
		"\n\n"
		"""%(reference3)""]"
		
		//If it's able to play another song
		if _playnext; "\n\n\![][Nächstes Lied wird gestartet...]"
	}
	elseif language == "Русский"
	{
		"[Не могу играть файл ""\f[color,default.anchor]\_?%(reference2)\_?\f[color,default]""]"
		"\n\n"
		"""%(reference3)"""
		
		//If it's able to play another song
		if _playnext; "\n\n\![][Начинает следущую песню...]"
	}
	//TODO FRENCH
	elseif language == "Polski"
	{
		"[Nie można odtworzyć pliku ""\f[color,default.anchor]\_?%(reference2)\_?\f[color,default]""]"
		"\n\n"
		"""%(reference3)"""
		
		//If it's able to play another song
		if _playnext; "\n\n\![][Rozpoczynanie następnego utworu...]"
	}
	else //English
	{
		"[Cannot play file ""\f[color,default.anchor]\_?%(reference2)\_?\f[color,default]""]"
		"\n\n"
		"""%(reference3)"""
		
		//If it's able to play another song
		if _playnext; "\n\n\![][Starting next song...]"
	}
	
	//If it's able to play another song
	if _playnext; "\_w[5000]\![raise,OnSoundStop]"
}

//When the balloon is changed. This gets the number of lines in the current balloon, so that in certain menus it doesn't jump around so much.
OnBalloonChange : all
{
	nowballoon[0] = reference0
	if MusicPlayer.BalloonIsOpen; "\C"
	
	"%(MusicPlayer.LargeBalloon)\![get,property,OnMusicPlayer.BalloonLines,currentghost.balloon.scope(0).lines.initial]"
}

//Not a built in event, but related to the above
OnMusicPlayer.BalloonLines
{
	MusicPlayer.BalloonLines = TOINT(reference0)
}

//When the user closes an inputbox. Not strictly necessary, can be removed if you don't want it. Just makes things a little more polished.
OnUserInputCancel
{
	if reference0 == "OnMusicPlayer.Speed" || reference0 == "OnMusicPlayer.Volume" || reference0 == "OnMusicPlayer.Balance" || reference0 == "OnPlaylistName"; "\C\![raise,OnMusicPlayer.Settings]"
	elseif reference0 == "OnMusicPlayer.JumpIndex"; "\C\![raise,OnMusicPlayer.Menu]"
}

//When the user closes a system dialog for saving/loading playlists. Not strictly necessary, same as the above but for playlist saving/loading with file explorer.
OnSystemDialogCancel
{
	if reference1 == "OnMusicPlayer.PlaylistSaved" || reference1 == "OnMusicPlayer.PlaylistLoaded"; "\C\![raise,OnMusicPlayer.Settings]"
}

tooltips_list : array
{
	//TODO TRANSLATION the list here got some new stuff added
	if language == "Placeholder" //TRANSLATORS: A list of the labels needed for hotspot tool tips
	{
		
	}
	elseif language == "Español"
	{
		"Reproducir / Siguiente"
		"Reproducir"
		"Pausar"
		"Continuar"
		"Parar"
		"Siguiente"
		"Anterior"
		"Menú"
		"Controles de Música"
		"Limpiar Lista de Reproducción"
		"Parar después de esta canción"
		"Detener después de acabar la lista de reproducción"
		"Activar/Desactivar Barra de Reproducción"
		"Subir volumen"
		"Bajar volumen"
		"Acelerar"
		"Ralentizar"
		"Balance a la izda."
		"Balance a la dcha."
		"Minimizar"
		"Cerrar FLUX"
	}
	elseif language == "Deutsch" //TODO new translation in these tooltips
	{
		"Start / Nächstes Lied"
		"Start"
		"Pause"
		"Fortsetzen"
		"Stop"
		"Nächstes Lied"
		"Vorheriges Lied"
		"Menü"
		"Musik-Bedienung"
		"Playlist leeren"
		"Nach derzeitigem Lied stoppen"
		"Stop after playlist ends"
		"Toggle song bar"
		"Volume up"
		"Volume down"
		"Speed up"
		"Speed down"
		"Balance left"
		"Balance right"
		"Minimieren"
		"FLUX schließen"
	}
	elseif language == "Русский"
	{
		"Играй / Следующий"
		"Играть"
		"Пауза"
		"Продолжить"
		"Остановить"
		"Следующий"
		"Предыдущий"
		"Меню"
		"Управления Музыка"
		"Отчистить Плейлист"
		"Стоп после текущая песня"
		"Стоп после конец плэйлиста"
		"Переключай строка песни"
		"Громкость верх"
		"Громкость вниз"
		"Скорость верх"
		"Скорость вниз"
		"Баланс налево"
		"Баланс направо"
		"Свернуть"
		"Закрыть FLUX"
	}
	//TODO French
	elseif language == "Polski"
	{
		"Play / Next"
		"Odtwórz"
		"Wstrzymaj"
		"Wznów"
		"Zatrzymaj"
		"Następny"
		"Poprzedni"
		"Menu"
		"Sterowanie muzyką"
		"Wyczyść listę odtwarzania"
		"Zatrzymaj po zakończeniu utworu"
		"Stop after playlist ends"
		"Toggle song bar"
		"Volume up"
		"Volume down"
		"Speed up"
		"Speed down"
		"Balance left"
		"Balance right"
		"Minimalizuj"
		"Zamknij FLUX"
	}
	else //English
	{
		"Play / Next"
		"Play"
		"Pause"
		"Resume"
		"Stop"
		"Next"
		"Previous"
		"Menu"
		"Music controls"
		"Clear playlist"
		"Stop after current song"
		"Stop after playlist ends"
		"Toggle song bar"
		"Volume up"
		"Volume down"
		"Speed up"
		"Speed down"
		"Balance left"
		"Balance right"
		"Minimize"
		"Close FLUX"
	}
}

//reference4 is the name of the collision identifier as written in surfaces.txt
On_tooltip
{
	//CUSTOMIZE: Setting up tooltips for hotspots
	//You can adjust the tooltips here if you need, or if you used different collision names you'll need to replace the defaults here.
	//Note: if you assign tooltips on the shell side, they will take precedence. But I recommend doing it here so that users can toggle them off if they prefer!
	
	if MusicPlayer.Tooltips == 1
	{
		_tooltips = tooltips_list
		
		if reference4 == "play_button"
		{
			if MusicPlayer.Singing; _tooltips[0]
			else; _tooltips[1]
		}
		elseif reference4 == "pause_resume_button"
		{
			if MusicPlayer.PlayState == 1; _tooltips[2]
			else; _tooltips[3]
		}
		elseif reference4 == "stop_button1" || reference4 == "stop_button2"; _tooltips[4]
		elseif reference4 == "next_button"; _tooltips[5]
		elseif reference4 == "previous_button"; _tooltips[6]
		elseif reference4 == "menu"; _tooltips[7]
		elseif reference4 == "k_window"; _tooltips[8]
		elseif reference4 == "clear_button"; _tooltips[9]
		elseif reference4 == "stop_after_current_button"; _tooltips[10]
		elseif reference4 == "stop_after_playlist_button"; _tooltips[11]
		elseif reference4 == "song_bar_button"; _tooltips[12]
		elseif reference4 == "volume_up_button"; _tooltips[13]
		elseif reference4 == "volume_down_button"; _tooltips[14]
		elseif reference4 == "speed_up_button"; _tooltips[15]
		elseif reference4 == "speed_down_button"; _tooltips[16]
		elseif reference4 == "balance_left_button"; _tooltips[17]
		elseif reference4 == "balance_right_button"; _tooltips[18]
		elseif reference4 == "minimize"; _tooltips[19]
		elseif reference4 == "end_sect"; _tooltips[20]
	}
}

OnTranslateInternal.MusicPlayer
{
	_id = SHIORI3FW.Eventid
	_end = SPLIT(_id,".")
	_end = _end[ARRAYSIZE(_end) - 1]
	
	_filter = ("visible","caption","recommendsites","portalsites")
	
	if !(_id == "On_tooltip" || SUBSTR(_id,0,3) == "On_" && ASEARCH(_end,_filter) != -1)
	{
		MusicPlayer.LastTalk = _argv[0]
	}
}

//CUSTOMIZE: If you don't have OnInitialize, rename this to OnInitialize. If you do have it, make sure to call this function in that event. This just means that when the ghost opens, it'll ensure it doesn't think it's already playing music.
MusicPlayer.OnInitialize
{
	if reference0 != "reload" //If NOT reloading
	{
		MusicPlayer.PlayState = 0
	}
}

//CUSTOMIZE: If you don't have OnDestroy, rename this to OnDestroy. If you do have it, make sure to call this function in that event. This just means that when the ghost closes, it'll stop playing music.
MusicPlayer.OnDestroy
{
	if reference0 != "reload" //If NOT reloading
	{
		MusicPlayer.PlayState = 0
	}
}




//—————————— TOOLS ——————————
//These are (mostly) pure functions that aid in various places in the code.

//Checks if the balloon is currently open. 1 if yes, 0 if no.
MusicPlayer.BalloonIsOpen
{
	"balloon" _in_ status
}

//Checks if the balloon is open and there are menu choices. 1 if yes, 0 if no.
MusicPlayer.MenuIsOpen
{
	"choosing" _in_ status
}

//Checks if the ghost is currently minimized. 1 if yes, 0 if no.
MusicPlayer.IsMinimized
{
    "minimizing" _in_ status
}

//Returns 1 if singing, 0 if not
MusicPlayer.Singing
{
	MusicPlayer.PlayState == 1
}

Singing
{
	MusicPlayer.Singing
}

//Helps with alignment commands
MusicPlayer.newline
{
	"\_l[]"
}

MusicPlayer.CurrentSongName
{
	SPLITPATH(MusicPlayer.CurrentSongPath)[2] //Picks out just the name of the file, no extension
}

MusicPlayer.CurrentSongPath
{
	if MusicPlayer.PlayingRemovedSong; MusicPlayer.LastRemovedSong
	else; MusicPlayer.CurrentPlaylist[MusicPlayer.CurrentSongIndex]
}

MusicPlayer.MaxPages
{
	_max_page = (ARRAYSIZE(MusicPlayer.CurrentPlaylist) / MusicPlayer.SongsPerPage) - 1
	if ARRAYSIZE(MusicPlayer.CurrentPlaylist) % MusicPlayer.SongsPerPage != 0; _max_page++
	
	if ARRAYSIZE(MusicPlayer.CurrentPlaylist) == 0; 0
	else; _max_page
}

//Added with help from steve02081504. Send an argument to this function to send it with ValueNotify. This can be used even while the ghost is minimized to run tags like the sound command.
MusicPlayer.MakeValueNotify : void
{
	SHIORI3FW.PushAdditionalReturn('ValueNotify',_argv)
}

//A list of compatible music file types.
MusicPlayer.CompatibleMusicFileTypes : array
{
	/*
		//In an order that makes sense to me
		//Available without LAV Filters
		".mid"; ".mp3"; ".wav"; ".wma" 
		
		//With LAV Filters. I have tested this whole block myself and they work.
		".8svx"; ".ac3"; ".aiff"; ".amb"; ".au"; ".avr"; ".caf"; ".dts"; ".fap"; ".flac"; ".hcom"
		".ircam"; ".m4a"; ".m4r"; ".maud"; ".mp2"; ".nist"; ".oga"; ".ogg"; ".opus"; ".paf"
		".pfv"; ".ra"; ".sln"; ".snd"; ".sph"; ".spx"; ".tta"; ".voc"; ".w64"; ".wv"; ".wve"
		
		//With LAV Filters. I have not tested these, but they should work. Also includes video files!
		".ape"; ".avo"; ".wmv"; ".rm"; ".rmvb"; ".mp4"; ".mkv"; ".flv"; ".mpg"
	*/
	
	//Alphabetical so I don't get complaints lol
	
	".8svx"; ".ac3"; ".aiff"; ".amb"; ".ape"; ".au"; ".avo"; ".avr"; ".caf"; ".dts"; ".fap"; ".flac"; ".flv"; ".hcom"
	".ircam"; ".m4a"; ".m4r"; ".maud"; ".mid"; ".mkv"; ".mp2"; ".mp3"; ".mp4"; ".mpg"; ".nist"; ".oga"; ".ogg"; ".opus"; ".paf"
	".pfv"; ".ra"; ".rm"; ".rmvb"; ".sln"; ".snd"; ".sph"; ".spx"; ".tta"; ".voc"; ".w64"; ".wav"; ".wma"; ".wmv"; ".wv"; ".wve"
}

MusicPlayer.DisplayPlaytime : all
{
	_num = TOINT(_argv[0])
	
	_units = ( /
	"yr,31536000",/
	"d,86400",/
	":,3600",/
	":,60",/
	",1"/
	)
	
	_output = ""
	foreach _units; _unit
	{
		_duration = TOINT(_unit[1])
		_amt = _num / _duration
		_num = _num % _duration
		
		if _amt > 0 || _unit[0] == "" || _unit[0] == ":"
		{
			//The second function call here handles whether the unit name should be displayed as plural or not, depending on if the amount of that unit is greater than 1
			if _unit[0] == "" || _unit[0] == ":"
			{
				if _amt < 10; _amt = "0" + TOSTR(_amt)
			}
			_output += "%(_amt)%(_unit[0])"
			if !(_unit[0] == "" || _unit[0] == ":")
			{
				_output += " "
			}
		}
	}
	_output
}

MusicPlayer.ChangingHotkeys
{
	"changing hotkey: " _in_ SPLIT(MusicPlayer.LastTalk,"\e")[1]
}

MusicPlayer.SetDefaultSettings
{
	MusicPlayer.CurrentSongIndex = -1
	MusicPlayer.PlayState = 0
	MusicPlayer.LastRemovedSong = ""
	
	MusicPlayer.Volume = 100
	MusicPlayer.Speed = 100
	MusicPlayer.Balance = 0
	MusicPlayer.PlayMode = 0 //Play mode - 0 for loop playlist, 1 for shuffle playlist, 2 for loop song, 3 for play one song, 4 for random
	MusicPlayer.StopAfterCurrent = ""
	MusicPlayer.SongBar = 0
	
	MusicPlayer.CurrentPlaylist = IARRAY
	MusicPlayer.ShuffledPlaylist = IARRAY
	MusicPlayer.ShuffledIndex = 0
	
	MusicPlayer.Hotkeys = IARRAY
	MusicPlayer.BalloonLines = MusicPlayer.DefaultBalloonLines
	MusicPlayer.Playtime = 0 //Only needed if you implement the Playtime counter below
	
	MusicPlayer.DiscordDisplay = 1 //These two are only needed if you implement the Discord functions
	MusicPlayer.DiscordDisplayFlag = 0
	
	MusicPlayer.Tooltips = 1
	MusicPlayer.AnnounceSongs = "Off"
	MusicPlayer.Priority = 0
	MusicPlayer.Scroll = 0
	MusicPlayer.PreviousButton = 0 //Behavior of the previous button
	MusicPlayer.Pagination = 1 //Playlist display option
	
	MusicPlayer.PageIndex = 0
	MusicPlayer.PlaylistPath = MusicPlayer.DefaultPlaylistPath //Default playlist folder, change if desired
	
	MusicPlayer.PlayingRemovedSong = 0
	
	void MKDIR(MusicPlayer.PlaylistPath)
}

//Set default values if these get deleted or are not set
MusicPlayer.ResetDefaultSettings
{
	if !ISVAR("MusicPlayer.CurrentSongIndex"); MusicPlayer.CurrentSongIndex = -1
	if !ISVAR("MusicPlayer.PlayState"); MusicPlayer.PlayState = 0
	if !ISVAR("MusicPlayer.LastRemovedSong"); MusicPlayer.LastRemovedSong = ""
	
	if !ISVAR("MusicPlayer.Volume"); MusicPlayer.Volume = 100
	if !ISVAR("MusicPlayer.Speed"); MusicPlayer.Speed = 100
	if !ISVAR("MusicPlayer.Balance"); MusicPlayer.Balance = 0
	if !ISVAR("MusicPlayer.PlayMode"); MusicPlayer.PlayMode = 0 //Play mode - 0 for loop playlist, 1 for shuffle playlist, 2 for loop song, 3 for play one song, 4 for random
	if !ISVAR("MusicPlayer.StopAfterCurrent"); MusicPlayer.StopAfterCurrent = ""
	if !ISVAR("MusicPlayer.SongBar"); MusicPlayer.SongBar = 0
	
	if !ISVAR("MusicPlayer.CurrentPlaylist"); MusicPlayer.CurrentPlaylist = IARRAY
	if !ISVAR("MusicPlayer.ShuffledPlaylist"); MusicPlayer.ShuffledPlaylist = IARRAY
	if !ISVAR("MusicPlayer.ShuffledIndex"); MusicPlayer.ShuffledIndex = 0
	
	if !ISVAR("MusicPlayer.Hotkeys"); MusicPlayer.Hotkeys = IARRAY
	if !ISVAR("MusicPlayer.BalloonLines"); MusicPlayer.BalloonLines = MusicPlayer.DefaultBalloonLines
	if !ISVAR("MusicPlayer.Playtime"); MusicPlayer.Playtime = 0
	
	if !ISVAR("MusicPlayer.DiscordDisplay"); MusicPlayer.DiscordDisplay = 1
	
	if !ISVAR("MusicPlayer.Tooltips"); MusicPlayer.Tooltips = 1
	if !ISVAR("MusicPlayer.SongAnnouncement"); MusicPlayer.SongAnnouncement = 0
	if !ISVAR("MusicPlayer.Priority"); MusicPlayer.Priority = 0 //Whether it interrupts dialogue or not when going to the next song
	if !ISVAR("MusicPlayer.Scroll"); MusicPlayer.Scroll = 0
	if !ISVAR("MusicPlayer.PreviousButton"); MusicPlayer.PreviousButton = 0 //Behavior of the previous button
	if !ISVAR("MusicPlayer.Pagination"); MusicPlayer.Pagination = 1 //Playlist display option
	
	if !ISVAR("MusicPlayer.PageIndex"); MusicPlayer.PageIndex = 0
	if !ISVAR("MusicPlayer.PlaylistPath"); MusicPlayer.PlaylistPath = MusicPlayer.DefaultPlaylistPath //Default playlist folder
	
	if !ISVAR("MusicPlayer.PlayingRemovedSong"); MusicPlayer.PlayingRemovedSong = 0
	
	void MKDIR(MusicPlayer.PlaylistPath)
}

//CUSTOMIZE: If you had published a ghost with an older version of this music player and you want to convert variables upon network updating, make sure to add this function to your OnUpdateComplete. To convert your own variables, just run it through script input *before you open the music menu*.
//Only needed if you had an old version of the music player and need to convert to the new variables. If you don't need it, just remove it!
MusicPlayer.ConvertOldVariables
{
	if !ISVAR("MusicPlayer.CurrentSongIndex")
	{
		MusicPlayer.CurrentSongIndex = NowPlaying[1]
	}
	
	if !ISVAR("MusicPlayer.PlayState")
	{
		if NowPlaying[0] != ""; MusicPlayer.PlayState = 0
		else
		{
			if NowPlaying[2] != ""; MusicPlayer.PlayState = 2
			else; MusicPlayer.PlayState = 1
		}
	}
	if !ISVAR("MusicPlayer.LastRemovedSong"); MusicPlayer.LastRemovedSong = ""
	void ERASEVAR("NowPlaying")
	
	if !ISVAR("MusicPlayer.Volume")
	{
		MusicPlayer.Volume = MusicSettings[0]
	}
	
	if !ISVAR("MusicPlayer.Speed")
	{
		MusicPlayer.Speed = MusicSettings[1]
	}
	
	if !ISVAR("MusicPlayer.Balance")
	{
		MusicPlayer.Balance = MusicSettings[2]
	}
	
	if !ISVAR("MusicPlayer.PlayMode") //Play mode - 0 for loop playlist, 1 for shuffle playlist, 2 for loop song, 3 for play one song, 4 for random
	{
		MusicPlayer.PlayMode = MusicSettings[3]
	}
	
	if !ISVAR("MusicPlayer.StopAfterCurrent")
	{
		MusicPlayer.StopAfterCurrent = MusicSettings[4] == ""
	}
	
	void ERASEVAR("MusicSettings")
	
	if !ISVAR("MusicPlayer.SongBar") //??? for some reason this was set to go to MusicSettings[5] before, but uh... that was for shell change related stuff... I'm confused. it might be because FLUX had an older version of the music player?
	{
		MusicPlayer.SongBar = 0
	}
	
	if !ISVAR("MusicPlayer.CurrentPlaylist")
	{
		MusicPlayer.CurrentPlaylist = CurrentPlaylist
		void ERASEVAR("CurrentPlaylist")
	}
	
	if !ISVAR("MusicPlayer.ShuffledPlaylist")
	{
		MusicPlayer.ShuffledPlaylist = ShuffledPlaylist
		MusicPlayer.ShuffledIndex = 0
		void ERASEVAR("ShuffledPlaylist")
	}
	
	if !ISVAR("MusicPlayer.Hotkeys")
	{
		MusicPlayer.Hotkeys = IARRAY
		MusicPlayer.Hotkeys[0] = Hotkeys[1]
		MusicPlayer.Hotkeys[1] = Hotkeys[2]
		MusicPlayer.Hotkeys[2] = Hotkeys[3]
		MusicPlayer.Hotkeys[3] = Hotkeys[4]
		MusicPlayer.Hotkeys[4] = Hotkeys[5]
		void ERASEVAR("Hotkeys")
	}
	
	if !ISVAR("MusicPlayer.BalloonLines")
	{
		MusicPlayer.BalloonLines = BalloonLines
		void ERASEVAR("BalloonLines")
	}
	
	if !ISVAR("MusicPlayer.Playtime")
	{
		_time = playtime[2]
		_time += playtime[1] * 60
		_time += playtime[0] * 3600
		
		MusicPlayer.Playtime = _time
		ERASEVAR("playtime")
	}
	
	if !ISVAR("MusicPlayer.DiscordDisplay")
	{
		if DiscordDisplay[0]; MusicPlayer.DiscordDisplay = 1
		else; MusicPlayer.DiscordDisplay = 0
	}
	
	if !ISVAR("MusicPlayer.Tooltips")
	{
		_onoff = 0
		if TooltipDisplay == 1; _onoff = 1
		MusicPlayer.Tooltips = _onoff
	}
	void ERASEVAR("DiscordDisplay")
	
	

	MusicPlayer.ResetDefaultSettings
}

//——— ArrayScootEx ———
//Array scoot EX. Scoots a value forwards or backwards in an array by 1. You'll need to plan ahead with your menus and set them up to send the element number rather than the name of the item you want to scoot.
//Argument 0: Number of the element that you want to scoot
//Argument 1: - if you want to scoot it backwards, + if you want to scoot it forwards
//Argument 2: The array you want to scoot in

//MusicPlayer.ShuffledPlaylist = MusicPlayer.ArrayScootEx(5,"+",MusicPlayer.ShuffledPlaylist)

MusicPlayer.ArrayScootEx
{
	_array = _argv //Take in all the arguments as an array
	_array[1] = IARRAY //Erase the other arguments because we don't want them in the array
	_array[0] = IARRAY
	_index = TOINT(_argv[0])
	if _index > (ARRAYSIZE(_array) - 1) || _index < 0 //Not sure why this is here... perhaps investigate later
	{
		_array
		return
	}
	if _argv[1] == "-" //Backwards
	{
		if _argv[0] == 0 //If it's already at the start of the array
		{
			_array
			return
		}
		_curnum = _index //Get positions
		_prvnum = _curnum - 1
		
		_current = _array[_curnum] //Assign elements to temp vars
		_prev = _array[_prvnum]
		
		_array[_curnum] = _prev //Replace elements with swapped elements
		_array[_prvnum] = _current
	}
	else //Forwards
	{
		if _argv[0] == (ARRAYSIZE(_array) - 1) //If it's already at the end of the array
		{
			_array
			return
		}
		_curnum = _index //Get positions
		_nxtnum = _curnum + 1
		
		_current = _array[_curnum] //Assign elements to temp vars
		_next = _array[_nxtnum]
		
		_array[_curnum] = _next //Replace elements with swapped elements
		_array[_nxtnum] = _current
	}
	_array
}

//Shuffles the array but keeps the first element the same
MusicPlayer.ShufflePlaylist
{
	_start = IARRAY
	for _i = 0; _i < _argc - 1; _i++
	{
		if _i == _argv[0]; continue
		else; _start ,= _i
	}
	
	_len = ARRAYSIZE(_start)
	_output = IARRAY
	if _argv[0] != "|removed|"; _output ,= TOINT(_argv[0])
	for _i = 0; _i < _len; _i++
	{
		_l = ARRAYSIZE(_start)
		_rand = RAND(_l)
		_output ,= _start[_rand]
		_start[_rand] = IARRAY
	}
	_output
}

//Checks for music files in folders and multiple files
MusicPlayer.FindSongs
{
	//This portion normalizes the input to a general purpose array
	_added = IARRAY
	_input = IARRAY
	_recursive = IARRAY
	if _argv[0] != ""
	{
		if _argv[1] == ""; {_added = ""; return}
		else; _input = SPLIT(_argv[1],C_BYTE1) //If it came from FENUM
	}
	else //If it came from multiple files
	{
		for _i = 1; _i < _argc; _i++ //Probably a bug to not be argc - 1... but it seems to be working????
		{
			if _argv[_i] != ""; _input ,= _argv[_i]
		}
	}
	
	foreach _input; _file
	{
		_path = SPLITPATH(_file)
		_ext = TOLOWER(_path[3])
		if ASEARCH(_ext,MusicPlayer.CompatibleMusicFileTypes) != -1
		{
			MusicPlayer.CurrentPlaylist ,= "%(_argv[0])%(_file)"
			_added ,= _file
		}
		elseif _ext == ""
		{
			_recursive = MusicPlayer.FindSongs("%(_argv[0])%(_file)\",FENUM("%(_argv[0])%(_file)",C_BYTE1))
			if _recursive != ""; _added ,= _recursive
		}
	}
	if ARRAYSIZE(_added) > 0
	{
		MusicPlayer.ShuffledPlaylist = MusicPlayer.ShufflePlaylist(MusicPlayer.CurrentPlaylist[MusicPlayer.CurrentIndex],MusicPlayer.CurrentPlaylist)
		MusicPlayer.ShuffledIndex = 0
	}
	
	_added
}

//Checks for special text to determine which menu the ghost is currently in, and returns 
MusicPlayer.CheckWhichMenu
{
	_inmenu = ""
	if MusicPlayer.BalloonIsOpen
	{
		if "__MUSIC_PLAYER_MAIN_MENU__" _in_ MusicPlayer.LastTalk; _inmenu = "OnMusicPlayer.Menu"
		elseif "__GHOST_MAIN_MENU__" _in_ MusicPlayer.LastTalk; _inmenu = "OnMenuRun"
		elseif "__MUSIC_SETTINGS_MENU__" _in_ MusicPlayer.LastTalk; _inmenu = "OnMusicPlayer.Settings"
		elseif "changing hotkey: " _in_ MusicPlayer.LastTalk; _inmenu = "OnMusicPlayer.ChangeHotkey,%(SPLIT(MusicPlayer.LastTalk,'changing hotkey: ')[1])"
	}
	_inmenu
}



//—————————— DISCORD ——————————

//CUSTOMIZE: Discord plugin functions
//All of the stuff in here is for handling the Discord plugin. You can completely ignore this if you're not interested. If you ARE interested, the setup is a bit involved, and I can't really include all of the code here.
//I recommend reading this guide on how to set up everything you need for the Discord plugin: https://gist.github.com/steve02081504/a3cccec1d7e70bceebcc70ac99e3558a
//I would also recommend looking at how FLUX handles the plugin. Some of the code is below, but there are other bits that are important.
//Of note is that MusicPlayer.DiscordDisplay is an On/Off toggle for the user to be able to choose if they want the ghost to send info to discord at all
//MusicPlayer.DiscordDisplayFlag handles when the plugin turns on and off, since when you first select the ghost it won't immediately set your custom details.
//I am glad to try and help with this if you want to set it up and you're not quite sure what you're doing. The guide linked above is very helpful though, it's how I figured this all out.
//Note that if you use this, there's also a bit in OnMusicPlayer.NotifySongInfo that you'll also want to uncomment.

OnDiscordPluginCustom
{
	MusicPlayer.DiscordDisplayFlag = 2
}

OnDiscordPluginCustomEnd
{
	MusicPlayer.DiscordDisplayFlag = 0
}

OnMusicPlayer.DiscordPluginBoot : all
{
	_song = " "
	if MusicPlayer.Singing; _song = "♫ %(MusicPlayer.CurrentSongName) ♫"
	
	"\![raiseplugin,Discord Rich Presence,OnDiscordPluginCustomALL,903843216200179753,,,thumbnail,https://ukagaka.zichqec.com/ghost/flux,]"
	
	if MusicPlayer.DiscordDisplay == 1
	{
		"\![raiseplugin,Discord Rich Presence,OnDiscordPluginCustomDetail,""Shell: %(nowshell)""]" //TODO do i want this translated?
		
		"\![raiseplugin,Discord Rich Presence,OnDiscordPluginCustomState,""%(_song)""]"
	}
	
	if SHIORI3FW.DebugMode //To turn this on, tick "Enable SHIORI Debug Mode" in the dev palette
	{
		"\![raiseplugin,Discord Rich Presence,OnDiscordPluginCustomSmallImageKey,dev]"
		
		"\![raiseplugin,Discord Rich Presence,OnDiscordPluginCustomSmallImageText,Shell dev]"
	}
}

//Toggle for the settings menu. Make sure you uncomment the option that calls this.
OnMusicPlayer.ToggleDiscordPlugin : all
{
	"\C"
	if MusicPlayer.DiscordDisplay != 1
	{
		_song = " "
		if MusicPlayer.Singing; _song = "♫ %(MusicPlayer.CurrentSongName) ♫"

		MusicPlayer.DiscordDisplay = 1
		"\![raiseplugin,Discord Rich Presence,OnDiscordPluginCustomDetail,""Shell: %(nowshell)""]"
		
		"\![raiseplugin,Discord Rich Presence,OnDiscordPluginCustomState,""%(_song)""]"
	}
	else
	{
		MusicPlayer.DiscordDisplay = 0
		"\![raiseplugin,Discord Rich Presence,OnDiscordPluginCustomDetail, ]"
		
		"\![raiseplugin,Discord Rich Presence,OnDiscordPluginCustomState, ]"
	}
	
	OnMusicPlayer.Settings
}

OnDiscordPluginInfo : all
{
	_h = "\f[color,default.anchor]" //highlight
	_d = "\f[color,default]" //default
	
	"\0\b[2]\![quicksection,1]\*"
	
	if language == "Placeholder" //TRANSLATORS: Information about where to get the discord plugin and how to use it
	{
		
	}
	elseif language == "Español"
	{
		"[FLUX puede mostrar tu canción y Shell actual en tu estado de Discord si instalas el \_a[https://ssp.shillest.net/plugin/discord.nar]Discord Rich Presence\_a plugin para SSP.]\n\n[100][Tras la instalación, haga botón secundario sobre FLUX, diríjase a la opción %(_h)Plugins%(_d) y haga click en %(_h)Discord Rich Presence%(_d). Selecciona FLUX como tu Ghost en el menú que aparece y la información debería de aparecer en Discord tras cerrar el menú.]"
		
		"\n\n\![*]\__q[OnMusicPlayer.Settings]Volver a Controles de Música\__q"
	}
	elseif language == "Deutsch"
	{
		"[FLUX kann das derzeitige Lied und die derzeitige Shell in deinem Discord-Status anzeigen, wenn das \_a[https://ssp.shillest.net/plugin/discord.nar]Discord Rich Presence\_a Plugin für SSP installiert wurde.]\n\n[100][Nachdem das Plugin installiert wurde kann man FLUX rechts-klicken, zur %(_h)Plugins%(_d)-Option gehen und dann auf %(_h)Discord Rich Presence%(_d) klicken um in diesem Menü FLUX als den aktiven Ghost auszuwählen. Nach dem Schließen dieses Menüs sollte die Information dann in Discord auftauchen.]"
		
		"\n\n\![*]\__q[OnMusicPlayer.Settings]Zurück zu Musik-Einstellungen\__q"
	}
	elseif language == "Русский"
	{
		"[FLUX может показать твой текущий песня и внешний вид в статусе Дискорд, если ты установишь модуль \_a[https://ssp.shillest.net/plugin/discord.nar]Discord Rich Presence\_a для SSP.]\n\n[100][После установки модуля, щелкни правой кнопкой мышей на FLUX, иди в настроек %(_h)Модули%(_d), и нажми %(_h)Discord Rich Presence%(_d). Выбирать FLUX как активное привидение в меню, который пуьунлун, и после закрытие меню,информация должно быть видно в Дискорд.]"
		
		"\n\n\![*]\__q[OnMusicPlayer.Settings]Назад в Настроек Музыки\__q"
	}
	//TODO FRENCH
	elseif language == "Français"
	{
		"\n\n\![*]\__q[OnMusicPlayer.Settings]Retour aux paramètres des musiques\__q"
	}
	elseif language == "Polski"
	{
		"[FLUX może wyświetlać bieżący utwór i skorupę w statusie Discorda, jeśli zainstalujesz wtyczkę \_a[https://ssp.shillest.net/plugin/discord.nar]Discord Rich Presence\_a dla SSP.]\n\n[100][Po zainstalowaniu wtyczki, kliknij prawym przyciskiem myszy na FLUX, przejdź do opcji %(_h)Plugins%(_d) i kliknij na %(_h)Discord Rich Presence%(_d). W menu, które się pojawi, wybierz FLUX jako aktywnego ducha, a po zamknięciu menu w Discordzie powinny pojawić się informacje.]"
		
		"\n\n\![*]\__q[OnMusicPlayer.Settings]Powrót do ustawień muzycznych\__q"
	}
	else //English
	{
		"[FLUX can display your current song and shell in your Discord status if you install the \_a[https://ssp.shillest.net/plugin/discord.nar]Discord Rich Presence\_a plugin for SSP.]\n\n[100][After installing the plugin, right click FLUX, go to the %(_h)Plugins%(_d) option, and click on %(_h)Discord Rich Presence%(_d). Select FLUX as your active ghost in the menu that comes up, and you should see the info appear in Discord after you close the menu.]"
		
		"\n\n\![*]\__q[OnMusicPlayer.Settings]Back to music settings\__q"
	}
}